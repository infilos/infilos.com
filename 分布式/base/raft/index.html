<!doctype html><html lang=zh class=no-js>
<head>
<meta charset=utf-8>
<meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no">
<meta name=generator content="Hugo 0.93.3">
<meta name=ROBOTS content="INDEX, FOLLOW">
<link rel="shortcut icon" href=/favicons/favicon.ico>
<link rel=apple-touch-icon href=/favicons/apple-touch-icon-180x180.png sizes=180x180>
<link rel=icon type=image/png href=/favicons/favicon-16x16.png sizes=16x16>
<link rel=icon type=image/png href=/favicons/favicon-32x32.png sizes=32x32>
<link rel=icon type=image/png href=/favicons/android-36x36.png sizes=36x36>
<link rel=icon type=image/png href=/favicons/android-48x48.png sizes=48x48>
<link rel=icon type=image/png href=/favicons/android-72x72.png sizes=72x72>
<link rel=icon type=image/png href=/favicons/android-96x96.png sizes=96x96>
<link rel=icon type=image/png href=/favicons/android-144x144.png sizes=144x144>
<link rel=icon type=image/png href=/favicons/android-192x192.png sizes=192x192>
<title>Raft | infilos.com</title><meta property="og:title" content="Raft">
<meta property="og:description" content="基本概念 复制状态机   复制状态机通过日志复制来实现：  日志：每台机器保存一份日志，日志来自客户端的请求，包含一系列命令。 状态机：状态机会按序执行这些命令。 一致性模型：分布式环境中，保证多机的日志是一致的，这样回放到状态机中得到的状态就是一致的。   一致性算法用于一致性模型，一般有以下特性：  Safety：在非拜占庭问题下(网络延时、网络分区、丢包、重复包、包乱序)，结果是正确的。 Availability：在半数以上机器能正常工作时，服务可用。 Timing-unindepentent：不依赖于时钟来保持日志一致性，错误的时钟以及极端的消息延时最多会造成可用性问题。     实际的实现中，建议状态机的每个命令曹邹都是幂等的，这样更易于保证一致性。
 服务器状态 每台服务器一定会处于三种状态：
 领导者 候选者 追随者    追随者只响应其他服务器的请求。如果追随者没有收到任何消息，它会成为一个候选者并开始一次选举。 收到大多数服务器投票的候选者将称为新的领导者。 领导者在宕机之前会一致保持领导者的状态。  任期 Raft 算法将事件划分为任意不同长度的任期(Term)。任期用连续的数字来表示。每个任期的开始都是一次选举(election)，一个或多个候选者会试图称为领导者。如果一个候选者赢得了选举，他就会在该任期的剩余时间内担任领导者。在某些情况下，选票会被瓜分，有可能没有选出领导者。这时将开始另一个任期，并且立刻开始下一次选举。Raft 算法保证在指定的任期内只有一个领导者。
 RPC Raft 算法中服务器节点之间通过 RPC 通信，并且基本的一致性算法只需要两种类型的 RPC。请求投票 RPC 由候选者在选举期间发起，然后附加条目 RPC 由领导者发起，用来复制日志或提供一种心跳机制。为了服务器之间传输快照增加了第三种 RPC。当服务器没有及时收到 RPC 的响应时会尝试重试，并且它们能够并行的发起 RPC 来获得最佳性能。RPC 有三种：
 RequestVote RPC：候选者在选举期间发起。 AppendEntries RPC：领导者发起的一种心跳机制，或用于日志复制。 InstallSnapshot RPC：领导者使用该 RPC 来发送快照给过于落后的追随者。  超时设置：
 BroadcastTime：领导者的心跳超时。 ElectionTimeout：追随者设置的候选超时时间。 MTBF：指的是单个服务器发生故障的间隔时间的平均值。  BroadcastTime < ElectionTimeout < MTBT 原则：">
<meta property="og:type" content="article">
<meta property="og:url" content="/%E5%88%86%E5%B8%83%E5%BC%8F/base/raft/"><meta property="article:section" content="分布式">
<meta property="og:site_name" content="infilos.com">
<meta itemprop=name content="Raft">
<meta itemprop=description content="基本概念 复制状态机   复制状态机通过日志复制来实现：  日志：每台机器保存一份日志，日志来自客户端的请求，包含一系列命令。 状态机：状态机会按序执行这些命令。 一致性模型：分布式环境中，保证多机的日志是一致的，这样回放到状态机中得到的状态就是一致的。   一致性算法用于一致性模型，一般有以下特性：  Safety：在非拜占庭问题下(网络延时、网络分区、丢包、重复包、包乱序)，结果是正确的。 Availability：在半数以上机器能正常工作时，服务可用。 Timing-unindepentent：不依赖于时钟来保持日志一致性，错误的时钟以及极端的消息延时最多会造成可用性问题。     实际的实现中，建议状态机的每个命令曹邹都是幂等的，这样更易于保证一致性。
 服务器状态 每台服务器一定会处于三种状态：
 领导者 候选者 追随者    追随者只响应其他服务器的请求。如果追随者没有收到任何消息，它会成为一个候选者并开始一次选举。 收到大多数服务器投票的候选者将称为新的领导者。 领导者在宕机之前会一致保持领导者的状态。  任期 Raft 算法将事件划分为任意不同长度的任期(Term)。任期用连续的数字来表示。每个任期的开始都是一次选举(election)，一个或多个候选者会试图称为领导者。如果一个候选者赢得了选举，他就会在该任期的剩余时间内担任领导者。在某些情况下，选票会被瓜分，有可能没有选出领导者。这时将开始另一个任期，并且立刻开始下一次选举。Raft 算法保证在指定的任期内只有一个领导者。
 RPC Raft 算法中服务器节点之间通过 RPC 通信，并且基本的一致性算法只需要两种类型的 RPC。请求投票 RPC 由候选者在选举期间发起，然后附加条目 RPC 由领导者发起，用来复制日志或提供一种心跳机制。为了服务器之间传输快照增加了第三种 RPC。当服务器没有及时收到 RPC 的响应时会尝试重试，并且它们能够并行的发起 RPC 来获得最佳性能。RPC 有三种：
 RequestVote RPC：候选者在选举期间发起。 AppendEntries RPC：领导者发起的一种心跳机制，或用于日志复制。 InstallSnapshot RPC：领导者使用该 RPC 来发送快照给过于落后的追随者。  超时设置：
 BroadcastTime：领导者的心跳超时。 ElectionTimeout：追随者设置的候选超时时间。 MTBF：指的是单个服务器发生故障的间隔时间的平均值。  BroadcastTime < ElectionTimeout < MTBT 原则：">
<meta itemprop=wordCount content="297">
<meta itemprop=keywords content><meta name=twitter:card content="summary">
<meta name=twitter:title content="Raft">
<meta name=twitter:description content="基本概念 复制状态机   复制状态机通过日志复制来实现：  日志：每台机器保存一份日志，日志来自客户端的请求，包含一系列命令。 状态机：状态机会按序执行这些命令。 一致性模型：分布式环境中，保证多机的日志是一致的，这样回放到状态机中得到的状态就是一致的。   一致性算法用于一致性模型，一般有以下特性：  Safety：在非拜占庭问题下(网络延时、网络分区、丢包、重复包、包乱序)，结果是正确的。 Availability：在半数以上机器能正常工作时，服务可用。 Timing-unindepentent：不依赖于时钟来保持日志一致性，错误的时钟以及极端的消息延时最多会造成可用性问题。     实际的实现中，建议状态机的每个命令曹邹都是幂等的，这样更易于保证一致性。
 服务器状态 每台服务器一定会处于三种状态：
 领导者 候选者 追随者    追随者只响应其他服务器的请求。如果追随者没有收到任何消息，它会成为一个候选者并开始一次选举。 收到大多数服务器投票的候选者将称为新的领导者。 领导者在宕机之前会一致保持领导者的状态。  任期 Raft 算法将事件划分为任意不同长度的任期(Term)。任期用连续的数字来表示。每个任期的开始都是一次选举(election)，一个或多个候选者会试图称为领导者。如果一个候选者赢得了选举，他就会在该任期的剩余时间内担任领导者。在某些情况下，选票会被瓜分，有可能没有选出领导者。这时将开始另一个任期，并且立刻开始下一次选举。Raft 算法保证在指定的任期内只有一个领导者。
 RPC Raft 算法中服务器节点之间通过 RPC 通信，并且基本的一致性算法只需要两种类型的 RPC。请求投票 RPC 由候选者在选举期间发起，然后附加条目 RPC 由领导者发起，用来复制日志或提供一种心跳机制。为了服务器之间传输快照增加了第三种 RPC。当服务器没有及时收到 RPC 的响应时会尝试重试，并且它们能够并行的发起 RPC 来获得最佳性能。RPC 有三种：
 RequestVote RPC：候选者在选举期间发起。 AppendEntries RPC：领导者发起的一种心跳机制，或用于日志复制。 InstallSnapshot RPC：领导者使用该 RPC 来发送快照给过于落后的追随者。  超时设置：
 BroadcastTime：领导者的心跳超时。 ElectionTimeout：追随者设置的候选超时时间。 MTBF：指的是单个服务器发生故障的间隔时间的平均值。  BroadcastTime < ElectionTimeout < MTBT 原则：">
<script type=application/javascript>var doNotTrack=!1;doNotTrack||(window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-123062585-1","auto"),ga("send","pageview"))</script>
<script async src=https://www.google-analytics.com/analytics.js></script>
<link rel=preload href=/scss/main.min.847464b684a6e89d7276700a5c500c17ab494dd1755b2654a7b27d8b59e3347e.css as=style>
<link href=/scss/main.min.847464b684a6e89d7276700a5c500c17ab494dd1755b2654a7b27d8b59e3347e.css rel=stylesheet integrity>
<script src=/js/jquery-3.5.1.min.js integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin=anonymous></script>
</head><body class=td-page>
<header>
<nav class="js-navbar-scroll navbar navbar-expand-lg navbar-dark td-navbar">
<a class=navbar-brand href=/>
<span class=navbar-logo><svg id="Capa_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 512 512" style="enable-background:new 0 0 512 512"><path style="fill:#ffc107" d="M432.384 143.616c-4.165-4.164-10.917-4.164-15.083.0l-60.352 60.352c-4.164 4.165-4.164 10.917.0 15.083 21.187 20.463 54.951 19.876 75.413-1.311 19.962-20.668 19.962-53.435.0-74.102L432.384 143.616z"/><path style="fill:#607d8b" d="M42.667 277.334c-5.891.003-10.669-4.771-10.672-10.662-.002-4.338 2.623-8.245 6.64-9.882l234.667-96c5.455-2.233 11.687.38 13.92 5.835s-.38 11.687-5.835 13.92l-234.667 96C45.433 277.069 44.056 277.337 42.667 277.334z"/><path style="fill:#546e7a" d="M391.552 56.448l-32-32C343.938 8.745 322.689-.059 300.544.0h-3.755c-46.082.024-83.432 37.374-83.456 83.456v3.755c-.053 22.138 8.75 43.377 24.448 58.987l32 32c4.165 4.164 10.917 4.164 15.083.0L391.531 71.531C395.701 67.372 395.71 60.62 391.552 56.448z"/><path style="fill:#607d8b" d="M160 469.334c-3.279.006-6.379-1.497-8.405-4.075L34.261 315.926c-3.635-4.636-2.823-11.341 1.813-14.976s11.341-2.823 14.976 1.813l117.333 149.333c3.629 4.641 2.809 11.344-1.832 14.973C164.681 468.533 162.375 469.329 160 469.334z"/><path style="fill:#455a64" d="M487.467 86.848l-3.669-3.648c-37.687-36.557-97.71-36.197-134.955.811l-51.413 51.413c-36.996 37.25-37.357 97.263-.811 134.955l3.584 3.669c1.7 2.457 4.671 3.706 7.616 3.2 2.831.005 5.548-1.115 7.552-3.115l172.181-172.181c4.189-4.143 4.226-10.896.083-15.085-.028-.028-.055-.056-.083-.083L487.467 86.848z"/><g><path style="fill:#ffc107" d="M501.333 192H480c-5.891.0-10.667-4.776-10.667-10.667s4.776-10.667 10.667-10.667h21.333c5.891.0 10.667 4.776 10.667 10.667S507.225 192 501.333 192z"/><path style="fill:#ffc107" d="M394.667 298.667c-5.891.0-10.667-4.776-10.667-10.667v-21.333c0-5.891 4.776-10.667 10.667-10.667 5.891.0 10.667 4.776 10.667 10.667V288C405.333 293.891 400.558 298.667 394.667 298.667z"/><path style="fill:#ffc107" d="M480 277.334c-2.831.005-5.548-1.115-7.552-3.115l-21.333-21.333c-4.093-4.237-3.975-10.99.262-15.083 4.134-3.993 10.687-3.993 14.821.0l21.333 21.333c4.159 4.172 4.148 10.926-.024 15.085C485.514 276.209 482.815 277.327 480 277.334z"/></g><g><path style="fill:#455a64" d="M266.667 448H96c-29.455.0-53.333 23.878-53.333 53.333.0 5.891 4.776 10.667 10.667 10.667h256c5.891.0 10.667-4.776 10.667-10.667C320 471.878 296.122 448 266.667 448z"/><circle style="fill:#455a64" cx="32" cy="288" r="32"/></g><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/></svg></span>
<span class=font-weight-bold>infilos.com</span>
</a>
<button class=navbar-toggler type=button data-toggle=collapse data-target=#navbarSupportedContent aria-controls=navbarSupportedContent aria-expanded=false aria-label="Toggle navigation">
<span class=navbar-toggler-icon></span>
</button>
<div class="collapse navbar-collapse" id=navbarSupportedContent>
<ul class="navbar-nav mr-auto">
<li class=nav-item style=max-width:90px;min-width:10px>
<a class=nav-link href=/%e5%9f%ba%e7%a1%80%e7%9f%a5%e8%af%86>
<span>基础</span>
</a>
</li><li class=nav-item style=max-width:90px;min-width:10px>
<a class=nav-link href=/%e7%bc%96%e7%a8%8b%e8%af%ad%e8%a8%80>
<span>语言</span>
</a>
</li><li class=nav-item style=max-width:90px;min-width:10px>
<a class=nav-link href=/%e6%a1%86%e6%9e%b6%e4%b8%8e%e5%ba%93>
<span>框架库</span>
</a>
</li><li class="nav-item dropdown" style=max-width:90px;min-width:10px>
<a class="nav-link dropdown-toggle" href=# id=navbarDropdown role=button data-toggle=dropdown aria-haspopup=true aria-expanded=false>
分布式
<span>+</span>
</a>
<div class=dropdown-menu aria-labelledby=navbarDropdown>
<a class=dropdown-item href=/%e5%88%86%e5%b8%83%e5%bc%8f/base>基本构成</a>
</div></li><li class="nav-item dropdown" style=max-width:90px;min-width:10px>
<a class="nav-link dropdown-toggle" href=# id=navbarDropdown role=button data-toggle=dropdown aria-haspopup=true aria-expanded=false>
大数据
<span>+</span>
</a>
<div class=dropdown-menu aria-labelledby=navbarDropdown>
<a class=dropdown-item href=/%e5%ad%98%e5%82%a8%e7%b3%bb%e7%bb%9f>存储系统</a>
<a class=dropdown-item href=/%e6%9f%a5%e8%af%a2%e7%b3%bb%e7%bb%9f>查询系统</a>
<a class=dropdown-item href=/%e6%b6%88%e6%81%af%e7%b3%bb%e7%bb%9f>消息系统</a>
<a class=dropdown-item href=/%e5%a4%84%e7%90%86%e7%b3%bb%e7%bb%9f>处理系统</a>
<a class=dropdown-item href=/%e6%95%b0%e6%8d%ae%e6%b2%bb%e7%90%86>数据治理</a>
</div></li><li class="nav-item dropdown" style=max-width:90px;min-width:10px>
<a class="nav-link dropdown-toggle" href=# id=navbarDropdown role=button data-toggle=dropdown aria-haspopup=true aria-expanded=false>
中后台
<span>+</span>
</a>
<div class=dropdown-menu aria-labelledby=navbarDropdown>
<a class=dropdown-item href=/%e5%9f%ba%e7%a1%80%e8%ae%be%e6%96%bd>基础设施</a>
<a class=dropdown-item href=/%e7%94%a8%e6%88%b7%e7%b3%bb%e7%bb%9f>用户系统</a>
<a class=dropdown-item href=/%e4%ba%a4%e4%ba%92%e7%95%8c%e9%9d%a2>交互界面</a>
<a class=dropdown-item href=/%e4%b8%9a%e5%8a%a1%e7%b3%bb%e7%bb%9f>业务系统</a>
</div></li><li class=nav-item style=max-width:90px;min-width:10px>
<a class=nav-link href=/%e6%a8%a1%e5%bc%8f%e6%9e%b6%e6%9e%84>
<span>模式架构</span>
</a>
</li><li class=nav-item style=max-width:90px;min-width:10px>
<a class=nav-link href=/%e9%9d%a2%e8%af%95%e9%97%ae%e7%ad%94>
<span>面试</span>
</a>
</li><li class=nav-item style=max-width:90px;min-width:10px>
<a class=nav-link href=/%e7%ae%a1%e7%90%86%e8%b7%af%e5%be%84>
<span>管理</span>
</a>
</li><li class=nav-item style=max-width:90px;min-width:10px>
<a class=nav-link href=/%e5%bc%80%e6%ba%90%e9%a1%b9%e7%9b%ae>
<span>开源</span>
</a>
</li></ul><div class="form-inline my-2 my-lg-0">
<div class="nav-item nav-search-item my-2 my-md-0">
<input type=search class="form-control td-search-input" placeholder="&#xf002; 站内搜索…" aria-label=站内搜索… autocomplete=off>
</div></div></div></nav></header><div class="container-fluid td-outer">
<div class=td-main>
<div class="row flex-xl-nowrap">
<aside class="col-12 col-md-3 col-xl-2 td-sidebar d-print-none">
<div id=td-sidebar-menu class=td-sidebar__inner>
<div id=content-mobile>
<form class="td-sidebar__search d-flex align-items-center">
<input type=search class="form-control td-search-input" placeholder="&#xf002; 站内搜索…" aria-label=站内搜索… autocomplete=off>
<button class="btn btn-link td-sidebar__toggle d-md-none p-0 ml-3 fas fa-bars" type=button data-toggle=collapse data-target=#td-section-nav aria-controls=td-docs-nav aria-expanded=false aria-label="Toggle section navigation">
</button>
</form></div><div id=content-desktop></div><nav class="collapse td-sidebar-nav" id=td-section-nav>
<ul class="td-sidebar-nav__section pr-md-3 ul-0">
<li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child active-path" id=m-e58886e5b883e5bc8f-li>
<a href=/%E5%88%86%E5%B8%83%E5%BC%8F/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section tree-root" id=m-e58886e5b883e5bc8f><span>分布式</span></a>
<ul class=ul-1>
<li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child active-path" id=m-e58886e5b883e5bc8fbase-li>
<a href=/%E5%88%86%E5%B8%83%E5%BC%8F/base/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-e58886e5b883e5bc8fbase><span>基本构成</span></a>
<ul class="ul-2 foldable">
<li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-e58886e5b883e5bc8fbaseconsistence-li>
<a href=/%E5%88%86%E5%B8%83%E5%BC%8F/base/consistence/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-e58886e5b883e5bc8fbaseconsistence><span>一致性模型</span></a>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-e58886e5b883e5bc8fbaseacid-li>
<a href=/%E5%88%86%E5%B8%83%E5%BC%8F/base/acid/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-e58886e5b883e5bc8fbaseacid><span>ACID 隔离级别</span></a>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-e58886e5b883e5bc8fbasecap-li>
<a href=/%E5%88%86%E5%B8%83%E5%BC%8F/base/cap/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-e58886e5b883e5bc8fbasecap><span>CAP</span></a>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-e58886e5b883e5bc8fbasebase-li>
<a href=/%E5%88%86%E5%B8%83%E5%BC%8F/base/base/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-e58886e5b883e5bc8fbasebase><span>BASE</span></a>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-e58886e5b883e5bc8fbasecalm-li>
<a href=/%E5%88%86%E5%B8%83%E5%BC%8F/base/calm/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-e58886e5b883e5bc8fbasecalm><span>CALM</span></a>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-e58886e5b883e5bc8fbasegossip-li>
<a href=/%E5%88%86%E5%B8%83%E5%BC%8F/base/gossip/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-e58886e5b883e5bc8fbasegossip><span>Gossip</span></a>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-e58886e5b883e5bc8fbasecrdt-li>
<a href=/%E5%88%86%E5%B8%83%E5%BC%8F/base/crdt/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-e58886e5b883e5bc8fbasecrdt><span>CRDT</span></a>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-e58886e5b883e5bc8fbase2pc-li>
<a href=/%E5%88%86%E5%B8%83%E5%BC%8F/base/2pc/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-e58886e5b883e5bc8fbase2pc><span>2PC</span></a>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-e58886e5b883e5bc8fbase3pc-li>
<a href=/%E5%88%86%E5%B8%83%E5%BC%8F/base/3pc/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-e58886e5b883e5bc8fbase3pc><span>3PC</span></a>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-e58886e5b883e5bc8fbasepaxos-li>
<a href=/%E5%88%86%E5%B8%83%E5%BC%8F/base/paxos/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-e58886e5b883e5bc8fbasepaxos><span>Paxos</span></a>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-e58886e5b883e5bc8fbasezab-li>
<a href=/%E5%88%86%E5%B8%83%E5%BC%8F/base/zab/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-e58886e5b883e5bc8fbasezab><span>ZAB</span></a>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child active-path" id=m-e58886e5b883e5bc8fbaseraft-li>
<a href=/%E5%88%86%E5%B8%83%E5%BC%8F/base/raft/ class="align-left pl-0 active td-sidebar-link td-sidebar-link__page" id=m-e58886e5b883e5bc8fbaseraft><span class=td-sidebar-nav-active-item>Raft</span></a>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-e58886e5b883e5bc8fbasee58886e5b883e5bc8fe4b880e887b4-li>
<a href=/%E5%88%86%E5%B8%83%E5%BC%8F/base/%E5%88%86%E5%B8%83%E5%BC%8F%E4%B8%80%E8%87%B4/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-e58886e5b883e5bc8fbasee58886e5b883e5bc8fe4b880e887b4><span>分布式一致性</span></a>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-e58886e5b883e5bc8fbasee58886e5b883e5bc8fe4ba8be58aa1-li>
<a href=/%E5%88%86%E5%B8%83%E5%BC%8F/base/%E5%88%86%E5%B8%83%E5%BC%8F%E4%BA%8B%E5%8A%A1/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-e58886e5b883e5bc8fbasee58886e5b883e5bc8fe4ba8be58aa1><span>分布式事务</span></a>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-e58886e5b883e5bc8fbasee58886e5b883e5bc8fe4ba8be58aa1e696b9e6a188-li>
<a href=/%E5%88%86%E5%B8%83%E5%BC%8F/base/%E5%88%86%E5%B8%83%E5%BC%8F%E4%BA%8B%E5%8A%A1%E6%96%B9%E6%A1%88/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-e58886e5b883e5bc8fbasee58886e5b883e5bc8fe4ba8be58aa1e696b9e6a188><span>分布式事务</span></a>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-e58886e5b883e5bc8fbasee4b880e887b4e680a7e585b1e8af86-li>
<a href=/%E5%88%86%E5%B8%83%E5%BC%8F/base/%E4%B8%80%E8%87%B4%E6%80%A7%E5%85%B1%E8%AF%86/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-e58886e5b883e5bc8fbasee4b880e887b4e680a7e585b1e8af86><span>一致性与共识算法</span></a>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-e58886e5b883e5bc8fbasee58886e5b883e5bc8fe99481-li>
<a href=/%E5%88%86%E5%B8%83%E5%BC%8F/base/%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-e58886e5b883e5bc8fbasee58886e5b883e5bc8fe99481><span>分布式锁</span></a>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-e58886e5b883e5bc8fbasee4b880e887b4e680a7e59388e5b88c-li>
<a href=/%E5%88%86%E5%B8%83%E5%BC%8F/base/%E4%B8%80%E8%87%B4%E6%80%A7%E5%93%88%E5%B8%8C/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-e58886e5b883e5bc8fbasee4b880e887b4e680a7e59388e5b88c><span>一致性哈希算法</span></a>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-e58886e5b883e5bc8fbasee585a8e5b180e594afe4b880e6a087e8af86-li>
<a href=/%E5%88%86%E5%B8%83%E5%BC%8F/base/%E5%85%A8%E5%B1%80%E5%94%AF%E4%B8%80%E6%A0%87%E8%AF%86/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-e58886e5b883e5bc8fbasee585a8e5b180e594afe4b880e6a087e8af86><span>全局唯一标识</span></a>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-e58886e5b883e5bc8fbasee58886e5b883e5bc8fe8b0ace8afaf-li>
<a href=/%E5%88%86%E5%B8%83%E5%BC%8F/base/%E5%88%86%E5%B8%83%E5%BC%8F%E8%B0%AC%E8%AF%AF/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-e58886e5b883e5bc8fbasee58886e5b883e5bc8fe8b0ace8afaf><span>分布式谬误</span></a>
</li></ul></li></ul></li></ul></nav></div></aside><aside class="d-none d-xl-block col-xl-2 td-sidebar-toc d-print-none">
<div class="td-page-meta ml-2 pb-1 pt-2 mb-0">
<a href=https://github.com/infilos/infilos.com/edit/master/content/zh/%e5%88%86%e5%b8%83%e5%bc%8f/base/raft.md target=_blank><i class="fa fa-edit fa-fw"></i> 编辑此页</a>
<a href="https://github.com/infilos/infilos.com/new/master/content/zh/%e5%88%86%e5%b8%83%e5%bc%8f/base/raft.md?filename=change-me.md&value=---%0Atitle%3A+%22Long+Page+Title%22%0AlinkTitle%3A+%22Short+Nav+Title%22%0Aweight%3A+100%0Adescription%3A+%3E-%0A+++++Page+description+for+heading+and+indexes.%0A---%0A%0A%23%23+Heading%0A%0AEdit+this+template+to+create+your+new+page.%0A%0A%2A+Give+it+a+good+name%2C+ending+in+%60.md%60+-+e.g.+%60getting-started.md%60%0A%2A+Edit+the+%22front+matter%22+section+at+the+top+of+the+page+%28weight+controls+how+its+ordered+amongst+other+pages+in+the+same+directory%3B+lowest+number+first%29.%0A%2A+Add+a+good+commit+message+at+the+bottom+of+the+page+%28%3C80+characters%3B+use+the+extended+description+field+for+more+detail%29.%0A%2A+Create+a+new+branch+so+you+can+preview+your+new+file+and+request+a+review+via+Pull+Request.%0A" target=_blank><i class="fa fa-edit fa-fw"></i> 添加子页面</a>
<a href="https://github.com/infilos/infilos.com/issues/new?title=Raft" target=_blank><i class="fab fa-github fa-fw"></i> 提交文档问题</a>
<a id=print href=/%E5%88%86%E5%B8%83%E5%BC%8F/base/_print/><i class="fa fa-print fa-fw"></i> 整节打印</a>
</div><div class=td-toc><nav id=TableOfContents>
<ul>
<li><a href=#基本概念>基本概念</a>
<ul>
<li><a href=#复制状态机>复制状态机</a></li><li><a href=#服务器状态>服务器状态</a></li><li><a href=#任期>任期</a></li><li><a href=#rpc>RPC</a></li></ul></li><li><a href=#选举>选举</a></li><li><a href=#日志复制>日志复制</a></li><li><a href=#安全性>安全性</a>
<ul>
<li><a href=#1-领导者追加日志>1. 领导者追加日志</a></li><li><a href=#2-选举限制投票阻止没有全部日志条目的服务器赢得选举>2. 选举限制：投票阻止没有全部日志条目的服务器赢得选举</a></li><li><a href=#3-永远不提交任期之前的日志条目只提交任期内的日志条目>3. 永远不提交任期之前的日志条目（只提交任期内的日志条目）</a></li><li><a href=#4-候选者和追随者崩溃>4. 候选者和追随者崩溃</a></li></ul></li><li><a href=#集群成员变更>集群成员变更</a>
<ul>
<li><a href=#直接从一种配置转到新的配置是十分不安全的>直接从一种配置转到新的配置是十分不安全的</a></li><li><a href=#两阶段方法保证安全性>两阶段方法保证安全性</a></li></ul></li><li><a href=#日志压缩>日志压缩</a></li><li><a href=#client-交互>Client 交互</a></li><li><a href=#reference>Reference</a></li></ul></nav></div></aside><main class="col-12 col-md-9 col-xl-8 pl-md-5" role=main>
<nav aria-label=breadcrumb class="d-none d-md-block d-print-none">
<ol class="breadcrumb spb-1">
<li class=breadcrumb-item>
<a href=/%E5%88%86%E5%B8%83%E5%BC%8F/>分布式</a>
</li><li class=breadcrumb-item>
<a href=/%E5%88%86%E5%B8%83%E5%BC%8F/base/>基本构成</a>
</li><li class="breadcrumb-item active" aria-current=page>
<a href=/%E5%88%86%E5%B8%83%E5%BC%8F/base/raft/>Raft</a>
</li></ol></nav><div class=td-content>
<h1>Raft</h1><header class=article-meta>
</header><h2 id=基本概念>基本概念</h2><h3 id=复制状态机>复制状态机</h3><div align=center> <img src=https://infi-img.oss-cn-hangzhou.aliyuncs.com/img/20190224225452.png style=display:block;width:50% alt=NAME align=center> </div><ul>
<li>复制状态机通过日志复制来实现：
<ul>
<li>日志：每台机器保存一份日志，日志来自客户端的请求，包含一系列命令。</li><li>状态机：状态机会按序执行这些命令。</li><li>一致性模型：分布式环境中，保证多机的日志是一致的，这样回放到状态机中得到的状态就是一致的。</li></ul></li><li>一致性算法用于一致性模型，一般有以下特性：
<ul>
<li>Safety：在非拜占庭问题下(网络延时、网络分区、丢包、重复包、包乱序)，结果是正确的。</li><li>Availability：在半数以上机器能正常工作时，服务可用。</li><li>Timing-unindepentent：不依赖于时钟来保持日志一致性，错误的时钟以及极端的消息延时最多会造成可用性问题。</li></ul></li></ul><blockquote>
<p>实际的实现中，建议状态机的每个命令曹邹都是幂等的，这样更易于保证一致性。</p></blockquote><h3 id=服务器状态>服务器状态</h3><p>每台服务器一定会处于三种状态：</p><ul>
<li>领导者</li><li>候选者</li><li>追随者</li></ul><div align=center> <img src=https://infi-img.oss-cn-hangzhou.aliyuncs.com/img/20190224230043.png style=display:block;width:50% alt=NAME align=center> </div><ul>
<li>追随者只响应其他服务器的请求。如果追随者没有收到任何消息，它会成为一个候选者并开始一次选举。</li><li>收到大多数服务器投票的候选者将称为新的领导者。</li><li>领导者在宕机之前会一致保持领导者的状态。</li></ul><h3 id=任期>任期</h3><p>Raft 算法将事件划分为任意不同长度的任期(Term)。任期用连续的数字来表示。每个任期的开始都是一次选举(election)，一个或多个候选者会试图称为领导者。如果一个候选者赢得了选举，他就会在该任期的剩余时间内担任领导者。在某些情况下，选票会被瓜分，有可能没有选出领导者。这时将开始另一个任期，并且立刻开始下一次选举。Raft 算法保证在指定的任期内只有一个领导者。</p><div align=center> <img src=https://infi-img.oss-cn-hangzhou.aliyuncs.com/img/20190224230534.png style=display:block;width:50% alt=NAME align=center> </div><h3 id=rpc>RPC</h3><p>Raft 算法中服务器节点之间通过 RPC 通信，并且基本的一致性算法只需要两种类型的 RPC。请求投票 RPC 由候选者在选举期间发起，然后附加条目 RPC 由领导者发起，用来复制日志或提供一种心跳机制。为了服务器之间传输快照增加了第三种 RPC。当服务器没有及时收到 RPC 的响应时会尝试重试，并且它们能够并行的发起 RPC 来获得最佳性能。RPC 有三种：</p><ol>
<li>RequestVote RPC：候选者在选举期间发起。</li><li>AppendEntries RPC：领导者发起的一种心跳机制，或用于日志复制。</li><li>InstallSnapshot RPC：领导者使用该 RPC 来发送快照给过于落后的追随者。</li></ol><p>超时设置：</p><ol>
<li>BroadcastTime：领导者的心跳超时。</li><li>ElectionTimeout：追随者设置的候选超时时间。</li><li>MTBF：指的是单个服务器发生故障的间隔时间的平均值。</li></ol><p>BroadcastTime &lt; ElectionTimeout &lt; MTBT 原则：</p><ol>
<li>BroadcastTime 应该比 ElectionTimeout 小一个数量级，为的是使领导者能够持续发送心跳信息来避免追随者开始发起选举。</li><li>ElectionTimeout 应该比 MTBT 小几个数量级，为的是使系统稳定运行。</li></ol><p>一般 BroadcastTime 大约为 0.5 毫秒到 20 毫秒，ElectionTimeout 一般在 10ms 到 500ms 之间。大多数服务器的 MTBF 都在几个月甚至更长。</p><h2 id=选举>选举</h2><p><strong>触发条件</strong>：</p><ol>
<li>一般情况下，追随者接收到领导者的心跳时，会重置 ElectionTimeout，不会触发。</li><li>领导者故障，追随者的 ElectionTimeout 发生超时，会转换为候选者，触发选举。</li></ol><p><strong>候选操作过程</strong>：</p><p>追随者自增当前任期，转换为候选者，对自己投票，并发起 RequestVote RPC，等待以下三种情况发生：</p><ul>
<li>获得超过半数服务器的投票，赢得选举，称为领导者。</li><li>另一台服务器赢得选举，并接收到对应的心跳，称为追随者。</li><li>选举超时，没有任何一台服务器赢得选举，自增当前任期，重新发起选举。</li></ul><p><strong>注意事项</strong>：</p><ul>
<li>服务器在一个任期内，最多只能给一个候选者投票，采用先到先服务原则。</li><li>候选者等待投票期间，可能会接收到来自其他声明称为领导者的 AppendEntries RPC。如果该领导人的任期(RCP 的内容)比当当前候选者的任期要大，则当前候选者认为该领导者合法，并转换称为追随者；如果 RPC 中的任期小于当前任期，则后选择拒绝此次 RPC，继续保持候选者状态。</li><li>候选者既没有赢得选举也没有输得选举：如果很多追随者在同一时刻都称为了候选者，选票会被分散，可能没有候选者获得较多的投票。当这种情况发生时，每一个候选者都会超时，并且通过自增任期号和发起另一轮 RequestVote RPC 来开始新的选举。然而，如果没有其他手段来分配选票的话，这种情况可能会无限制的重复下去。所以 Raft 使用的随机方式来设置选举超时时间(150~300ms)来避免这种情况的发生。</li></ul><p><strong>问题探讨</strong>：</p><ul>
<li>候选者已经给自己投票了，一个候选者在一个任期内只会给一个人投票。</li><li>也有可能算法本身设定候选者就拒绝所有其他服务器的请求。</li></ul><h2 id=日志复制>日志复制</h2><div align=center> <img src=https://infi-img.oss-cn-hangzhou.aliyuncs.com/img/20190224232428.png style=display:block;width:50% alt=NAME align=center> </div><p><strong>接收命令过程</strong>：</p><ol>
<li>领导者接受客户端请求。</li><li>领导者将命令追加到日志。</li><li>发送 AppendEntries RPC 请求到追随者。</li><li>领导者收到大多数追随者的确认后，领导者 Commit 日志，将日志在状态机中回放，并返回结果给客户端。</li></ol><p><strong>提交过程</strong>：</p><ol>
<li>在下一个心跳阶段，领导者再次发送 AppendEntries RPC 给追随者，日志已经 Commit 完成。</li><li>追随者收到 Commit 结果之后，将日志在状态机中回放。</li></ol><h2 id=安全性>安全性</h2><p>到目前为止描述的机制并不能充分的保证每一个状态机会按照相同的顺序执行相同的指令，例如：一个跟随者可能会进入不可用状态同时领导人已经提交了若干的日志条目，然后这个跟随者可能会被选举为领导人并且覆盖这些日志条目；因此，不同的状态机可能会执行不同的指令序列。</p><h3 id=1-领导者追加日志>1. 领导者追加日志</h3><p>领导者永远不会覆盖已经存在的日志条目；日志永远只有一个流向：从领导者到追随者；</p><h3 id=2-选举限制投票阻止没有全部日志条目的服务器赢得选举>2. 选举限制：投票阻止没有全部日志条目的服务器赢得选举</h3><p>如果投票者的日志比候选人的新，拒绝投票请求；这意味着要赢得选举，候选者的日志至少和大多数服务器的日志一样新，那么它一定包含全部的已经提交的日志条目。</p><h3 id=3-永远不提交任期之前的日志条目只提交任期内的日志条目>3. 永远不提交任期之前的日志条目（只提交任期内的日志条目）</h3><p>在Raft算法中，当一个日志被安全的复制到绝大多数的机器上面，即AppendEntries RPC在绝大多数服务器正确返回了，那么这个日志就是被提交了，然后领导者会更新 “commit index”。</p><div align=center> <img src=https://infi-img.oss-cn-hangzhou.aliyuncs.com/img/20190224232951.png style=display:block;width:50% alt=NAME align=center> </div><p>如果允许提交任期之前的日志条目，那么在步骤 c 中，我们就会把之前任期为 2 的日志提交到其他服务器中去，并造成了大多数机器存在了日志为 2 的情况。所以造成了 d 中 S5 中任期为 3 的日志条目会覆盖掉已经提交的日志的情况。</p><p>Raft 从来不会通过计算复制的数目来提交之前人气的日志条目。只有领导人当前任期的日志条目才能通过计算数目来进行提交。一旦当前任期的日志条目以这种方式被提交，那么由于日志匹配原则（Log Matching Property），之前的日志条目也都会被间接的提交。</p><p>论文中的这段话比较难理解，更加直观的说：由于 Raft 不会提交任期之前的日志条目，那么就不会从 b 过渡到 c 的情况，只能从 b 发生 S5 宕机的情况下直接过渡到 e，这样就产生的更新的任期，这样 S5 就没有机会被选为领导者了。</p><h3 id=4-候选者和追随者崩溃>4. 候选者和追随者崩溃</h3><p>候选者和追随者崩溃的情况处理要简单的多。如果这类角色崩溃了，那么后续发送给他们的 RequestVote 和 AppendEntries 的所有 RPC 都会失败，Raft 算法中处理这类失败就是简单的无限重试的方式。如果这些服务器重新可用，那么这些 RPC 就会成功返回。如果一个服务器完成了一个 RPC，但是在响应 Leader 前崩溃了，那么当他再次可用的时候还会收到相同的 RPC 请求，此时接收服务器负责检查，比如如果收到了已经包含该条日志的 RPC 请求，可以直接忽略这个请求，确保对系统是无害的。</p><h2 id=集群成员变更>集群成员变更</h2><p>集群成员的变更和成员的宕机与重启不同，因为前者会修改成员个数进而影响到领导者的选取和决议过程，因为在分布式系统这对于 majority 这个集群中成员大多数的概念是极为重要的。</p><p>简单的做法是，运维人员将系统临时下线，修改配置，重新上线。但是这种做法存在两个缺点：</p><ul>
<li>更改时集群不可用</li><li>认为操作失误风险</li></ul><h3 id=直接从一种配置转到新的配置是十分不安全的>直接从一种配置转到新的配置是十分不安全的</h3><div align=center> <img src=https://infi-img.oss-cn-hangzhou.aliyuncs.com/img/20190224233534.png style=display:block;width:50% alt=NAME align=center> </div><p>因为各个机器可能在任何的时候进行转换。在这个例子中，集群配额从 3 台机器变成了 5 台。不幸的是，存在这样的一个时间点，两个不同的领导人在同一个任期里都可以被选举成功。一个是通过旧的配置，一个通过新的配置。</p><h3 id=两阶段方法保证安全性>两阶段方法保证安全性</h3><p>为了保证安全性，配置更改必须使用两阶段方法。在 Raft 中，集群先切换到一个过渡的配置，我们称之为共同一致；一旦共同一致已经被提交了，那么系统就切换到新的配置上。共同一致是老配置和新配置的结合。</p><p>共同一致允许独立的服务器在不影响安全性的前提下，在不同的时间进行配置转换过程。此外，共同一致可以让集群在配置转换的过程人依然响应服务器请求。</p><div align=center> <img src=https://infi-img.oss-cn-hangzhou.aliyuncs.com/img/20190224233844.png style=display:block;width:50% alt=NAME align=center> </div><p>一个领导人接收到一个改变配置从 C-old 到 C-new 的请求，他会为了共同一致存储配置（图中的 C-old,new），以前面描述的日志条目和副本的形式。一旦一个服务器将新的配置日志条目增加到它的日志中，他就会用这个配置来做出未来所有的决定。领导人完全特性保证了只有拥有 C-old,new 日志条目的服务器才有可能被选举为领导人。当 C-old,new 日志条目被提交以后，领导人在使用相同的策略提交 C-new，如下图所示，C-old 和 C-new 没有任何机会同时做出单方面的决定，这就保证了安全性。</p><p>上图是一个配置切换的时间线。虚线表示已经被创建但是还没有被提交的条目，实线表示最后被提交的日志条目。领导人首先创建了 C-old,new 的配置条目在自己的日志中，并提交到 C-old,new 中（C-old,new 的大多数和 C-new 的大多数）。然后他创建 C-new 条目并提交到 C-new 中的大多数。这样就不存在 C-new 和 C-old 可以同时做出决定的时间点。</p><h2 id=日志压缩>日志压缩</h2><p>日志会随着系统的不断运行会无限制的增长，这会给存储带来压力，几乎所有的分布式系统(Chubby、ZooKeeper)都采用快照的方式进行日志压缩，做完快照之后快照会在稳定持久存储中保存，而快照之前的日志和快照就可以丢弃掉。</p><p>Raft的具体做法如下图所示：</p><div align=center> <img src=https://infi-img.oss-cn-hangzhou.aliyuncs.com/img/20190224234023.png style=display:block;width:50% alt=NAME align=center> </div><p>与 Raft 其它操作 Leader-Based 不同，snapshot 是由各个节点独立生成的。除了日志压缩这一个作用之外，snapshot 还可以用于同步状态：slow-follower 以及 new-server，Raft 使用 InstallSnapshot RPC 完成该过程，不再赘述。</p><h2 id=client-交互>Client 交互</h2><ul>
<li>Client 只向领导者发送请求；</li><li>Client 开始会向追随者发送请求，追随者拒绝 Client 的请求，并重定向到领导者；</li><li>Client 请求失败，会超时重新发送请求。</li></ul><p>Raft 算法要求 Client 的请求线性化，防止请求被多次执行。有两个解决方案：</p><ul>
<li>Raft 算法提出要求每个请求有个唯一标识；</li><li>Raft 的请求保持幂等性。</li></ul><h2 id=reference>Reference</h2><ul>
<li><a href="http://blog.luoyuanhang.com/2017/02/02/raft-paper-in-zh-CN/?hmsr=toutiao.io&utm_medium=toutiao.io&utm_source=toutiao.io">论文</a></li><li>ETCD Raft 库的实现</li><li><a href="https://mp.weixin.qq.com/s?__biz=MzI3NDIxNTQyOQ==&mid=2247484544&idx=1&sn=7d8e412ecc5aaeb3f9b7cf391bdcf398&chksm=eb1623eadc61aafcefcfbdf36b388a5f96d3009d21641eb6ac67c57317d6c397ddeb58fc7d06#rd">TiKV 源码解析系列 - Raft 的优化</a></li><li><a href="https://zhuanlan.zhihu.com/p/33047950?hmsr=toutiao.io&utm_medium=toutiao.io&utm_source=toutiao.io">Elasticell-Multi-Raft实现</a></li><li><a href="http://tinylcy.me/2018/Understanding-the-Raft-consensus-algorithm-Two/?hmsr=toutiao.io&utm_medium=toutiao.io&utm_source=toutiao.io">Raft 理解</a></li><li><a href=https://juejin.im/entry/59bf3643f265da0655052fba>Raft 一致性算法笔记</a></li><li><a href=https://juejin.im/post/5aed9a7551882506a36c659e>Raft 协议理解</a></li><li><a href=https://zhuanlan.zhihu.com/p/32052223>Raft 算法详解</a></li></ul><style>.feedback--answer{display:inline-block}.feedback--answer-no{margin-left:1em}.feedback--response{display:none;margin-top:1em}.feedback--response__visible{display:block}</style><div class=d-print-none>
<h2 class=feedback--title>Feedback</h2><p class=feedback--question>Was this page helpful?</p><button class="btn btn-primary mb-4 feedback--answer feedback--answer-yes">Yes</button>
<button class="btn btn-primary mb-4 feedback--answer feedback--answer-no">No</button>
<p class="feedback--response feedback--response-yes">
Glad to hear it! Please <a href=https://github.com/infilos/infilos.com/issues/new>tell us how we can improve</a>.
</p><p class="feedback--response feedback--response-no">
Sorry to hear that. Please <a href=https://github.com/infilos/infilos.com/issues/new>tell us how we can improve</a>.
</p></div><script>const yesButton=document.querySelector(".feedback--answer-yes"),noButton=document.querySelector(".feedback--answer-no"),yesResponse=document.querySelector(".feedback--response-yes"),noResponse=document.querySelector(".feedback--response-no"),disableButtons=()=>{yesButton.disabled=!0,noButton.disabled=!0},sendFeedback=t=>{if(typeof ga!="function")return;const e={command:"send",hitType:"event",category:"Helpful",action:"click",label:window.location.pathname,value:t};ga(e.command,e.hitType,e.category,e.action,e.label,e.value)};yesButton.addEventListener("click",()=>{yesResponse.classList.add("feedback--response__visible"),disableButtons(),sendFeedback(1)}),noButton.addEventListener("click",()=>{noResponse.classList.add("feedback--response__visible"),disableButtons(),sendFeedback(0)})</script>
<br>
</div></main></div></div><footer class="bg-dark py-5 row d-print-none">
<div class="container-fluid mx-sm-5">
<div class=row>
<div class="col-6 col-sm-4 text-xs-center order-sm-2">
</div><div class="col-6 col-sm-4 text-right text-xs-center order-sm-3">
<ul class="list-inline mb-0">
<li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title=Weibo aria-label=Weibo>
<a class=text-white target=_blank rel="noopener noreferrer" href=https://weibo.com/u/3848950217>
<i class="fab fa-weibo"></i>
</a>
</li><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title=Twitter aria-label=Twitter>
<a class=text-white target=_blank rel="noopener noreferrer" href=https://twitter.com/zhange_zzg>
<i class="fab fa-twitter"></i>
</a>
</li><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title="Stack Overflow" aria-label="Stack Overflow">
<a class=text-white target=_blank rel="noopener noreferrer" href=https://stackoverflow.com>
<i class="fab fa-stack-overflow"></i>
</a>
</li><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title=GitHub aria-label=GitHub>
<a class=text-white target=_blank rel="noopener noreferrer" href=https://github.com/infilos/infilos.com>
<i class="fab fa-github"></i>
</a>
</li></ul></div><div class="col-12 col-sm-4 text-center py-2 order-sm-2">
<small class=text-white>&copy; 2022 infilos.com All Rights Reserved</small>
</div></div></div></footer></div><script src=/js/popper.min.js integrity=sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49 crossorigin=anonymous></script>
<script src=/js/bootstrap.min.js integrity=sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy crossorigin=anonymous></script>
<script src=/js/main.min.3f3f4f1e22307ccbb13271a98be2e4dbb8386b7e67c3d606db44d3d0649f485e.js integrity="sha256-Pz9PHiIwfMuxMnGpi+Lk27g4a35nw9YG20TT0GSfSF4=" crossorigin=anonymous></script>
</body></html>