<!doctype html><html lang=zh class=no-js>
<head>
<meta charset=utf-8>
<meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no">
<meta name=generator content="Hugo 0.93.3">
<meta name=ROBOTS content="INDEX, FOLLOW">
<link rel=canonical type=text/html href=/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/scala/scala-func/>
<link rel="shortcut icon" href=/favicons/favicon.ico>
<link rel=apple-touch-icon href=/favicons/apple-touch-icon-180x180.png sizes=180x180>
<link rel=icon type=image/png href=/favicons/favicon-16x16.png sizes=16x16>
<link rel=icon type=image/png href=/favicons/favicon-32x32.png sizes=32x32>
<link rel=icon type=image/png href=/favicons/android-36x36.png sizes=36x36>
<link rel=icon type=image/png href=/favicons/android-48x48.png sizes=48x48>
<link rel=icon type=image/png href=/favicons/android-72x72.png sizes=72x72>
<link rel=icon type=image/png href=/favicons/android-96x96.png sizes=96x96>
<link rel=icon type=image/png href=/favicons/android-144x144.png sizes=144x144>
<link rel=icon type=image/png href=/favicons/android-192x192.png sizes=192x192>
<title>Scala 函数式 | infilos.com</title><meta property="og:title" content="Scala 函数式">
<meta property="og:description" content="Infilos Wiki Website">
<meta property="og:type" content="website">
<meta property="og:url" content="/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/scala/scala-func/"><meta property="og:site_name" content="infilos.com">
<meta itemprop=name content="Scala 函数式">
<meta itemprop=description content="Infilos Wiki Website"><meta name=twitter:card content="summary">
<meta name=twitter:title content="Scala 函数式">
<meta name=twitter:description content="Infilos Wiki Website">
<script type=application/javascript>var doNotTrack=!1;doNotTrack||(window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-123062585-1","auto"),ga("send","pageview"))</script>
<script async src=https://www.google-analytics.com/analytics.js></script>
<link rel=preload href=/scss/main.min.847464b684a6e89d7276700a5c500c17ab494dd1755b2654a7b27d8b59e3347e.css as=style>
<link href=/scss/main.min.847464b684a6e89d7276700a5c500c17ab494dd1755b2654a7b27d8b59e3347e.css rel=stylesheet integrity>
<script src=/js/jquery-3.5.1.min.js integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin=anonymous></script>
</head><body class=td-section>
<header>
<nav class="js-navbar-scroll navbar navbar-expand-lg navbar-dark td-navbar">
<a class=navbar-brand href=/>
<span class=navbar-logo><svg id="Capa_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 512 512" style="enable-background:new 0 0 512 512"><path style="fill:#ffc107" d="M432.384 143.616c-4.165-4.164-10.917-4.164-15.083.0l-60.352 60.352c-4.164 4.165-4.164 10.917.0 15.083 21.187 20.463 54.951 19.876 75.413-1.311 19.962-20.668 19.962-53.435.0-74.102L432.384 143.616z"/><path style="fill:#607d8b" d="M42.667 277.334c-5.891.003-10.669-4.771-10.672-10.662-.002-4.338 2.623-8.245 6.64-9.882l234.667-96c5.455-2.233 11.687.38 13.92 5.835s-.38 11.687-5.835 13.92l-234.667 96C45.433 277.069 44.056 277.337 42.667 277.334z"/><path style="fill:#546e7a" d="M391.552 56.448l-32-32C343.938 8.745 322.689-.059 300.544.0h-3.755c-46.082.024-83.432 37.374-83.456 83.456v3.755c-.053 22.138 8.75 43.377 24.448 58.987l32 32c4.165 4.164 10.917 4.164 15.083.0L391.531 71.531C395.701 67.372 395.71 60.62 391.552 56.448z"/><path style="fill:#607d8b" d="M160 469.334c-3.279.006-6.379-1.497-8.405-4.075L34.261 315.926c-3.635-4.636-2.823-11.341 1.813-14.976s11.341-2.823 14.976 1.813l117.333 149.333c3.629 4.641 2.809 11.344-1.832 14.973C164.681 468.533 162.375 469.329 160 469.334z"/><path style="fill:#455a64" d="M487.467 86.848l-3.669-3.648c-37.687-36.557-97.71-36.197-134.955.811l-51.413 51.413c-36.996 37.25-37.357 97.263-.811 134.955l3.584 3.669c1.7 2.457 4.671 3.706 7.616 3.2 2.831.005 5.548-1.115 7.552-3.115l172.181-172.181c4.189-4.143 4.226-10.896.083-15.085-.028-.028-.055-.056-.083-.083L487.467 86.848z"/><g><path style="fill:#ffc107" d="M501.333 192H480c-5.891.0-10.667-4.776-10.667-10.667s4.776-10.667 10.667-10.667h21.333c5.891.0 10.667 4.776 10.667 10.667S507.225 192 501.333 192z"/><path style="fill:#ffc107" d="M394.667 298.667c-5.891.0-10.667-4.776-10.667-10.667v-21.333c0-5.891 4.776-10.667 10.667-10.667 5.891.0 10.667 4.776 10.667 10.667V288C405.333 293.891 400.558 298.667 394.667 298.667z"/><path style="fill:#ffc107" d="M480 277.334c-2.831.005-5.548-1.115-7.552-3.115l-21.333-21.333c-4.093-4.237-3.975-10.99.262-15.083 4.134-3.993 10.687-3.993 14.821.0l21.333 21.333c4.159 4.172 4.148 10.926-.024 15.085C485.514 276.209 482.815 277.327 480 277.334z"/></g><g><path style="fill:#455a64" d="M266.667 448H96c-29.455.0-53.333 23.878-53.333 53.333.0 5.891 4.776 10.667 10.667 10.667h256c5.891.0 10.667-4.776 10.667-10.667C320 471.878 296.122 448 266.667 448z"/><circle style="fill:#455a64" cx="32" cy="288" r="32"/></g><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/></svg></span>
<span class=font-weight-bold>infilos.com</span>
</a>
<button class=navbar-toggler type=button data-toggle=collapse data-target=#navbarSupportedContent aria-controls=navbarSupportedContent aria-expanded=false aria-label="Toggle navigation">
<span class=navbar-toggler-icon></span>
</button>
<div class="collapse navbar-collapse" id=navbarSupportedContent>
<ul class="navbar-nav mr-auto">
<li class=nav-item style=max-width:90px;min-width:10px>
<a class=nav-link href=/%e5%9f%ba%e7%a1%80%e7%9f%a5%e8%af%86>
<span>基础</span>
</a>
</li><li class=nav-item style=max-width:90px;min-width:10px>
<a class=nav-link href=/%e7%bc%96%e7%a8%8b%e8%af%ad%e8%a8%80>
<span>语言</span>
</a>
</li><li class=nav-item style=max-width:90px;min-width:10px>
<a class=nav-link href=/%e6%a1%86%e6%9e%b6%e4%b8%8e%e5%ba%93>
<span>框架库</span>
</a>
</li><li class="nav-item dropdown" style=max-width:90px;min-width:10px>
<a class="nav-link dropdown-toggle" href=# id=navbarDropdown role=button data-toggle=dropdown aria-haspopup=true aria-expanded=false>
分布式
<span>+</span>
</a>
<div class=dropdown-menu aria-labelledby=navbarDropdown>
<a class=dropdown-item href=/%e5%88%86%e5%b8%83%e5%bc%8f/base>基本构成</a>
</div></li><li class="nav-item dropdown" style=max-width:90px;min-width:10px>
<a class="nav-link dropdown-toggle" href=# id=navbarDropdown role=button data-toggle=dropdown aria-haspopup=true aria-expanded=false>
大数据
<span>+</span>
</a>
<div class=dropdown-menu aria-labelledby=navbarDropdown>
<a class=dropdown-item href=/%e5%ad%98%e5%82%a8%e7%b3%bb%e7%bb%9f>存储系统</a>
<a class=dropdown-item href=/%e6%9f%a5%e8%af%a2%e7%b3%bb%e7%bb%9f>查询系统</a>
<a class=dropdown-item href=/%e6%b6%88%e6%81%af%e7%b3%bb%e7%bb%9f>消息系统</a>
<a class=dropdown-item href=/%e5%a4%84%e7%90%86%e7%b3%bb%e7%bb%9f>处理系统</a>
<a class=dropdown-item href=/%e6%95%b0%e6%8d%ae%e6%b2%bb%e7%90%86>数据治理</a>
</div></li><li class="nav-item dropdown" style=max-width:90px;min-width:10px>
<a class="nav-link dropdown-toggle" href=# id=navbarDropdown role=button data-toggle=dropdown aria-haspopup=true aria-expanded=false>
中后台
<span>+</span>
</a>
<div class=dropdown-menu aria-labelledby=navbarDropdown>
<a class=dropdown-item href=/%e5%9f%ba%e7%a1%80%e8%ae%be%e6%96%bd>基础设施</a>
<a class=dropdown-item href=/%e7%94%a8%e6%88%b7%e7%b3%bb%e7%bb%9f>用户系统</a>
<a class=dropdown-item href=/%e4%ba%a4%e4%ba%92%e7%95%8c%e9%9d%a2>交互界面</a>
<a class=dropdown-item href=/%e4%b8%9a%e5%8a%a1%e7%b3%bb%e7%bb%9f>业务系统</a>
</div></li><li class=nav-item style=max-width:90px;min-width:10px>
<a class=nav-link href=/%e6%a8%a1%e5%bc%8f%e6%9e%b6%e6%9e%84>
<span>模式架构</span>
</a>
</li><li class=nav-item style=max-width:90px;min-width:10px>
<a class=nav-link href=/%e9%9d%a2%e8%af%95%e9%97%ae%e7%ad%94>
<span>面试</span>
</a>
</li><li class=nav-item style=max-width:90px;min-width:10px>
<a class=nav-link href=/%e7%ae%a1%e7%90%86%e8%b7%af%e5%be%84>
<span>管理</span>
</a>
</li><li class=nav-item style=max-width:90px;min-width:10px>
<a class=nav-link href=/%e5%bc%80%e6%ba%90%e9%a1%b9%e7%9b%ae>
<span>开源</span>
</a>
</li></ul><div class="form-inline my-2 my-lg-0">
<div class="nav-item nav-search-item my-2 my-md-0">
<input type=search class="form-control td-search-input" placeholder="&#xf002; 站内搜索…" aria-label=站内搜索… autocomplete=off>
</div></div></div></nav></header><div class="container-fluid td-outer">
<div class=td-main>
<div class="row flex-xl-nowrap">
<div class="col-12 col-md-3 col-xl-2 td-sidebar d-print-none">
</div><div class="d-none d-xl-block col-xl-2 td-toc d-print-none">
</div><main class="col-12 col-md-9 col-xl-8 pl-md-5" role=main>
<div class=td-content>
<div class="pageinfo pageinfo-primary d-print-none">
<p>
这是本节的多页打印视图。
<a href=# onclick="return print(),!1">点击此处打印</a>.
</p><p>
<a href=/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/scala/scala-func/>返回本页常规视图</a>.
</p></div><h1 class=title>Scala 函数式</h1><ul>
<li>1: <a href=#pg-b337e5ffeb37c04ead4da57f709c79e9>CH00-精要</a></li><li>2: <a href=#pg-2e909366e09c3d91dfac9a94ff86f763>CH01-定义</a></li><li>3: <a href=#pg-03d39ebdea9922f42538e9be1f094c81>CH02-函数</a></li><li>4: <a href=#pg-ea16a70504134b7249c95e29e5f64348>CH03-数据</a></li><li>5: <a href=#pg-6cbae87fa8d5efc949b3b87261ed10fc>CH04-异常</a></li></ul><div class=content>
</div></div><div class=td-content>
<h1 id=pg-b337e5ffeb37c04ead4da57f709c79e9>1 - CH00-精要</h1><h1 id=函数>函数</h1><p>一个函数是一个从“领域”到“代码域”的映射。函数将领域中的每个元素与代码域中的对应元素进行联结。在 Scala 中，领域和代码域都可以表示为<code>type</code>(类型)。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scala data-lang=scala><span style=display:flex><span><span style=color:#204a87;font-weight:700>val</span> <span style=color:#000>square</span><span style=color:#204a87;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>Int</span> <span style=color:#ce5c00;font-weight:700>=&gt;</span> <span style=color:#000>Int</span> <span style=color:#204a87;font-weight:700>=</span> <span style=color:#000>x</span> <span style=color:#204a87;font-weight:700>=&gt;</span> <span style=color:#000>x</span> <span style=color:#ce5c00;font-weight:700>*</span> <span style=color:#000>x</span>
</span></span><span style=display:flex><span><span style=color:#000>square</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>2</span><span style=color:#ce5c00;font-weight:700>)</span> 	<span style=color:#8f5902;font-style:italic>// 4
</span></span></span></code></pre></div><h2 id=高阶函数>高阶函数</h2><p>高阶函数是 接收一个函数作为参数 或 返回一个函数作为结果 的函数。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scala data-lang=scala><span style=display:flex><span><span style=color:#204a87;font-weight:700>trait</span> <span style=color:#000>List</span><span style=color:#ce5c00;font-weight:700>[</span><span style=color:#204a87;font-weight:700>A</span><span style=color:#ce5c00;font-weight:700>]</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>def</span> <span style=color:#000>filter</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>f</span><span style=color:#204a87;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>A</span> <span style=color:#ce5c00;font-weight:700>=&gt;</span> <span style=color:#000>Boolean</span><span style=color:#ce5c00;font-weight:700>)</span><span style=color:#204a87;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>List</span><span style=color:#ce5c00;font-weight:700>[</span><span style=color:#204a87;font-weight:700>A</span><span style=color:#ce5c00;font-weight:700>]</span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>}</span>
</span></span></code></pre></div><p>这个例子中，函数<code>filter</code>接收一个类型为<code>A => Boolean</code>的函数作为参数。</p><h3 id=组合子>组合子</h3><p>函数组合子是同时接收、返回函数的高阶函数。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scala data-lang=scala><span style=display:flex><span><span style=color:#204a87;font-weight:700>type</span> <span style=color:#204a87;font-weight:700>Conf</span><span style=color:#ce5c00;font-weight:700>[</span><span style=color:#204a87;font-weight:700>A</span><span style=color:#ce5c00;font-weight:700>]</span> <span style=color:#204a87;font-weight:700>=</span> <span style=color:#000>ConfigReader</span> <span style=color:#204a87;font-weight:700>=&gt;</span> <span style=color:#000>A</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>def</span> <span style=color:#000>string</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>name</span><span style=color:#204a87;font-weight:700>:</span><span style=color:#204a87;font-weight:700>String</span><span style=color:#ce5c00;font-weight:700>)</span><span style=color:#204a87;font-weight:700>:</span><span style=color:#204a87;font-weight:700>Conf</span><span style=color:#ce5c00;font-weight:700>[</span><span style=color:#204a87;font-weight:700>String</span><span style=color:#ce5c00;font-weight:700>]</span> <span style=color:#204a87;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>_</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>readString</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>name</span><span style=color:#ce5c00;font-weight:700>)</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>def</span> <span style=color:#000>both</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>left</span><span style=color:#204a87;font-weight:700>:</span><span style=color:#204a87;font-weight:700>Conf</span><span style=color:#ce5c00;font-weight:700>[</span><span style=color:#204a87;font-weight:700>A</span><span style=color:#ce5c00;font-weight:700>],</span> <span style=color:#000>right</span><span style=color:#204a87;font-weight:700>:</span><span style=color:#204a87;font-weight:700>Conf</span><span style=color:#ce5c00;font-weight:700>[</span><span style=color:#204a87;font-weight:700>B</span><span style=color:#ce5c00;font-weight:700>])</span><span style=color:#204a87;font-weight:700>:</span><span style=color:#204a87;font-weight:700>Conf</span><span style=color:#ce5c00;font-weight:700>[(</span><span style=color:#204a87;font-weight:700>A</span>, <span style=color:#204a87;font-weight:700>B</span><span style=color:#ce5c00;font-weight:700>)]</span> <span style=color:#204a87;font-weight:700>=</span> <span style=color:#000>c</span> <span style=color:#204a87;font-weight:700>=&gt;</span> <span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>left</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>c</span><span style=color:#ce5c00;font-weight:700>),</span> <span style=color:#000>right</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>c</span><span style=color:#ce5c00;font-weight:700>))</span>
</span></span></code></pre></div><p>函数<code>both</code>即为一个接收函数并返回函数的高阶函数。</p><h3 id=多态函数>多态函数</h3><p>多态函数通常拥有一个或多个<strong>类型参数</strong>。Scala 本身对多态函数没有支持，但是可以通过<strong>特质的多态方法</strong>来实现。构造多态函数的特质通常拥有<code>apply</code>方法，因此，可以像普通的函数应用语法一样使用：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scala data-lang=scala><span style=display:flex><span><span style=color:#204a87;font-weight:700>case</span> <span style=color:#204a87;font-weight:700>object</span> <span style=color:#000>identity</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>def</span> <span style=color:#000>apply</span><span style=color:#ce5c00;font-weight:700>[</span><span style=color:#204a87;font-weight:700>T</span><span style=color:#ce5c00;font-weight:700>](</span><span style=color:#000>value</span><span style=color:#204a87;font-weight:700>:</span><span style=color:#204a87;font-weight:700>T</span><span style=color:#ce5c00;font-weight:700>)</span><span style=color:#204a87;font-weight:700>:</span><span style=color:#204a87;font-weight:700>T</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>value</span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span><span style=color:#000>identity</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>3</span><span style=color:#ce5c00;font-weight:700>)</span>		<span style=color:#8f5902;font-style:italic>// 3
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#000>indentity</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;3&#34;</span><span style=color:#ce5c00;font-weight:700>)</span>	<span style=color:#8f5902;font-style:italic>// &#34;3&#34;
</span></span></span></code></pre></div><p>这样，通过<code>apply</code>方法的便利，就可以实现多态函数。</p><h1 id=类型>类型</h1><p>一个<strong>类型</strong>是<strong>一组值</strong>的<strong>运行时描述</strong>。比如<code>Int</code>表示从<code>-2147483648</code>到<code>2147483647</code>这样的一组整数集。值都拥有类型，或者说，每个值都表示一组值的一个成员。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scala data-lang=scala><span style=display:flex><span><span style=color:#0000cf;font-weight:700>2</span><span style=color:#204a87;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>Int</span>
</span></span></code></pre></div><p>例子中，<code>2</code>是<code>Int</code>集合的一个成员，也即，<code>2</code>的类型为<code>Int</code>。</p><h2 id=代数数据类型adt>代数数据类型(ADT)</h2><p>一个 ADT 是由<strong>产品</strong>和<strong>类型</strong>自合而成的类型。</p><h3 id=乘积类型product>乘积类型(product)</h3><p>乘积类型是由两个或多个类型的笛卡尔积组合构造而成的。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scala data-lang=scala><span style=display:flex><span><span style=color:#204a87;font-weight:700>type</span> <span style=color:#204a87;font-weight:700>Point2D</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>Int</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>Int</span><span style=color:#ce5c00;font-weight:700>)</span>
</span></span></code></pre></div><p>例子中，一个二维点是一个数字与另一个数字的积。即每个该类型的值都有一个 x 轴坐标和 y 轴坐标。</p><h3 id=样例类>样例类</h3><p>在 Scala 中，样例类是更符合语言习惯的乘积类型表示。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scala data-lang=scala><span style=display:flex><span><span style=color:#204a87;font-weight:700>case</span> <span style=color:#204a87;font-weight:700>class</span> <span style=color:#000>Person</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>name</span><span style=color:#204a87;font-weight:700>:</span><span style=color:#204a87;font-weight:700>String</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>age</span><span style=color:#204a87;font-weight:700>:</span><span style=color:#204a87;font-weight:700>Int</span><span style=color:#ce5c00;font-weight:700>)</span>
</span></span></code></pre></div><h3 id=总和类型sum>总和类型(sum)</h3><p>总和类型通过两个或多个类型的<strong>不相交</strong>形式来定义。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scala data-lang=scala><span style=display:flex><span><span style=color:#204a87;font-weight:700>type</span> <span style=color:#204a87;font-weight:700>RequestResponse</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>Either</span><span style=color:#ce5c00;font-weight:700>[</span><span style=color:#204a87;font-weight:700>Error</span>, <span style=color:#204a87;font-weight:700>HttpResponse</span><span style=color:#ce5c00;font-weight:700>]</span>
</span></span></code></pre></div><p>例子中，定义的类型<code>RequestResponse</code>是<code>Error</code>和<code>HttpResponse</code>的总和构成，一个<code>RequestResponse</code>类型的值要么是一个 error，要么是一个 HTTP 响应。</p><h4 id=密闭特质>密闭特质</h4><p>在 Scala 中，密闭特质是更符合语言习惯的总和类型表示。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scala data-lang=scala><span style=display:flex><span><span style=color:#204a87;font-weight:700>sealed</span> <span style=color:#204a87;font-weight:700>trait</span> <span style=color:#000>AddressType</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>case</span> <span style=color:#204a87;font-weight:700>object</span> <span style=color:#000>Home</span> <span style=color:#204a87;font-weight:700>extends</span> <span style=color:#000>AddressType</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>case</span> <span style=color:#204a87;font-weight:700>object</span> <span style=color:#000>Business</span> <span style=color:#204a87;font-weight:700>extends</span> <span style=color:#000>AddressType</span>
</span></span></code></pre></div><p>例子中，一个<code>AddressType</code>要么是一个<code>Home</code>，要么是一个<code>Buiness</code>，而不能同时是两者。</p><h3 id=子类型>子类型</h3><p>如果<code>A</code>是<code>B</code>的子集，<code>A</code>即为<code>B</code>的子类型。在 Scala 中，<code>A</code>必须继承自<code>B</code>。编译器允许在任何需要的地方使用子类型。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scala data-lang=scala><span style=display:flex><span><span style=color:#204a87;font-weight:700>sealed</span> <span style=color:#204a87;font-weight:700>trait</span> <span style=color:#000>Shape</span><span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>def</span> <span style=color:#000>width</span><span style=color:#204a87;font-weight:700>:</span><span style=color:#204a87;font-weight:700>Int</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>def</span> <span style=color:#000>height</span><span style=color:#204a87;font-weight:700>:</span><span style=color:#204a87;font-weight:700>Int</span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>case</span> <span style=color:#204a87;font-weight:700>class</span> <span style=color:#000>Rectangle</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>corner</span><span style=color:#204a87;font-weight:700>:</span><span style=color:#204a87;font-weight:700>Point2D</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>width</span><span style=color:#204a87;font-weight:700>:</span><span style=color:#204a87;font-weight:700>Int</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>height</span><span style=color:#204a87;font-weight:700>:</span><span style=color:#204a87;font-weight:700>Int</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#204a87;font-weight:700>extends</span> <span style=color:#000>Shape</span>
</span></span></code></pre></div><h3 id=超类型>超类型</h3><p>如果<code>B</code>是<code>A</code>的子集，<code>A</code>即为<code>B</code>的超类型，<code>B</code>必须继承自<code>A</code>。编译器支持无论在何处定义子类型，均可以使用超类型。</p><p>同样还是上面的例子，<code>Shape</code>即为<code>Rectangle</code>的超类。</p><h3 id=universals>Universals</h3><p>一个通用(universally)量化类型定义了一个“由一些任意类型参数化的类型”的类别。在 Scala 中，类型构造器(比如特质)和方法必须是通用量化类型，尽管方法并不拥有一个类型，它只是类型的一部分。</p><h3 id=类型构造器>类型构造器</h3><p>一个类型构造器是一个通用量化类型，用于构造类型。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scala data-lang=scala><span style=display:flex><span><span style=color:#204a87;font-weight:700>sealed</span> <span style=color:#204a87;font-weight:700>trait</span> <span style=color:#000>List</span><span style=color:#ce5c00;font-weight:700>[</span><span style=color:#204a87;font-weight:700>A</span><span style=color:#ce5c00;font-weight:700>]</span>
</span></span><span style=display:flex><span><span style=color:#000>case</span> <span style=color:#204a87;font-weight:700>class</span> <span style=color:#000>Nil</span><span style=color:#ce5c00;font-weight:700>[</span><span style=color:#204a87;font-weight:700>A</span><span style=color:#ce5c00;font-weight:700>]()</span> <span style=color:#204a87;font-weight:700>extends</span> <span style=color:#000>List</span><span style=color:#ce5c00;font-weight:700>[</span><span style=color:#204a87;font-weight:700>A</span><span style=color:#ce5c00;font-weight:700>]</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>case</span> <span style=color:#204a87;font-weight:700>class</span> <span style=color:#000>Cons</span><span style=color:#ce5c00;font-weight:700>[</span><span style=color:#204a87;font-weight:700>A</span><span style=color:#ce5c00;font-weight:700>](</span><span style=color:#000>head</span><span style=color:#204a87;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>A</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>List</span><span style=color:#ce5c00;font-weight:700>[</span><span style=color:#204a87;font-weight:700>A</span><span style=color:#ce5c00;font-weight:700>])</span> <span style=color:#204a87;font-weight:700>extends</span> <span style=color:#000>List</span><span style=color:#ce5c00;font-weight:700>[</span><span style=color:#204a87;font-weight:700>A</span><span style=color:#ce5c00;font-weight:700>]</span>
</span></span></code></pre></div><p>例子中，<code>List</code>是一个类型构造器，定义了一组<code>List-</code>类似的类型。因此可以认为，<code>List</code>是针对类型<code>A</code>的通用类型量化。</p><h2 id=高阶类型>高阶类型</h2><h3 id=类型级别函数type-level>类型级别函数(Type-Level)</h3><p>类型构造器可以看做一个类型级别函数，它接收类型并返回类型。这种解释对于理解高阶类型很有用。</p><p>比如，<code>List</code>是一个接收类型<code>A</code>并返回类型<code>List[A]</code>的类型级别函数。</p><h3 id=类别kind>类别(Kind)</h3><p>类别可以认为是“类型的类型”。</p><ul>
<li><code>*</code>：类型的类别，所有类型的集合。</li><li><code>* => *</code>：类型级别函数的类别(接收一个类型，返回一个类型)。</li><li><code>[*, *] => *</code>：接收两个类型并返回一个类型的类型级别函数 的类别。比如类型构造器<code>Either</code>的类别是<code>[*, *] => *</code>，Scala 语法表示成<code>_[_, _]</code>。</li></ul><blockquote>
<p>可以与函数的类型进行对比：<code>A => B</code>，<code>A => B => C</code></p></blockquote><h3 id=高阶类别higher-order-kinds>高阶类别(Higher-Order Kinds)</h3><p>就像函数能够是高阶函数一样，类型构造器也可以是高阶的。Scala 中使用下划线编码(encode)高阶类型构造器。<code>trait CollectionModule[Collection[_]]</code>表示<code>CollectionModule</code>的类型构造器需要提供一个<code>* -> *</code>类别的类型构造器，比如<code>List</code>。</p><ul>
<li><code>(* => *) => *</code>：类型构造器的类别，它接收一个<code>* => *</code> 类别的类型构造器。比如：<code>trait Functor[F[_]] {...}</code>或<code>trait Monad[F[_]] {...}</code>。</li></ul><h2 id=existentials>Existentials</h2><p>一个“存在量化类型”定义一个基于一些明确但又未知的类型 的类型。“存在判断的类型”用于隐藏一些并非全局相关的类型信息。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scala data-lang=scala><span style=display:flex><span><span style=color:#204a87;font-weight:700>trait</span> <span style=color:#000>ListMap</span><span style=color:#ce5c00;font-weight:700>[</span><span style=color:#204a87;font-weight:700>A</span><span style=color:#ce5c00;font-weight:700>]{</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>type</span> <span style=color:#204a87;font-weight:700>B</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>val</span> <span style=color:#000>list</span><span style=color:#204a87;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>List</span><span style=color:#ce5c00;font-weight:700>[</span><span style=color:#204a87;font-weight:700>B</span><span style=color:#ce5c00;font-weight:700>]</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>val</span> <span style=color:#000>mapf</span><span style=color:#204a87;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>B</span> <span style=color:#ce5c00;font-weight:700>=&gt;</span> <span style=color:#000>A</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>def</span> <span style=color:#000>run</span><span style=color:#204a87;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>List</span><span style=color:#ce5c00;font-weight:700>[</span><span style=color:#204a87;font-weight:700>A</span><span style=color:#ce5c00;font-weight:700>]</span> <span style=color:#204a87;font-weight:700>=</span> <span style=color:#000>list</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>map</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>mapf</span><span style=color:#ce5c00;font-weight:700>)</span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>}</span>
</span></span></code></pre></div><p>例子中，类型<code>ListMap[A]#B</code>是一些明确类型，但是有不能知道其真正类型，它可能是任何类型。</p><h3 id=skolemization>Skolemization</h3><p>每个“存在判断的类型”都可以被编码为一个通用(universal)类型。这个过程称为<strong>Skolemization</strong>。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scala data-lang=scala><span style=display:flex><span><span style=color:#204a87;font-weight:700>case</span> <span style=color:#204a87;font-weight:700>class</span> <span style=color:#000>ListMap</span><span style=color:#ce5c00;font-weight:700>[</span><span style=color:#204a87;font-weight:700>B</span>, <span style=color:#204a87;font-weight:700>A</span><span style=color:#ce5c00;font-weight:700>](</span><span style=color:#000>list</span><span style=color:#204a87;font-weight:700>:</span><span style=color:#204a87;font-weight:700>List</span><span style=color:#ce5c00;font-weight:700>[</span><span style=color:#204a87;font-weight:700>B</span><span style=color:#ce5c00;font-weight:700>],</span> <span style=color:#000>mapf</span><span style=color:#204a87;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>B</span> <span style=color:#ce5c00;font-weight:700>=&gt;</span> <span style=color:#000>A</span><span style=color:#ce5c00;font-weight:700>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>trait</span> <span style=color:#000>ListMapInspector</span><span style=color:#ce5c00;font-weight:700>[</span><span style=color:#204a87;font-weight:700>A</span>,<span style=color:#204a87;font-weight:700>Z</span><span style=color:#ce5c00;font-weight:700>]</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>def</span> <span style=color:#000>apply</span><span style=color:#ce5c00;font-weight:700>[</span><span style=color:#204a87;font-weight:700>B</span><span style=color:#ce5c00;font-weight:700>](</span><span style=color:#000>value</span><span style=color:#204a87;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>ListMap</span><span style=color:#ce5c00;font-weight:700>[</span><span style=color:#204a87;font-weight:700>B</span>, <span style=color:#204a87;font-weight:700>A</span><span style=color:#ce5c00;font-weight:700>])</span><span style=color:#204a87;font-weight:700>:</span><span style=color:#204a87;font-weight:700>Z</span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>case</span> <span style=color:#204a87;font-weight:700>class</span> <span style=color:#000>AnyListMap</span><span style=color:#ce5c00;font-weight:700>[</span><span style=color:#204a87;font-weight:700>A</span><span style=color:#ce5c00;font-weight:700>]</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>def</span> <span style=color:#000>apply</span><span style=color:#ce5c00;font-weight:700>[</span><span style=color:#204a87;font-weight:700>Z</span><span style=color:#ce5c00;font-weight:700>](</span><span style=color:#000>value</span><span style=color:#204a87;font-weight:700>:</span><span style=color:#204a87;font-weight:700>ListMapInspector</span><span style=color:#ce5c00;font-weight:700>[</span><span style=color:#204a87;font-weight:700>A</span>, <span style=color:#204a87;font-weight:700>Z</span><span style=color:#ce5c00;font-weight:700>])</span><span style=color:#204a87;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>Z</span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>}</span>
</span></span></code></pre></div><p>例子中，除了我们直接使用<code>ListMap</code>，还可以使用<code>AnyListMap</code>，仅当能够为<code>B</code>处理任何类型参数时允许我们对<code>ListMap</code>进行检查。</p><h2 id=type-lambdas>Type Lambdas</h2><p>函数可以通过使用下划线操作符编程“偏应用型(partially apply)”。比如，<code>zip(a, _)</code>。一个类型匿名函数是偏应用“高阶类别”类型的一种方式，使用较少的类型参数来生成一个新的类型构造器。</p><p>类型匿名函数之于类型构造器，相当于匿名函数之于函数。一个是类型、值的表达式，一个声明：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scala data-lang=scala><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>({</span><span style=color:#204a87;font-weight:700>type</span> <span style=color:#204a87;font-weight:700>λ</span><span style=color:#ce5c00;font-weight:700>[</span><span style=color:#204a87;font-weight:700>α</span><span style=color:#ce5c00;font-weight:700>]</span> <span style=color:#204a87;font-weight:700>=</span> <span style=color:#000>Either</span><span style=color:#ce5c00;font-weight:700>[</span><span style=color:#204a87;font-weight:700>String</span>, <span style=color:#204a87;font-weight:700>α</span><span style=color:#ce5c00;font-weight:700>]})</span><span style=color:#204a87;font-weight:700>#</span><span style=color:#000>λ</span>
</span></span></code></pre></div><p>例子中，<code>Either</code>通过偏应用一个<code>String</code>作为第一个类型参数。</p><p>较多场景中，会使用**类型别名(type aliase)**替代类型匿名函数，比如：<code>type EitherString[A] = Either[String, A]</code>。</p><h3 id=类别投影器projector>类别投影器(Projector)</h3><p>类别投影器是一个常用的 Scala 编译器插件，提供了更易用的语法来创建类型匿名函数。比如，<code>({type λ[α] = Either[String, α]})#λ</code>可以表示为<code>Either[String, ?]</code>这样的语法。另外有更多语法来创建更复杂的类型匿名函数。</p><p><a href=https://github.com/non/kind-projector>https://github.com/non/kind-projector</a></p><h1 id=类型类>类型类</h1><p>一个类型类是对类型和定义在该类上操作的收集。很多类型类会定义一些规则需要实现来遵守。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scala data-lang=scala><span style=display:flex><span><span style=color:#204a87;font-weight:700>trait</span> <span style=color:#000>ShowRead</span><span style=color:#ce5c00;font-weight:700>[</span><span style=color:#204a87;font-weight:700>A</span><span style=color:#ce5c00;font-weight:700>]</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>def</span> <span style=color:#000>show</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>v</span><span style=color:#204a87;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>A</span><span style=color:#ce5c00;font-weight:700>)</span><span style=color:#204a87;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>String</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>def</span> <span style=color:#000>read</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>v</span><span style=color:#204a87;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>String</span><span style=color:#ce5c00;font-weight:700>)</span><span style=color:#204a87;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>Either</span><span style=color:#ce5c00;font-weight:700>[</span><span style=color:#204a87;font-weight:700>String</span>, <span style=color:#204a87;font-weight:700>A</span><span style=color:#ce5c00;font-weight:700>]</span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>object</span> <span style=color:#000>ShowRead</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>def</span> <span style=color:#000>apply</span><span style=color:#ce5c00;font-weight:700>[</span><span style=color:#204a87;font-weight:700>A</span><span style=color:#ce5c00;font-weight:700>](</span><span style=color:#204a87;font-weight:700>implicit</span> <span style=color:#000>v</span><span style=color:#204a87;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>ShowRead</span><span style=color:#ce5c00;font-weight:700>[</span><span style=color:#204a87;font-weight:700>A</span><span style=color:#ce5c00;font-weight:700>])</span><span style=color:#204a87;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>ShowRead</span><span style=color:#ce5c00;font-weight:700>[</span><span style=color:#204a87;font-weight:700>A</span><span style=color:#ce5c00;font-weight:700>]</span> <span style=color:#204a87;font-weight:700>=</span> <span style=color:#000>v</span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>}</span>
</span></span></code></pre></div><p>例子中，类型类<code>ShowRead[A]</code>定义了通过渲染字符串来显示类型<code>A</code>，并通过读取字符串来读取它，或是生成一个错误消息。</p><ul>
<li>
<p>Right Identity</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scala data-lang=scala><span style=display:flex><span><span style=color:#000>read</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>show</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>v</span><span style=color:#ce5c00;font-weight:700>))</span> <span style=color:#ce5c00;font-weight:700>==</span> <span style=color:#000>Right</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>v</span><span style=color:#ce5c00;font-weight:700>)</span>
</span></span></code></pre></div></li><li>
<p>Left Partial Identity</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scala data-lang=scala><span style=display:flex><span><span style=color:#000>read</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>v</span><span style=color:#ce5c00;font-weight:700>).</span><span style=color:#000>map</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>show</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#204a87;font-weight:700>_</span><span style=color:#ce5c00;font-weight:700>)).</span><span style=color:#000>fold</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#204a87;font-weight:700>_</span> <span style=color:#204a87;font-weight:700>=&gt;</span> <span style=color:#204a87;font-weight:700>true</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#204a87;font-weight:700>_</span> <span style=color:#ce5c00;font-weight:700>==</span> <span style=color:#000>v</span><span style=color:#ce5c00;font-weight:700>)</span>
</span></span></code></pre></div></li></ul><h2 id=实例>实例</h2><p>一个类型类的实例就是通过提供一组类型来定义一个该类型类的实现。一般这些事例会被标记为<code>imolicit</code>，以便编译器能够自动为需要的函数提供这些实现。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scala data-lang=scala><span style=display:flex><span><span style=color:#204a87;font-weight:700>implicit</span> <span style=color:#204a87;font-weight:700>val</span> <span style=color:#000>ShowReadString</span><span style=color:#204a87;font-weight:700>:</span><span style=color:#204a87;font-weight:700>ShowRead</span><span style=color:#ce5c00;font-weight:700>[</span><span style=color:#204a87;font-weight:700>String</span><span style=color:#ce5c00;font-weight:700>]</span> <span style=color:#204a87;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>ShowRead</span><span style=color:#ce5c00;font-weight:700>[</span><span style=color:#204a87;font-weight:700>String</span><span style=color:#ce5c00;font-weight:700>]</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>def</span> <span style=color:#000>show</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>v</span><span style=color:#204a87;font-weight:700>:</span><span style=color:#204a87;font-weight:700>String</span><span style=color:#ce5c00;font-weight:700>)</span><span style=color:#204a87;font-weight:700>:</span><span style=color:#204a87;font-weight:700>String</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>v</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>def</span> <span style=color:#000>read</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>v</span><span style=color:#204a87;font-weight:700>:</span><span style=color:#204a87;font-weight:700>String</span><span style=color:#ce5c00;font-weight:700>)</span><span style=color:#204a87;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>Either</span><span style=color:#ce5c00;font-weight:700>[</span><span style=color:#204a87;font-weight:700>String</span>, <span style=color:#204a87;font-weight:700>String</span><span style=color:#ce5c00;font-weight:700>]</span> <span style=color:#204a87;font-weight:700>=</span> <span style=color:#000>Right</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>v</span><span style=color:#ce5c00;font-weight:700>)</span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>}</span>
</span></span></code></pre></div><h2 id=语法>语法</h2><p>便利的语法，或称为扩展方法，添加给类型以便这些类型类更加易用：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scala data-lang=scala><span style=display:flex><span><span style=color:#204a87;font-weight:700>implicit</span> <span style=color:#204a87;font-weight:700>class</span> <span style=color:#000>ShowOps</span><span style=color:#ce5c00;font-weight:700>[</span><span style=color:#204a87;font-weight:700>A:ShowRead</span><span style=color:#ce5c00;font-weight:700>](</span><span style=color:#000>self</span><span style=color:#204a87;font-weight:700>:</span><span style=color:#204a87;font-weight:700>A</span><span style=color:#ce5c00;font-weight:700>){</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>def</span> <span style=color:#000>show</span><span style=color:#204a87;font-weight:700>:</span><span style=color:#204a87;font-weight:700>String</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>ShowRead</span><span style=color:#ce5c00;font-weight:700>[</span><span style=color:#204a87;font-weight:700>A</span><span style=color:#ce5c00;font-weight:700>].</span><span style=color:#000>show</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>self</span><span style=color:#ce5c00;font-weight:700>)</span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>implicit</span> <span style=color:#204a87;font-weight:700>class</span> <span style=color:#000>ReadOps</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>self</span><span style=color:#204a87;font-weight:700>:</span><span style=color:#204a87;font-weight:700>String</span><span style=color:#ce5c00;font-weight:700>){</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>def</span> <span style=color:#000>read</span><span style=color:#ce5c00;font-weight:700>[</span><span style=color:#204a87;font-weight:700>A:ShowRead</span><span style=color:#ce5c00;font-weight:700>]</span><span style=color:#204a87;font-weight:700>:</span><span style=color:#204a87;font-weight:700>Either</span><span style=color:#ce5c00;font-weight:700>[</span><span style=color:#204a87;font-weight:700>String</span>, <span style=color:#204a87;font-weight:700>A</span><span style=color:#ce5c00;font-weight:700>]</span> <span style=color:#204a87;font-weight:700>=</span> <span style=color:#000>ShowRead</span><span style=color:#ce5c00;font-weight:700>[</span><span style=color:#204a87;font-weight:700>A</span><span style=color:#ce5c00;font-weight:700>].</span><span style=color:#000>read</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>self</span><span style=color:#ce5c00;font-weight:700>)</span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>}</span>
</span></span></code></pre></div><h1 id=函数式模式>函数式模式</h1><h2 id=optioneithervalidation>Option、Either、Validation</h2><p>这些类型均用来表示可选性和偏应用性：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scala data-lang=scala><span style=display:flex><span><span style=color:#000>seald</span> <span style=color:#204a87;font-weight:700>trait</span> <span style=color:#000>Maybe</span><span style=color:#ce5c00;font-weight:700>[</span><span style=color:#204a87;font-weight:700>A</span><span style=color:#ce5c00;font-weight:700>]</span>
</span></span><span style=display:flex><span><span style=color:#000>final</span> <span style=color:#204a87;font-weight:700>case</span> <span style=color:#204a87;font-weight:700>class</span> <span style=color:#000>Just</span><span style=color:#ce5c00;font-weight:700>[</span><span style=color:#204a87;font-weight:700>A</span><span style=color:#ce5c00;font-weight:700>](</span><span style=color:#000>value</span><span style=color:#204a87;font-weight:700>:</span><span style=color:#204a87;font-weight:700>A</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#204a87;font-weight:700>extends</span> <span style=color:#000>Maybe</span><span style=color:#ce5c00;font-weight:700>[</span><span style=color:#204a87;font-weight:700>A</span><span style=color:#ce5c00;font-weight:700>]</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>final</span> <span style=color:#204a87;font-weight:700>case</span> <span style=color:#204a87;font-weight:700>class</span> <span style=color:#000>Empty</span><span style=color:#ce5c00;font-weight:700>[</span><span style=color:#204a87;font-weight:700>A</span><span style=color:#ce5c00;font-weight:700>]()</span> <span style=color:#204a87;font-weight:700>extends</span> <span style=color:#000>Maybe</span><span style=color:#ce5c00;font-weight:700>[</span><span style=color:#204a87;font-weight:700>A</span><span style=color:#ce5c00;font-weight:700>]</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>sealed</span> <span style=color:#204a87;font-weight:700>trait</span> <span style=color:#000>\/</span><span style=color:#ce5c00;font-weight:700>[</span><span style=color:#204a87;font-weight:700>A</span>, <span style=color:#204a87;font-weight:700>B</span><span style=color:#ce5c00;font-weight:700>]</span>
</span></span><span style=display:flex><span><span style=color:#000>final</span> <span style=color:#204a87;font-weight:700>case</span> <span style=color:#204a87;font-weight:700>class</span> <span style=color:#000>-\/</span><span style=color:#ce5c00;font-weight:700>[</span><span style=color:#204a87;font-weight:700>A</span>, <span style=color:#204a87;font-weight:700>B</span><span style=color:#ce5c00;font-weight:700>](</span><span style=color:#000>value</span><span style=color:#204a87;font-weight:700>:</span><span style=color:#204a87;font-weight:700>A</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#204a87;font-weight:700>extends</span> <span style=color:#000>\</span><span style=color:#ce5c00;font-weight:700>/[</span><span style=color:#204a87;font-weight:700>A</span>, <span style=color:#204a87;font-weight:700>B</span><span style=color:#ce5c00;font-weight:700>]</span>
</span></span><span style=display:flex><span><span style=color:#000>fianl</span> <span style=color:#204a87;font-weight:700>case</span> <span style=color:#204a87;font-weight:700>class</span> <span style=color:#000>\/-</span><span style=color:#ce5c00;font-weight:700>[</span><span style=color:#204a87;font-weight:700>A</span>, <span style=color:#204a87;font-weight:700>B</span><span style=color:#ce5c00;font-weight:700>](</span><span style=color:#000>value</span><span style=color:#204a87;font-weight:700>:</span><span style=color:#204a87;font-weight:700>B</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#204a87;font-weight:700>extends</span> <span style=color:#000>\</span><span style=color:#ce5c00;font-weight:700>/[</span><span style=color:#204a87;font-weight:700>A</span>, <span style=color:#204a87;font-weight:700>B</span><span style=color:#ce5c00;font-weight:700>]</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>type</span> <span style=color:#204a87;font-weight:700>Either</span><span style=color:#ce5c00;font-weight:700>[</span><span style=color:#204a87;font-weight:700>A</span>, <span style=color:#204a87;font-weight:700>B</span><span style=color:#ce5c00;font-weight:700>]</span> <span style=color:#204a87;font-weight:700>=</span> <span style=color:#000>A</span> <span style=color:#000>\</span><span style=color:#ce5c00;font-weight:700>/</span> <span style=color:#000>B</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>sealed</span> <span style=color:#204a87;font-weight:700>trait</span> <span style=color:#000>Validation</span><span style=color:#ce5c00;font-weight:700>[</span><span style=color:#204a87;font-weight:700>A</span>, <span style=color:#204a87;font-weight:700>B</span><span style=color:#ce5c00;font-weight:700>]</span>
</span></span><span style=display:flex><span><span style=color:#000>final</span> <span style=color:#204a87;font-weight:700>case</span> <span style=color:#204a87;font-weight:700>class</span> <span style=color:#000>Failure</span><span style=color:#ce5c00;font-weight:700>[</span><span style=color:#204a87;font-weight:700>A</span>, <span style=color:#204a87;font-weight:700>B</span><span style=color:#ce5c00;font-weight:700>](</span><span style=color:#000>value</span><span style=color:#204a87;font-weight:700>:</span><span style=color:#204a87;font-weight:700>A</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#204a87;font-weight:700>extends</span> <span style=color:#000>Validation</span><span style=color:#ce5c00;font-weight:700>[</span><span style=color:#204a87;font-weight:700>A</span>, <span style=color:#204a87;font-weight:700>B</span><span style=color:#ce5c00;font-weight:700>]</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>final</span> <span style=color:#204a87;font-weight:700>case</span> <span style=color:#204a87;font-weight:700>class</span> <span style=color:#000>Success</span><span style=color:#ce5c00;font-weight:700>[</span><span style=color:#204a87;font-weight:700>A</span>, <span style=color:#204a87;font-weight:700>B</span><span style=color:#ce5c00;font-weight:700>](</span><span style=color:#000>value</span><span style=color:#204a87;font-weight:700>:</span><span style=color:#204a87;font-weight:700>B</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#204a87;font-weight:700>extends</span> <span style=color:#000>Validation</span><span style=color:#ce5c00;font-weight:700>[</span><span style=color:#204a87;font-weight:700>A</span>, <span style=color:#204a87;font-weight:700>B</span><span style=color:#ce5c00;font-weight:700>]</span>
</span></span></code></pre></div><h2 id=半群幺半群semigroup-monoid>半群、幺半群(Semigroup, Monoid)</h2><p>半群支持将两个相同类型的东西组合成另一个新的相同类型的东西。比如，加法操作构成一个基于整数的半群。幺半群怎加一个额外的拥有“零”元素的属性，比如添加给一个值而不改变该值。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>trait Semigroup[A]
</span></span></code></pre></div><p><a href=https://gist.github.com/jdegoes/97459c0045f373f4eaf126998d8f65dc>未完。。。</a></p><p><a href=https://wiki.scala-lang.org/display/SW/Parser+Combinators--Getting+Started>https://wiki.scala-lang.org/display/SW/Parser+Combinators&ndash;Getting+Started</a></p></div><div class=td-content style=page-break-before:always>
<h1 id=pg-2e909366e09c3d91dfac9a94ff86f763>2 - CH01-定义</h1><h2 id=介绍>介绍</h2><p>函数式编程，只是用<strong>纯函数</strong>来构造程序，即函数是没有副作用的。</p><p>函数的副作用大致包括：</p><ul>
<li>修改一个变量</li><li>直接修改数据结构</li><li>设置一个对象的成员</li><li>抛出一个异常或以一个错误停止</li><li>打印到终端或者接收用户的输入</li><li>读取或写入一个文件</li><li>在屏幕上绘图</li><li>&mldr;</li></ul><h2 id=函数式编程的益处>函数式编程的益处</h2><h3 id=副作用函数的实例>副作用函数的实例</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scala data-lang=scala><span style=display:flex><span><span style=color:#204a87;font-weight:700>class</span> <span style=color:#000>Cafe</span><span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>def</span> <span style=color:#000>buyCoffee</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>cc</span><span style=color:#204a87;font-weight:700>:</span><span style=color:#204a87;font-weight:700>CreditCard</span><span style=color:#ce5c00;font-weight:700>)</span><span style=color:#204a87;font-weight:700>:</span><span style=color:#204a87;font-weight:700>Coffee</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>  	<span style=color:#204a87;font-weight:700>val</span> <span style=color:#000>cup</span> <span style=color:#204a87;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>Coffee</span><span style=color:#ce5c00;font-weight:700>()</span>
</span></span><span style=display:flex><span>  	<span style=color:#000>cc</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>charge</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>cup</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>price</span><span style=color:#ce5c00;font-weight:700>)</span>		<span style=color:#8f5902;font-style:italic>// 副作用，对信用卡进行扣费
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>  	<span style=color:#000>cup</span>
</span></span><span style=display:flex><span>  <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>}</span>
</span></span></code></pre></div><p>扣费过程涉及与整个交易系统的交互，而这个方法的主要用途是为了得到一杯咖啡，因此，<em>扣费</em>动作在获取咖啡的过程中<strong>额外</strong>完成了，即副作用。</p><p>但是如果要测试这段程序，我们并不真的需要与交易系统进行交互，或者将交易信息进行持久。同时信用卡本身也不应该知道交易的细节，我们可以传递一个<code>Payments</code>对象给<code>buyCoffe</code>方法，让<code>CreditCard</code>忽略掉交易的细节，整个交易过程由<code>Payments</code>对象来完成：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scala data-lang=scala><span style=display:flex><span><span style=color:#204a87;font-weight:700>class</span> <span style=color:#000>Cafe</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>def</span> <span style=color:#000>buyCoffe</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>cc</span><span style=color:#204a87;font-weight:700>:</span><span style=color:#204a87;font-weight:700>CreditCard</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>p</span><span style=color:#204a87;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>Payments</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#204a87;font-weight:700>=</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>  	<span style=color:#204a87;font-weight:700>val</span> <span style=color:#000>cup</span> <span style=color:#204a87;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>Coffe</span><span style=color:#ce5c00;font-weight:700>()</span>
</span></span><span style=display:flex><span>    <span style=color:#000>p</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>charge</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>cc</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>cup</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>price</span><span style=color:#ce5c00;font-weight:700>)</span>		<span style=color:#8f5902;font-style:italic>// 副作用，有交易对象来完成扣费
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>    <span style=color:#000>cup</span>
</span></span><span style=display:flex><span>  <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>}</span>
</span></span></code></pre></div><p>现在可以使用 mock 来对交易细节进行测试。但是真个程序很难被复用，比如我们要订购 12 杯咖啡。</p><h3 id=去除副作用>去除副作用</h3><p>在上面的例子中，我们可以在购买咖啡的过程中同时返回咖啡和对应的费用，而根据费用进行的交易过程则后续进行处理，这样，这个程序就不再存在副作用：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scala data-lang=scala><span style=display:flex><span><span style=color:#204a87;font-weight:700>def</span> <span style=color:#000>buyCoffe</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>cc</span><span style=color:#204a87;font-weight:700>:</span><span style=color:#204a87;font-weight:700>CreditCard</span><span style=color:#ce5c00;font-weight:700>)</span><span style=color:#204a87;font-weight:700>:</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#204a87;font-weight:700>Coffe</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#204a87;font-weight:700>Change</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#204a87;font-weight:700>=</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>val</span> <span style=color:#000>cup</span> <span style=color:#204a87;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>Cup</span><span style=color:#ce5c00;font-weight:700>()</span>
</span></span><span style=display:flex><span>  <span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>cup</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>Charge</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>cc</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>cup</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>price</span><span style=color:#ce5c00;font-weight:700>))</span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>}</span>
</span></span></code></pre></div><p>这样通过将费用的创建与执行分离，购买咖啡的过程就不再有副作用，而真正的扣费可以在后续的事务中进行。</p><p>现在我们对相同信用卡的计费进行合并，以便支持同时购买多杯咖啡：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scala data-lang=scala><span style=display:flex><span><span style=color:#204a87;font-weight:700>case</span> <span style=color:#204a87;font-weight:700>class</span> <span style=color:#000>Charge</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>cc</span><span style=color:#204a87;font-weight:700>:</span><span style=color:#204a87;font-weight:700>CreditCard</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>amount</span><span style=color:#204a87;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>Double</span><span style=color:#ce5c00;font-weight:700>){</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>def</span> <span style=color:#000>combine</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>ohter</span><span style=color:#204a87;font-weight:700>:</span><span style=color:#204a87;font-weight:700>Charge</span><span style=color:#ce5c00;font-weight:700>)</span><span style=color:#204a87;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>Charge</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>if</span> <span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>cc</span> <span style=color:#ce5c00;font-weight:700>==</span> <span style=color:#000>other</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>cc</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#000>Charge</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>cc</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>amount</span> <span style=color:#ce5c00;font-weight:700>+</span> <span style=color:#000>other</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>amount</span><span style=color:#ce5c00;font-weight:700>)</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>else</span> <span style=color:#204a87;font-weight:700>throw</span> <span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>Exception</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;Can&#39;t combine charges to different cards.&#34;</span><span style=color:#ce5c00;font-weight:700>)</span>
</span></span><span style=display:flex><span>  <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>}</span>
</span></span></code></pre></div><p>然后实现<code>buyCoffes</code>来购买多杯咖啡，一次返回对应数量的咖啡和一个合并后的计费值：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scala data-lang=scala><span style=display:flex><span><span style=color:#204a87;font-weight:700>def</span> <span style=color:#000>buyCoffes</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>cc</span><span style=color:#204a87;font-weight:700>:</span><span style=color:#204a87;font-weight:700>CreditCard</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>n</span><span style=color:#204a87;font-weight:700>:</span><span style=color:#204a87;font-weight:700>Int</span><span style=color:#ce5c00;font-weight:700>)</span><span style=color:#204a87;font-weight:700>:</span> <span style=color:#ce5c00;font-weight:700>(</span><span style=color:#204a87;font-weight:700>List</span><span style=color:#ce5c00;font-weight:700>[</span><span style=color:#204a87;font-weight:700>Coffe</span><span style=color:#ce5c00;font-weight:700>],</span> <span style=color:#000>Charge</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#204a87;font-weight:700>=</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>val</span> <span style=color:#000>purchases</span><span style=color:#204a87;font-weight:700>:</span><span style=color:#204a87;font-weight:700>List</span><span style=color:#ce5c00;font-weight:700>[(</span><span style=color:#204a87;font-weight:700>Coffe</span>, <span style=color:#204a87;font-weight:700>Charge</span><span style=color:#ce5c00;font-weight:700>)]</span> <span style=color:#204a87;font-weight:700>=</span> <span style=color:#000>List</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>fill</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>n</span><span style=color:#ce5c00;font-weight:700>)(</span><span style=color:#000>buyCoffe</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>cc</span><span style=color:#ce5c00;font-weight:700>))</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>val</span> <span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>coffes</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>charges</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#204a87;font-weight:700>=</span> <span style=color:#000>purchases</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>unzip</span>
</span></span><span style=display:flex><span>  <span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>coffes</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>chargs</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>reduce</span><span style=color:#ce5c00;font-weight:700>((</span><span style=color:#000>c1</span><span style=color:#ce5c00;font-weight:700>,</span><span style=color:#000>c2</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#204a87;font-weight:700>=&gt;</span> <span style=color:#000>c1</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>combine</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>c2</span><span style=color:#ce5c00;font-weight:700>)))</span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>}</span>
</span></span></code></pre></div><p>如果需要将不同信用卡的不同消费记录合并成一个计费列表，即将相同的信用卡计费合并：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scala data-lang=scala><span style=display:flex><span><span style=color:#204a87;font-weight:700>def</span> <span style=color:#000>coalesce</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>charges</span><span style=color:#204a87;font-weight:700>:</span><span style=color:#204a87;font-weight:700>List</span><span style=color:#ce5c00;font-weight:700>[</span><span style=color:#204a87;font-weight:700>Charge</span><span style=color:#ce5c00;font-weight:700>])</span><span style=color:#204a87;font-weight:700>:</span><span style=color:#204a87;font-weight:700>List</span><span style=color:#ce5c00;font-weight:700>[</span><span style=color:#204a87;font-weight:700>Charge</span><span style=color:#ce5c00;font-weight:700>]</span> <span style=color:#204a87;font-weight:700>=</span> 
</span></span><span style=display:flex><span>  <span style=color:#000>charges</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>groupBy</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#204a87;font-weight:700>_</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>cc</span><span style=color:#ce5c00;font-weight:700>).</span><span style=color:#000>values</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>map</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#204a87;font-weight:700>_</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>reduce</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#204a87;font-weight:700>_</span> <span style=color:#000>combine</span> <span style=color:#204a87;font-weight:700>_</span><span style=color:#ce5c00;font-weight:700>)).</span><span style=color:#000>toList</span>
</span></span></code></pre></div><blockquote>
<p>如何消除副作用？</p><p>通过把副作用推到程序的最外层，来转换带有副作用的函数。对于很多必须的副作用都存在对应的函数式实现，如果没有对应的实现，也可以通过找到一种方式来构造代码，让副作用发生但不可见。</p></blockquote><h2 id=什么是纯函数>什么是纯函数</h2><p>纯函数是没有副作用的，<strong>更易推理</strong>。</p><p>一个函数在执行过程中，除了根据给定的参数给出运算结果之外没有任何其他影响，即为无副作用。</p><p><strong>引用透明</strong>：对于一个函数，无论何时调用，相同的参数都会返回一致的结果。同样也适用于表达式。</p><p>任何程序中符合引用透明的表达式都可以由它的结果替代，而不会改变程序的含义。</p><p><strong>纯函数</strong>：当调用一个函数时，传入的参数是引用透明的，并且函数调用也是引用透明的，那么他就是一个纯函数。</p><blockquote>
<p>引用透明与纯粹度</p><p>对于程序 p，如果它包含的表达式 e 满足引用透明，所有的 e 都能替换为它的计算结果而不会改变程序 p 的含义。假设存在一个函数 f，若表达式 f(x) 对所有引用透明的表达式 x 也是引用透明的，那么 f 是一个纯函数。</p></blockquote><h2 id=引用透明纯粹度及替代模型>引用透明、纯粹度及替代模型</h2><p>引用透明要求函数不论进行了何种操作都可以用它的返回值来代替。</p><p>比如一开始的咖啡例子：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>def buyCoffee(cc:CreditCard):Coffee = {
</span></span><span style=display:flex><span>  	val cup = new Coffee()
</span></span><span style=display:flex><span>  	cc.charge(cup.price)		// 副作用，对信用卡进行扣费
</span></span><span style=display:flex><span>  	cup
</span></span><span style=display:flex><span>  }
</span></span></code></pre></div><p>它的返回值为<code>cup</code>，实际上就是<code>new Coffe()</code>。对于任何一个函数<code>p(buyCoffee(cc:CreditCard))</code>与<code>p(new Coffe())</code>显然不能进行替换，因为<code>buyCoffee</code>除了返回一杯咖啡，还进行了交易过程。</p><p>引用透明的限制使得推导一个程序的求值变得简单，称为<strong>替代模型</strong>。如果表达式是引用透明的，可以想象计算过程就像是在解代数方程。展开表达式的每一部分，使用指示对象代替变量，然后归约到最简单的形式。在这一过程中，每一项都可以被等价的值替代，计算的过程就像是被一个又一个等价的值替代的过程。引用透明使得程序具备了等式推理的能力。</p></div><div class=td-content style=page-break-before:always>
<h1 id=pg-03d39ebdea9922f42538e9be1f094c81>3 - CH02-函数</h1><h2 id=高阶函数-把函数传递给函数>高阶函数-把函数传递给函数</h2><p><strong>函数也是值，也可以赋值给一个变量、存储在一个数据结构里、像参数一样传递给另一个函数</strong>。</p><h3 id=循环调用>循环调用</h3><p>使用循环方式实现阶乘：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scala data-lang=scala><span style=display:flex><span><span style=color:#204a87;font-weight:700>def</span> <span style=color:#000>factirial</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>n</span><span style=color:#204a87;font-weight:700>:</span><span style=color:#204a87;font-weight:700>Int</span><span style=color:#ce5c00;font-weight:700>)</span><span style=color:#204a87;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>Int</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>def</span> <span style=color:#000>go</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>n</span><span style=color:#204a87;font-weight:700>:</span><span style=color:#204a87;font-weight:700>Int</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>acc</span><span style=color:#204a87;font-weight:700>:</span><span style=color:#204a87;font-weight:700>Int</span><span style=color:#ce5c00;font-weight:700>)</span><span style=color:#204a87;font-weight:700>:</span><span style=color:#204a87;font-weight:700>Int</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#ce5c00;font-weight:700>{</span>	<span style=color:#8f5902;font-style:italic>// 内部函数，跟一个函数内的变量含义相同
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>    <span style=color:#204a87;font-weight:700>if</span> <span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>n</span> <span style=color:#ce5c00;font-weight:700>&lt;=</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#000>acc</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>else</span> <span style=color:#000>go</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>n</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>n</span> <span style=color:#ce5c00;font-weight:700>*</span> <span style=color:#000>acc</span><span style=color:#ce5c00;font-weight:700>)</span>
</span></span><span style=display:flex><span>  <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>  <span style=color:#000>go</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>n</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#ce5c00;font-weight:700>)</span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>}</span>
</span></span></code></pre></div><p>想不通过修改一个循环变量而实现循环功能，可以借助递归函数。这样的递归函数一般没命名为 go 或 loop。</p><p>上面的例子中，内部函数<code>go</code>实现循环，接收下一个<code>n</code>和和累积值<code>acc</code>。要退出循环时，返回一个不继续递归的值，即<code>n &lt;= 0</code>。</p><p>编译器会检测到这种<strong>自递归</strong>，只要递归调用发生在尾部，即递归调用后面没有其他的调用，编译器会优化成类似<code>while</code>循环的字节码。</p><blockquote>
<p>尾调用</p><p>指调用者在一个递归调用之后不做其他事，只是返回这个调用结果。</p><p>比如<code>else go(n-1, n * acc)</code>部分，是直接返回了<code>go</code>的递归调用，没有再做其他计算。如果是<code>1 + go(n-1, n * acc)</code>，则不再是尾调用，因为又进行了计算。</p><p>如果递归调用在尾部位置，则会自动编译为循环迭代，即不会每次进行栈的操作。可以通过<code>@annotation.tailrec</code>告诉编译器当没有成功编译成循环迭代时发出警告。</p></blockquote><h3 id=高阶函数>高阶函数</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scala data-lang=scala><span style=display:flex><span><span style=color:#204a87;font-weight:700>def</span> <span style=color:#000>formatResult</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>name</span><span style=color:#204a87;font-weight:700>:</span><span style=color:#204a87;font-weight:700>String</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>n</span><span style=color:#204a87;font-weight:700>:</span><span style=color:#204a87;font-weight:700>Int</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>f</span><span style=color:#204a87;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>Int</span> <span style=color:#ce5c00;font-weight:700>=&gt;</span> <span style=color:#000>Int</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#204a87;font-weight:700>=</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>val</span> <span style=color:#000>msg</span> <span style=color:#204a87;font-weight:700>=</span> <span style=color:#4e9a06>&#34;The %s of %d is %d.&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#000>msg</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>format</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>name</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>n</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>f</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>n</span><span style=color:#ce5c00;font-weight:700>))</span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>}</span>
</span></span></code></pre></div><p>这里的参数<code>f</code>，其类型为<code>Int => Int</code>，表示接受一个整数并返回一个整数的函数。</p><blockquote>
<p>因为高阶函数一般不能通过函数名来准确表示函数的功能，因此使用较短的函数命名，比如 g、h、f 等。</p></blockquote><h2 id=多态函数-基于类型的抽象>多态函数-基于类型的抽象</h2><p>这里的多态跟继承中所说的“父类-子类继承”不同，这里是指类型的多态。</p><p>之前见到的函数都是<strong>单态</strong>的，因为函数只操作一种数据类型。适用于多种数据类型的函数，称为<strong>多态函数</strong>，或<strong>泛型函数</strong>。</p><p>多态函数的构建，一般是发现多个单态函数有相似的结构，这时，可以封装为一个多态函数。</p><h3 id=实例>实例</h3><p>比如一个函数，返回数组中第一个匹配到 key 的索引，否则返回 -1:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scala data-lang=scala><span style=display:flex><span><span style=color:#204a87;font-weight:700>def</span> <span style=color:#000>findFirst</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>ss</span><span style=color:#204a87;font-weight:700>:</span><span style=color:#204a87;font-weight:700>Array</span><span style=color:#ce5c00;font-weight:700>[</span><span style=color:#204a87;font-weight:700>String</span><span style=color:#ce5c00;font-weight:700>],</span> <span style=color:#000>key</span><span style=color:#204a87;font-weight:700>:</span><span style=color:#204a87;font-weight:700>String</span><span style=color:#ce5c00;font-weight:700>)</span><span style=color:#204a87;font-weight:700>:</span><span style=color:#204a87;font-weight:700>Int</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#5c35cc;font-weight:700>@annotatin</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>tailrec</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>def</span> <span style=color:#000>loop</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>n</span><span style=color:#204a87;font-weight:700>:</span><span style=color:#204a87;font-weight:700>Int</span><span style=color:#ce5c00;font-weight:700>)</span><span style=color:#204a87;font-weight:700>:</span><span style=color:#204a87;font-weight:700>Int</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>if</span> <span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>n</span> <span style=color:#ce5c00;font-weight:700>&gt;=</span> <span style=color:#000>ss</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>length</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>-</span><span style=color:#0000cf;font-weight:700>1</span>		<span style=color:#8f5902;font-style:italic>// 到达数组尾部仍未匹配到 key，返回 -1
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>    <span style=color:#204a87;font-weight:700>else</span> <span style=color:#204a87;font-weight:700>if</span> <span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>ss</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>n</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>==</span> <span style=color:#000>key</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#000>n</span>	<span style=color:#8f5902;font-style:italic>// 匹配到 key，返回索引
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>    <span style=color:#204a87;font-weight:700>else</span> <span style=color:#000>loop</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>n</span> <span style=color:#ce5c00;font-weight:700>+</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#ce5c00;font-weight:700>)</span>			<span style=color:#8f5902;font-style:italic>// 递归调用
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>  <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>}</span>
</span></span></code></pre></div><p>这是从 String 数组中匹配，如果是从 Int 数组查找匹配，也是类似的结构，因此我们就可以将它改写为一个从 A 类型数组中查找对应索引的函数：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scala data-lang=scala><span style=display:flex><span><span style=color:#204a87;font-weight:700>def</span> <span style=color:#000>findFirst</span><span style=color:#ce5c00;font-weight:700>[</span><span style=color:#204a87;font-weight:700>A</span><span style=color:#ce5c00;font-weight:700>](</span><span style=color:#000>as</span><span style=color:#204a87;font-weight:700>:</span><span style=color:#204a87;font-weight:700>Array</span><span style=color:#ce5c00;font-weight:700>[</span><span style=color:#204a87;font-weight:700>A</span><span style=color:#ce5c00;font-weight:700>],</span> <span style=color:#000>p</span><span style=color:#204a87;font-weight:700>:</span><span style=color:#204a87;font-weight:700>A</span> <span style=color:#ce5c00;font-weight:700>=&gt;</span> <span style=color:#000>Boolean</span><span style=color:#ce5c00;font-weight:700>)</span><span style=color:#204a87;font-weight:700>:</span><span style=color:#204a87;font-weight:700>Int</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#5c35cc;font-weight:700>@annotatin</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>tailrec</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>def</span> <span style=color:#000>loop</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>n</span><span style=color:#204a87;font-weight:700>:</span><span style=color:#204a87;font-weight:700>Int</span><span style=color:#ce5c00;font-weight:700>)</span><span style=color:#204a87;font-weight:700>:</span><span style=color:#204a87;font-weight:700>Int</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>if</span> <span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>n</span> <span style=color:#ce5c00;font-weight:700>&gt;=</span> <span style=color:#000>as</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>length</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>-</span><span style=color:#0000cf;font-weight:700>1</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>else</span> <span style=color:#204a87;font-weight:700>if</span> <span style=color:#000>p</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>as</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>n</span><span style=color:#ce5c00;font-weight:700>))</span> <span style=color:#000>n</span>			<span style=color:#8f5902;font-style:italic>// 使用传入的 测试函数 p 对当前元素进行判断
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>    <span style=color:#204a87;font-weight:700>else</span> <span style=color:#000>loop</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>n</span> <span style=color:#ce5c00;font-weight:700>+</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#ce5c00;font-weight:700>)</span>
</span></span><span style=display:flex><span>  <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>}</span>
</span></span></code></pre></div><p>函数名后跟的是<strong>类型参数</strong>，由中括号包围，多个参数使用逗号分隔，一般使用单个大写字母表示一个类型参数。这些类型参数作为<strong>类型变量</strong>，可以在其他类型签名中引用，比如上面的<code>as</code>参数类型。</p><h3 id=向高阶函数传入匿名函数>向高阶函数传入匿名函数</h3><p>在调用高阶函数时，并没有必要提前定义一个有名函数然后再传入，可以在调用时直接定义一个函数值作为高阶函数的参数，这被称为<strong>匿名函数</strong>或<strong>函数字面量</strong>。比如：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scala data-lang=scala><span style=display:flex><span><span style=color:#000>findFirst</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>Array</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#ce5c00;font-weight:700>,</span><span style=color:#0000cf;font-weight:700>2</span><span style=color:#ce5c00;font-weight:700>,</span><span style=color:#0000cf;font-weight:700>3</span><span style=color:#ce5c00;font-weight:700>),</span> <span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>x</span><span style=color:#204a87;font-weight:700>:</span><span style=color:#204a87;font-weight:700>Int</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#204a87;font-weight:700>=&gt;</span> <span style=color:#000>x</span> <span style=color:#ce5c00;font-weight:700>==</span> <span style=color:#0000cf;font-weight:700>9</span><span style=color:#ce5c00;font-weight:700>)</span>
</span></span></code></pre></div><p><code>(x:Int) => x == 9</code>即为一个匿名函数，或称为函数字面量。</p><p>匿名函数中，<code>=></code>左边为该函数的参数列表，右边则会函数体。如果 Scala 可以推断参数的类型，则可以省略掉。</p><blockquote>
<p>函数也是值</p><p>当定义一个函数字面量时，实际上是定义了一个包含一个<code>apply</code>方法的 Scala 对象。而当一个对象拥有<code>apply</code>方法，则可以把该对象当做方法一样调用。</p><p>比如我们定义一个函数字面量<code>(a, b) => a &lt; b</code>，它事实上是创建函数对象的语法糖：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scala data-lang=scala><span style=display:flex><span><span style=color:#204a87;font-weight:700>val</span> <span style=color:#000>lessThan</span> <span style=color:#204a87;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>Function2</span><span style=color:#ce5c00;font-weight:700>[</span><span style=color:#204a87;font-weight:700>Int</span>, <span style=color:#204a87;font-weight:700>Int</span>, <span style=color:#204a87;font-weight:700>Boolean</span><span style=color:#ce5c00;font-weight:700>]</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>def</span> <span style=color:#000>apply</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>a</span><span style=color:#204a87;font-weight:700>:</span><span style=color:#204a87;font-weight:700>Int</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>b</span><span style=color:#204a87;font-weight:700>:</span><span style=color:#204a87;font-weight:700>Int</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#204a87;font-weight:700>=</span> <span style=color:#000>a</span> <span style=color:#ce5c00;font-weight:700>&lt;</span> <span style=color:#000>b</span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>}</span>
</span></span></code></pre></div><p><code>lessThan</code>的类型为<code>Function2[Int, Int, Boolean]</code>，通常会写成<code>(a, b) => Boolean</code>。<code>Function2</code>特质拥有一个<code>apply</code>方法，在调用<code>lessThan(10, 20)</code>时实际上是对<code>apply</code>方法调用的语法糖：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scala data-lang=scala><span style=display:flex><span><span style=color:#000>lessThan</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>apply</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>10</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>20</span><span style=color:#ce5c00;font-weight:700>)</span> 		<span style=color:#8f5902;font-style:italic>// true
</span></span></span></code></pre></div><p>这些类似<code>Function2</code>的特质，实际是由 Scala 标准库提供的普通特质，比如<code>Function1</code>、<code>Funciton3</code>等等。其中的数字是指接收的参数个数。</p><p>因为这些函数在 Scala 中是普通对象，因此他们也是一等值。</p></blockquote><h2 id=通过类型实现多态>通过类型实现多态</h2><p>在实现多态函数时，各种可能的实现方式明显比普通函数减少了。比如针对类型 A 的多态函数，唯一能够对 A 进行操作的方式是传入一个函数作为参数，通过这个传入的函数来操作 A。</p><p>比如一个例子，这个函数签名表示它只有一种实现方式。它是一个执行<strong>部分应用</strong>的高阶函数。函数<code>partial1</code>接收一个值和一个带有两个参数的函数，并返回一个带有一个参数的函数。</p><blockquote>
<p><strong>部分应用函数</strong>，表示函数被应用的参数并不是它需要的完整参数，即只提供了参数列表中的部分参数。</p></blockquote><p><code>def partial1[A, B, C](a:A, f: (A, B) => c): B => C</code></p><p>我们该如何实现这个高阶函数呢。根据它的返回值类型，是接收一个类型 B 的参数并返回一个类型 C 的值的函数：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scala data-lang=scala><span style=display:flex><span><span style=color:#204a87;font-weight:700>def</span> <span style=color:#000>partial1</span><span style=color:#ce5c00;font-weight:700>[</span><span style=color:#204a87;font-weight:700>A</span>, <span style=color:#204a87;font-weight:700>B</span>, <span style=color:#204a87;font-weight:700>C</span><span style=color:#ce5c00;font-weight:700>](</span><span style=color:#000>a</span><span style=color:#204a87;font-weight:700>:</span><span style=color:#204a87;font-weight:700>A</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>f</span><span style=color:#204a87;font-weight:700>:</span> <span style=color:#ce5c00;font-weight:700>(</span><span style=color:#204a87;font-weight:700>A</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#204a87;font-weight:700>B</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#204a87;font-weight:700>=&gt;</span> <span style=color:#000>c</span><span style=color:#ce5c00;font-weight:700>)</span><span style=color:#204a87;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>B</span> <span style=color:#ce5c00;font-weight:700>=&gt;</span> <span style=color:#000>C</span> <span style=color:#204a87;font-weight:700>=</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>b</span><span style=color:#204a87;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>B</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#204a87;font-weight:700>=&gt;</span> <span style=color:#ce5c00;font-weight:700>???</span>			<span style=color:#8f5902;font-style:italic>// 根据返回值类型 B =&gt; C ，定义一个该返回值类型的函数
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#ce5c00;font-weight:700>}</span>
</span></span></code></pre></div><p>现在如何来实现方法体部分呢，根据声明，这个函数必须返回一个 C 类型的值。而在<code>partial1</code>的参数列表中，正好有一个函数<code>f</code>能够返回一个 C 类型的值。除此之外，我们没有其他方式来实现该函数体。因此：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scala data-lang=scala><span style=display:flex><span><span style=color:#204a87;font-weight:700>def</span> <span style=color:#000>partial1</span><span style=color:#ce5c00;font-weight:700>[</span><span style=color:#204a87;font-weight:700>A</span>, <span style=color:#204a87;font-weight:700>B</span>, <span style=color:#204a87;font-weight:700>C</span><span style=color:#ce5c00;font-weight:700>](</span><span style=color:#000>a</span><span style=color:#204a87;font-weight:700>:</span><span style=color:#204a87;font-weight:700>A</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>f</span><span style=color:#204a87;font-weight:700>:</span> <span style=color:#ce5c00;font-weight:700>(</span><span style=color:#204a87;font-weight:700>A</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#204a87;font-weight:700>B</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#204a87;font-weight:700>=&gt;</span> <span style=color:#000>c</span><span style=color:#ce5c00;font-weight:700>)</span><span style=color:#204a87;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>B</span> <span style=color:#ce5c00;font-weight:700>=&gt;</span> <span style=color:#000>C</span> <span style=color:#204a87;font-weight:700>=</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>b</span><span style=color:#204a87;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>B</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#204a87;font-weight:700>=&gt;</span> <span style=color:#000>f</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>a</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>b</span><span style=color:#ce5c00;font-weight:700>)</span>		<span style=color:#8f5902;font-style:italic>// 调用参数中的函数，实现符合返回类型的函数体
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#ce5c00;font-weight:700>}</span>
</span></span></code></pre></div><p>这也就是<strong>部分应用函数</strong>的实现过程，一个函数，接收两个参数，返回一个值。当我们只提供一个参数值时，在这个例子中，是<code>a</code>，这时会得到一个 “接收一个参数并返回一个值的” 函数。然后在提供原始函数需要的第二个参数，即<code>b</code>，就能得到最终的结果， 即<code>c</code>。</p></div><div class=td-content style=page-break-before:always>
<h1 id=pg-ea16a70504134b7249c95e29e5f64348>4 - CH03-数据</h1><h2 id=定义函数式数据结构>定义函数式数据结构</h2><p>函数式数据结构只能被纯函数操作，纯函数一定不能修改原始数据或产生副作用。因此，<strong>函数式数据结构被定义为不可变的</strong>。</p><p>比如单链表的实现：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scala data-lang=scala><span style=display:flex><span><span style=color:#204a87;font-weight:700>sealed</span> <span style=color:#204a87;font-weight:700>trait</span> <span style=color:#000>List</span><span style=color:#ce5c00;font-weight:700>[</span><span style=color:#204a87;font-weight:700>+A</span><span style=color:#ce5c00;font-weight:700>]</span>
</span></span><span style=display:flex><span><span style=color:#000>case</span> <span style=color:#204a87;font-weight:700>object</span> <span style=color:#000>Nil</span> <span style=color:#204a87;font-weight:700>extends</span> <span style=color:#000>List</span><span style=color:#ce5c00;font-weight:700>[</span><span style=color:#204a87;font-weight:700>Nothing</span><span style=color:#ce5c00;font-weight:700>]</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>case</span> <span style=color:#204a87;font-weight:700>class</span> <span style=color:#000>Cons</span><span style=color:#ce5c00;font-weight:700>[</span><span style=color:#204a87;font-weight:700>+A</span><span style=color:#ce5c00;font-weight:700>](</span><span style=color:#000>head</span><span style=color:#204a87;font-weight:700>:</span><span style=color:#204a87;font-weight:700>A</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>tail</span><span style=color:#204a87;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>List</span><span style=color:#ce5c00;font-weight:700>[</span><span style=color:#204a87;font-weight:700>A</span><span style=color:#ce5c00;font-weight:700>])</span> <span style=color:#204a87;font-weight:700>extends</span> <span style=color:#000>List</span><span style=color:#ce5c00;font-weight:700>[</span><span style=color:#204a87;font-weight:700>A</span><span style=color:#ce5c00;font-weight:700>]</span>	<span style=color:#8f5902;font-style:italic>// 递归引用自身类型
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>object</span> <span style=color:#000>List</span><span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>def</span> <span style=color:#000>sum</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>ints</span><span style=color:#204a87;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>List</span><span style=color:#ce5c00;font-weight:700>[</span><span style=color:#204a87;font-weight:700>Int</span><span style=color:#ce5c00;font-weight:700>])</span><span style=color:#204a87;font-weight:700>:</span><span style=color:#204a87;font-weight:700>Int</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>ints</span> <span style=color:#204a87;font-weight:700>match</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>case</span> <span style=color:#000>Nil</span> <span style=color:#204a87;font-weight:700>=&gt;</span> <span style=color:#0000cf;font-weight:700>0</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>case</span> <span style=color:#000>Cons</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>x</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>xs</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#204a87;font-weight:700>=&gt;</span> <span style=color:#000>x</span> <span style=color:#ce5c00;font-weight:700>+</span> <span style=color:#000>sum</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>xs</span><span style=color:#ce5c00;font-weight:700>)</span>
</span></span><span style=display:flex><span>  <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>def</span> <span style=color:#000>product</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>ds</span><span style=color:#204a87;font-weight:700>:</span><span style=color:#204a87;font-weight:700>List</span><span style=color:#ce5c00;font-weight:700>[</span><span style=color:#204a87;font-weight:700>Double</span><span style=color:#ce5c00;font-weight:700>])</span><span style=color:#204a87;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>Double</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>ds</span> <span style=color:#204a87;font-weight:700>match</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>case</span> <span style=color:#000>Nil</span> <span style=color:#204a87;font-weight:700>=&gt;</span> <span style=color:#0000cf;font-weight:700>1.0</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>case</span> <span style=color:#000>Cons</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>0.0</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#204a87;font-weight:700>_</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#204a87;font-weight:700>=&gt;</span> <span style=color:#0000cf;font-weight:700>0.0</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>case</span> <span style=color:#000>Cons</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>x</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>xs</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#204a87;font-weight:700>=&gt;</span> <span style=color:#000>x</span> <span style=color:#ce5c00;font-weight:700>*</span> <span style=color:#000>product</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>xs</span><span style=color:#ce5c00;font-weight:700>)</span>
</span></span><span style=display:flex><span>  <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>def</span> <span style=color:#000>apply</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>as</span><span style=color:#204a87;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>A*</span><span style=color:#ce5c00;font-weight:700>)</span><span style=color:#204a87;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>List</span><span style=color:#ce5c00;font-weight:700>[</span><span style=color:#204a87;font-weight:700>A</span><span style=color:#ce5c00;font-weight:700>]</span> <span style=color:#204a87;font-weight:700>=</span> 
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>if</span> <span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>as</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>isEmpty</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#000>Nil</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>else</span> <span style=color:#000>Cons</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>as</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>head</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>apply</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>as</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>tail</span><span style=color:#204a87;font-weight:700>:_</span><span style=color:#204a87;font-weight:700>*</span><span style=color:#ce5c00;font-weight:700>))</span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>}</span>
</span></span></code></pre></div><p><code>List[+A]</code>表示它是一个泛型数据类型。同时拥有两种实现，或者说是两种构造器，每种都由<code>case</code>关键字定义，表示它的两种可能的形式。如果<code>List</code>为空，则用<code>Nil</code>表示，如果非空，则用构造器<code>Cons</code>表示。一个非空列表由初始元素<code>head</code>和后续紧跟的也是<code>List</code>结构的<code>tail</code>构成，并且，这个<code>tail</code>可能为空，即他可能是一个<code>Nil</code>。</p><p>这就是一个典型的数据构造器声明，为我们提供了一个函数来构造该类型数据的不同形式：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scala data-lang=scala><span style=display:flex><span><span style=color:#204a87;font-weight:700>val</span> <span style=color:#000>ex1</span><span style=color:#204a87;font-weight:700>:</span><span style=color:#204a87;font-weight:700>List</span><span style=color:#ce5c00;font-weight:700>[</span><span style=color:#204a87;font-weight:700>Double</span><span style=color:#ce5c00;font-weight:700>]</span> <span style=color:#204a87;font-weight:700>=</span> <span style=color:#000>Nil</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>val</span> <span style=color:#000>ex2</span><span style=color:#204a87;font-weight:700>:</span><span style=color:#204a87;font-weight:700>List</span><span style=color:#ce5c00;font-weight:700>[</span><span style=color:#204a87;font-weight:700>Int</span><span style=color:#ce5c00;font-weight:700>]</span> <span style=color:#204a87;font-weight:700>=</span> <span style=color:#000>Cons</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>Nil</span><span style=color:#ce5c00;font-weight:700>)</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>val</span> <span style=color:#000>ex3</span><span style=color:#204a87;font-weight:700>:</span><span style=color:#204a87;font-weight:700>List</span><span style=color:#ce5c00;font-weight:700>[</span><span style=color:#204a87;font-weight:700>String</span><span style=color:#ce5c00;font-weight:700>]</span> <span style=color:#204a87;font-weight:700>=</span> <span style=color:#000>Cons</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;a&#34;</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>Cons</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;b&#34;</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>Nil</span><span style=color:#ce5c00;font-weight:700>))</span>
</span></span></code></pre></div><h2 id=模式匹配>模式匹配</h2><p>在<code>List</code>的伴生对象中定义了两个方法，<code>sum</code>和<code>product</code>，他们都使用了模式匹配。同时他们都是以递归的方式定义，这在编写操作递归数据类型的函数时很常见。</p><p>模式匹配类似于<code>switch</code>，他可以侵入到表达式的数据结构内部，对这个结构进行检验和提取子表达式。符号<code>=></code>左边为<strong>模式</strong>，右边为<strong>结果</strong>。</p><p>如果将模式中的变量分配给目标子表达式，使得它在<strong>结构</strong>上与<strong>目标</strong>一致，模式与目标就是一致的。匹配上的话，结果表达式就可以访问这些模式中定义的局部变量。</p><h2 id=函数式数据结构的数据共享>函数式数据结构的数据共享</h2><p>当一个新的元素添加到已有的列表时返回一个新的列表。<strong>既然列表是不可变的</strong>，并不需要真的去复制一份原有列表，而是直接去复用它，比如向原有的列表 xs 添加一个数字 1，返回一个<code>Cons(1, xs)</code>。</p><p>同样，删除列表的第一个元素，比如<code>myList = Cons(x, xs)</code>，这时只需要返回尾部的<code>xs</code>。并没有真的删除任何元素。原始的<code>myList</code>依然可用，不会受到任何影响。</p><p>这被称为<strong>数据共享</strong>。</p><p>“函数式数据结构是持久的”，是指：已存在的引用不会因数据结构的操作而改变。</p><h2 id=数据共享的效率>数据共享的效率</h2><p>？？？</p><h2 id=高阶函数的类型推导>高阶函数的类型推导</h2><p>当向一个高阶函数传递函数类型的参数时，需要标识该函数的类型。比如高阶函数<code>dropWhile</code>：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scala data-lang=scala><span style=display:flex><span><span style=color:#204a87;font-weight:700>def</span> <span style=color:#000>dropWhile</span><span style=color:#ce5c00;font-weight:700>[</span><span style=color:#204a87;font-weight:700>A</span><span style=color:#ce5c00;font-weight:700>](</span><span style=color:#000>l</span><span style=color:#204a87;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>List</span><span style=color:#ce5c00;font-weight:700>[</span><span style=color:#204a87;font-weight:700>A</span><span style=color:#ce5c00;font-weight:700>],</span> <span style=color:#000>f</span><span style=color:#204a87;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>A</span> <span style=color:#ce5c00;font-weight:700>=&gt;</span> <span style=color:#000>Boolean</span><span style=color:#ce5c00;font-weight:700>)</span><span style=color:#204a87;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>List</span><span style=color:#ce5c00;font-weight:700>[</span><span style=color:#204a87;font-weight:700>A</span><span style=color:#ce5c00;font-weight:700>]</span>
</span></span></code></pre></div><p>当调用该函数时，参数函数<code>f</code>必须制定它的参数类型：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scala data-lang=scala><span style=display:flex><span><span style=color:#204a87;font-weight:700>val</span> <span style=color:#000>xs</span><span style=color:#204a87;font-weight:700>:</span><span style=color:#204a87;font-weight:700>List</span><span style=color:#ce5c00;font-weight:700>[</span><span style=color:#204a87;font-weight:700>Int</span><span style=color:#ce5c00;font-weight:700>]</span> <span style=color:#204a87;font-weight:700>=</span> <span style=color:#000>List</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#ce5c00;font-weight:700>,</span><span style=color:#0000cf;font-weight:700>2</span><span style=color:#ce5c00;font-weight:700>,</span><span style=color:#0000cf;font-weight:700>3</span><span style=color:#ce5c00;font-weight:700>,</span><span style=color:#0000cf;font-weight:700>4</span><span style=color:#ce5c00;font-weight:700>,</span><span style=color:#0000cf;font-weight:700>5</span><span style=color:#ce5c00;font-weight:700>)</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>val</span> <span style=color:#000>ex1</span> <span style=color:#204a87;font-weight:700>=</span> <span style=color:#000>dropWhile</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>xs</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>x</span><span style=color:#204a87;font-weight:700>:</span><span style=color:#204a87;font-weight:700>Int</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#204a87;font-weight:700>=&gt;</span> <span style=color:#000>x</span> <span style=color:#ce5c00;font-weight:700>&lt;</span> <span style=color:#0000cf;font-weight:700>4</span><span style=color:#ce5c00;font-weight:700>)</span>	<span style=color:#8f5902;font-style:italic>// (x:Int) 指定参数类型为 Int
</span></span></span></code></pre></div><p>因为<code>dropWhile</code>的两个参数都使用类型参数<code>A</code>，前一个参数<code>l</code>的类型为<code>Int</code>，因此第二个参数的类型也必须是<code>Int</code>。</p><p><strong>当函数定义包含多个参数组时，参数组里的类型信息从左到右进行传递。</strong></p><p>因此我们把<code>dropWhile</code>的参数列表分开，让他成为一个柯里化函数：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scala data-lang=scala><span style=display:flex><span><span style=color:#204a87;font-weight:700>def</span> <span style=color:#000>dropWhile</span><span style=color:#ce5c00;font-weight:700>[</span><span style=color:#204a87;font-weight:700>A</span><span style=color:#ce5c00;font-weight:700>](</span><span style=color:#000>as</span><span style=color:#204a87;font-weight:700>:</span><span style=color:#204a87;font-weight:700>List</span><span style=color:#ce5c00;font-weight:700>[</span><span style=color:#204a87;font-weight:700>A</span><span style=color:#ce5c00;font-weight:700>])(</span><span style=color:#000>f</span><span style=color:#204a87;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>A</span> <span style=color:#ce5c00;font-weight:700>=&gt;</span> <span style=color:#000>Boolean</span><span style=color:#ce5c00;font-weight:700>)</span><span style=color:#204a87;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>List</span><span style=color:#ce5c00;font-weight:700>[</span><span style=color:#204a87;font-weight:700>A</span><span style=color:#ce5c00;font-weight:700>]</span> <span style=color:#204a87;font-weight:700>=</span> 
</span></span><span style=display:flex><span>  <span style=color:#000>as</span> <span style=color:#204a87;font-weight:700>match</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>case</span> <span style=color:#000>Cons</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>h</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>t</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#204a87;font-weight:700>if</span> <span style=color:#000>f</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>h</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#204a87;font-weight:700>=&gt;</span> <span style=color:#000>dropWhile</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>t</span><span style=color:#ce5c00;font-weight:700>)(</span><span style=color:#000>f</span><span style=color:#ce5c00;font-weight:700>)</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>case</span> <span style=color:#204a87;font-weight:700>_</span> <span style=color:#204a87;font-weight:700>=&gt;</span> <span style=color:#000>as</span>
</span></span><span style=display:flex><span>  <span style=color:#ce5c00;font-weight:700>}</span>
</span></span></code></pre></div><p>现在可以这样调用<code>dropWhile</code>，<code>dropWhile(xs)(x => x &lt; 4)</code>。当调用<code>dropWhile(xs)</code>时他会返回一个函数，这时已经确定第一个参数的类型为<code>A</code>，因此第二个参数时就不再需要进行类型标注了，它的类型只能为<code>A</code>。</p><p>通过将函数参数分组排序成多个参数列表(将函数柯里化)，来最大化的利用类型推导。</p><h2 id=基于-list-的递归并泛化为高阶函数>基于 List 的递归并泛化为高阶函数</h2><p>回顾前面的<code>sum</code>和<code>product</code>函数：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scala data-lang=scala><span style=display:flex><span><span style=color:#204a87;font-weight:700>def</span> <span style=color:#000>sum</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>ints</span><span style=color:#204a87;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>List</span><span style=color:#ce5c00;font-weight:700>[</span><span style=color:#204a87;font-weight:700>Int</span><span style=color:#ce5c00;font-weight:700>])</span><span style=color:#204a87;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>Int</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>ints</span> <span style=color:#204a87;font-weight:700>match</span><span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>case</span> <span style=color:#000>Nil</span> <span style=color:#204a87;font-weight:700>=&gt;</span> <span style=color:#0000cf;font-weight:700>0</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>case</span> <span style=color:#000>Cons</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>x</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>xs</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#204a87;font-weight:700>=&gt;</span> <span style=color:#000>x</span> <span style=color:#ce5c00;font-weight:700>+</span> <span style=color:#000>sum</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>xs</span><span style=color:#ce5c00;font-weight:700>)</span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>def</span> <span style=color:#000>product</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>ds</span><span style=color:#204a87;font-weight:700>:</span><span style=color:#204a87;font-weight:700>List</span><span style=color:#ce5c00;font-weight:700>[</span><span style=color:#204a87;font-weight:700>Double</span><span style=color:#ce5c00;font-weight:700>])</span><span style=color:#204a87;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>Double</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>ds</span> <span style=color:#204a87;font-weight:700>match</span><span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>case</span> <span style=color:#000>Nil</span> <span style=color:#204a87;font-weight:700>=&gt;</span> <span style=color:#0000cf;font-weight:700>1.0</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>case</span> <span style=color:#000>Cons</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>x</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>xs</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#204a87;font-weight:700>=&gt;</span> <span style=color:#000>x</span> <span style=color:#ce5c00;font-weight:700>*</span> <span style=color:#000>product</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>xs</span><span style=color:#ce5c00;font-weight:700>)</span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>}</span>
</span></span></code></pre></div><p>这两个函数的结构类似，不同在于他们操作的数据类型(Int/Double)、<code>Nil</code>时返回的值(0/1.0)、以及对结果的组合操作(+/*)。</p><p>对于这两个函数的抽象，首先将<code>Int/Double</code>泛化为类型参数<code>A</code>，而<code>Nil</code>的返回值，可以作为一个函数参数由客户端提供。</p><p><strong>如果一个子表达式引用了任何局部变量，把子表达式放入一个接收这些局部变量作为参数的函数</strong>。</p><p>比如上面这两个函数中的<code>x + sum(xs)</code>和<code>x * product(xs)</code>部分，都是对局部变量的引用，因此可以抽象为函数<code>f: (A, B) => B</code>。最终，把上面两个函数改写成下面的方式：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scala data-lang=scala><span style=display:flex><span><span style=color:#204a87;font-weight:700>def</span> <span style=color:#000>foldRight</span><span style=color:#ce5c00;font-weight:700>[</span><span style=color:#204a87;font-weight:700>A</span>, <span style=color:#204a87;font-weight:700>B</span><span style=color:#ce5c00;font-weight:700>](</span><span style=color:#000>as</span><span style=color:#204a87;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>List</span><span style=color:#ce5c00;font-weight:700>[</span><span style=color:#204a87;font-weight:700>A</span><span style=color:#ce5c00;font-weight:700>],</span> <span style=color:#000>z</span><span style=color:#204a87;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>B</span><span style=color:#ce5c00;font-weight:700>)(</span><span style=color:#000>f</span><span style=color:#204a87;font-weight:700>:</span> <span style=color:#ce5c00;font-weight:700>(</span><span style=color:#204a87;font-weight:700>A</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#204a87;font-weight:700>B</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#204a87;font-weight:700>=&gt;</span> <span style=color:#000>B</span><span style=color:#ce5c00;font-weight:700>)</span><span style=color:#204a87;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>B</span> <span style=color:#ce5c00;font-weight:700>=</span> 
</span></span><span style=display:flex><span>  <span style=color:#000>as</span> <span style=color:#204a87;font-weight:700>match</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>case</span> <span style=color:#000>Nil</span> <span style=color:#204a87;font-weight:700>=&gt;</span> <span style=color:#000>z</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>case</span> <span style=color:#000>Cons</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>x</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>xs</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#204a87;font-weight:700>=&gt;</span> <span style=color:#000>f</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>x</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>foldRight</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>xs</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>z</span><span style=color:#ce5c00;font-weight:700>)(</span><span style=color:#000>f</span><span style=color:#ce5c00;font-weight:700>))</span>
</span></span><span style=display:flex><span>  <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>def</span> <span style=color:#000>sum2</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>ns</span><span style=color:#204a87;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>List</span><span style=color:#ce5c00;font-weight:700>[</span><span style=color:#204a87;font-weight:700>Int</span><span style=color:#ce5c00;font-weight:700>])</span> <span style=color:#204a87;font-weight:700>=</span> <span style=color:#000>foldRight</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>ns</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#ce5c00;font-weight:700>)((</span><span style=color:#000>x</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>y</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#204a87;font-weight:700>=&gt;</span> <span style=color:#000>x</span> <span style=color:#ce5c00;font-weight:700>+</span> <span style=color:#000>y</span><span style=color:#ce5c00;font-weight:700>)</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>def</span> <span style=color:#000>product2</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>ns</span><span style=color:#204a87;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>List</span><span style=color:#ce5c00;font-weight:700>[</span><span style=color:#204a87;font-weight:700>Double</span><span style=color:#ce5c00;font-weight:700>])</span> <span style=color:#204a87;font-weight:700>=</span> <span style=color:#000>foldRight</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>ns</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>1.0</span><span style=color:#ce5c00;font-weight:700>)(</span><span style=color:#204a87;font-weight:700>_</span> <span style=color:#ce5c00;font-weight:700>*</span> <span style=color:#204a87;font-weight:700>_</span><span style=color:#ce5c00;font-weight:700>)</span>
</span></span></code></pre></div><p>这里需要注意的是，与之前遇到的泛化不同，该函数的最终计算结果类型与传入的列表类型并不相同，如函数签名<code>foldRight[A, B](as: List[A], z: B)(f: (A, B) => B): B</code>所示，它的最终计算结果与传入的参数<code>z</code>类型一致，即类型<code>B</code>。</p><p>因为整个函数的计算过程就是对列表进行循环，一直遍历到列表末尾，这个过程中不断压栈，直至列表的末尾，即<code>Nil</code>。而遇到<code>Nil</code>时返回的值为传入的参数<code>z</code>，套用传入的函数<code>f</code>，也就是通过传入列表的最后一个元素(Nil 之前的元素)与<code>z</code>来调用函数<code>f</code>，得到栈顶的值。然后依次出栈，完成整个计算过程。</p><p>可以函数的调用使用传入的函数<code>f</code>进行替换：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scala data-lang=scala><span style=display:flex><span><span style=color:#000>Cons</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>Cons</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>2</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>Nil</span><span style=color:#ce5c00;font-weight:700>))</span>
</span></span><span style=display:flex><span><span style=color:#000>f</span>	<span style=color:#ce5c00;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>f</span>   <span style=color:#ce5c00;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>2</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>z</span>  <span style=color:#ce5c00;font-weight:700>))</span>
</span></span></code></pre></div><p><code>foldRight</code>函数为 Scala 标准库中<code>List</code>的内置函数，上面的替换过程也就是它的计算过程。</p><p>比如我们调用<code>sum2(List(1,2,3), 0)((x, y) => x + y)</code>，跟踪其运算过程：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scala data-lang=scala><span style=display:flex><span><span style=color:#000>foldRight</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>Cons</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>Cons</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>2</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>Cons</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>3</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>Nil</span><span style=color:#ce5c00;font-weight:700>))),</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#ce5c00;font-weight:700>)((</span><span style=color:#000>x</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>y</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#204a87;font-weight:700>=&gt;</span> <span style=color:#000>x</span> <span style=color:#ce5c00;font-weight:700>+</span> <span style=color:#000>y</span><span style=color:#ce5c00;font-weight:700>)</span>
</span></span><span style=display:flex><span><span style=color:#0000cf;font-weight:700>1</span> <span style=color:#ce5c00;font-weight:700>+</span> <span style=color:#000>foldRight</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>Cons</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>2</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>Cons</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>3</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>Nil</span><span style=color:#ce5c00;font-weight:700>)),</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#ce5c00;font-weight:700>)((</span><span style=color:#000>x</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>y</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#204a87;font-weight:700>=&gt;</span> <span style=color:#000>x</span> <span style=color:#ce5c00;font-weight:700>+</span> <span style=color:#000>y</span><span style=color:#ce5c00;font-weight:700>)</span>
</span></span><span style=display:flex><span><span style=color:#0000cf;font-weight:700>1</span> <span style=color:#ce5c00;font-weight:700>+</span> <span style=color:#ce5c00;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>2</span> <span style=color:#ce5c00;font-weight:700>+</span> <span style=color:#000>foldRight</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>Cons</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>3</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>Nil</span><span style=color:#ce5c00;font-weight:700>),</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#ce5c00;font-weight:700>)((</span><span style=color:#000>x</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>y</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#204a87;font-weight:700>=&gt;</span> <span style=color:#000>x</span> <span style=color:#ce5c00;font-weight:700>+</span> <span style=color:#000>y</span><span style=color:#ce5c00;font-weight:700>))</span>
</span></span><span style=display:flex><span><span style=color:#0000cf;font-weight:700>1</span> <span style=color:#ce5c00;font-weight:700>+</span> <span style=color:#ce5c00;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>2</span> <span style=color:#ce5c00;font-weight:700>+</span> <span style=color:#ce5c00;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>3</span> <span style=color:#ce5c00;font-weight:700>+</span> <span style=color:#000>foldRight</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>Nil</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#ce5c00;font-weight:700>)((</span><span style=color:#000>x</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>y</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#204a87;font-weight:700>=&gt;</span> <span style=color:#000>x</span> <span style=color:#ce5c00;font-weight:700>+</span> <span style=color:#000>y</span><span style=color:#ce5c00;font-weight:700>))))</span> <span style=color:#8f5902;font-style:italic>// Nil, 终止递归，替换为(0 + 0)
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#0000cf;font-weight:700>1</span> <span style=color:#ce5c00;font-weight:700>+</span> <span style=color:#ce5c00;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>2</span> <span style=color:#ce5c00;font-weight:700>+</span> <span style=color:#ce5c00;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>3</span> <span style=color:#ce5c00;font-weight:700>+</span> <span style=color:#ce5c00;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#ce5c00;font-weight:700>))</span>
</span></span><span style=display:flex><span><span style=color:#0000cf;font-weight:700>6</span>
</span></span></code></pre></div><h2 id=树>树</h2><p>List 是<strong>代数数据类型(ADT)<strong>的一种，有些场景或称为</strong>抽象数据类型</strong>。</p><p>ADT 是由一个或多个数据构造器所定义的数据类型，每个构造器可以包含零个或多个参数。数据构造器通过累加(sum)或联合(union)构成数据类型，而每个数据构造器又是其参数的<strong>乘积(product)</strong>。因此称为<strong>代数</strong>数据类型。</p><p>ADT 用于构造其他数据结构。定义一个二叉树数据结构：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scala data-lang=scala><span style=display:flex><span><span style=color:#204a87;font-weight:700>sealed</span> <span style=color:#204a87;font-weight:700>trait</span> <span style=color:#000>Tree</span><span style=color:#ce5c00;font-weight:700>[</span><span style=color:#204a87;font-weight:700>+A</span><span style=color:#ce5c00;font-weight:700>]</span>
</span></span><span style=display:flex><span><span style=color:#000>case</span> <span style=color:#204a87;font-weight:700>class</span> <span style=color:#000>Leaf</span><span style=color:#ce5c00;font-weight:700>[</span><span style=color:#204a87;font-weight:700>A</span><span style=color:#ce5c00;font-weight:700>](</span><span style=color:#000>value</span><span style=color:#204a87;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>A</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#204a87;font-weight:700>extends</span> <span style=color:#000>Tree</span><span style=color:#ce5c00;font-weight:700>[</span><span style=color:#204a87;font-weight:700>A</span><span style=color:#ce5c00;font-weight:700>]</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>case</span> <span style=color:#204a87;font-weight:700>class</span> <span style=color:#000>Branch</span><span style=color:#ce5c00;font-weight:700>[</span><span style=color:#204a87;font-weight:700>A</span><span style=color:#ce5c00;font-weight:700>](</span><span style=color:#000>left</span><span style=color:#204a87;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>Tree</span><span style=color:#ce5c00;font-weight:700>[</span><span style=color:#204a87;font-weight:700>A</span><span style=color:#ce5c00;font-weight:700>],</span> <span style=color:#000>right</span><span style=color:#204a87;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>Tree</span><span style=color:#ce5c00;font-weight:700>[</span><span style=color:#204a87;font-weight:700>A</span><span style=color:#ce5c00;font-weight:700>])</span> <span style=color:#204a87;font-weight:700>extends</span> <span style=color:#000>Tree</span><span style=color:#ce5c00;font-weight:700>[</span><span style=color:#204a87;font-weight:700>A</span><span style=color:#ce5c00;font-weight:700>]</span>
</span></span></code></pre></div></div><div class=td-content style=page-break-before:always>
<h1 id=pg-6cbae87fa8d5efc949b3b87261ed10fc>5 - CH04-异常</h1><p>抛出异常会产生副作用，在函数式解决方案中，以值的方式返回错误更安全，符合引用透明，并且可以通过高阶函数保存异常的优点 - 统一错误处理逻辑。核心思想就是使用普票值来表现异常。</p><h2 id=异常的优点与劣势>异常的优点与劣势</h2><p>一个抛出异常的例子：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scala data-lang=scala><span style=display:flex><span><span style=color:#204a87;font-weight:700>def</span> <span style=color:#000>failingFn</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>i</span><span style=color:#204a87;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>Int</span><span style=color:#ce5c00;font-weight:700>)</span><span style=color:#204a87;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>Int</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>val</span> <span style=color:#000>y</span><span style=color:#204a87;font-weight:700>:</span><span style=color:#204a87;font-weight:700>Int</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>throw</span> <span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>Exception</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;fail!&#34;</span><span style=color:#ce5c00;font-weight:700>)</span> 	<span style=color:#8f5902;font-style:italic>// 抛出异常
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>  <span style=color:#204a87;font-weight:700>try</span><span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>val</span> <span style=color:#000>x</span> <span style=color:#204a87;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>42</span> <span style=color:#ce5c00;font-weight:700>+</span> <span style=color:#0000cf;font-weight:700>5</span>
</span></span><span style=display:flex><span>    <span style=color:#000>x</span> <span style=color:#ce5c00;font-weight:700>+</span> <span style=color:#000>y</span>
</span></span><span style=display:flex><span>  <span style=color:#ce5c00;font-weight:700>}</span> <span style=color:#204a87;font-weight:700>catch</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>case</span> <span style=color:#000>e</span><span style=color:#204a87;font-weight:700>:</span><span style=color:#204a87;font-weight:700>Exception</span> <span style=color:#ce5c00;font-weight:700>=&gt;</span> <span style=color:#0000cf;font-weight:700>43</span>
</span></span><span style=display:flex><span>  <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>}</span>
</span></span></code></pre></div><p>调用该函数会抛出预期的异常，为了证明异常会破坏引用透明，我们可以将<code>y</code>进行替换：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scala data-lang=scala><span style=display:flex><span><span style=color:#204a87;font-weight:700>def</span> <span style=color:#000>failingFn2</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>i</span><span style=color:#204a87;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>Int</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#204a87;font-weight:700>=</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>try</span><span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>val</span> <span style=color:#000>x</span> <span style=color:#204a87;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>42</span> <span style=color:#ce5c00;font-weight:700>+</span> <span style=color:#0000cf;font-weight:700>5</span>
</span></span><span style=display:flex><span>    <span style=color:#000>x</span> <span style=color:#ce5c00;font-weight:700>+</span> <span style=color:#ce5c00;font-weight:700>(</span><span style=color:#204a87;font-weight:700>throw</span> <span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>Exception</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;fail!&#34;</span><span style=color:#ce5c00;font-weight:700>)</span><span style=color:#204a87;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>Int</span><span style=color:#ce5c00;font-weight:700>)</span>	<span style=color:#8f5902;font-style:italic>// 抛出异常的表达式可以声明为任何类型
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>  <span style=color:#ce5c00;font-weight:700>}</span> <span style=color:#204a87;font-weight:700>catch</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>case</span> <span style=color:#000>e</span><span style=color:#204a87;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>Exception</span> <span style=color:#ce5c00;font-weight:700>=&gt;</span> <span style=color:#0000cf;font-weight:700>43</span>
</span></span><span style=display:flex><span>  <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>}</span>
</span></span></code></pre></div><p>运行结果会得到 43 而不是像替换前一样排除预期的异常，因此，异常并不是引用透明的。</p><p>引用透明的表达式<strong>不依赖上下文</strong>，可以本地推导，而那些非引用透明的表达式是<strong>依赖上下文的</strong>，并且需要全局推导。比如把<code>42 + 5</code>这个表达式嵌入到一个更大的表达式中，他不会受这个更大的表达式的影响，即对更大的表达式产生依赖，它永远等于 47。但是把<code>throw new...</code>嵌入到一个更大的表达式，比如嵌入到一个<code>try/catch</code>结构中，它的值取决于<code>catch</code>部分的处理，因此对更大的表达式产生了依赖。</p><p>异常的问题：</p><ul>
<li>异常破坏了引用透明并且引入了上下文依赖。</li><li>异常不是类型安全的。函数<code>failing</code>，<code>Int => Int</code>并不会告诉我们会发生什么样的异常。因为没有受检异常，直到运行时才会发现异常。</li></ul><p>我们希望其他选择能够排除异常的这些缺点，但是又不想失去异常最主要的好处：<strong>整合集中的错误处理逻辑</strong>，而不是在整个代码库发布这个逻辑。</p><h2 id=异常的其他选择>异常的其他选择</h2><p>比如一个计算列表平均值的函数：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scala data-lang=scala><span style=display:flex><span><span style=color:#204a87;font-weight:700>def</span> <span style=color:#000>mean</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>xs</span><span style=color:#204a87;font-weight:700>:</span><span style=color:#204a87;font-weight:700>Seq</span><span style=color:#ce5c00;font-weight:700>[</span><span style=color:#204a87;font-weight:700>Double</span><span style=color:#ce5c00;font-weight:700>])</span><span style=color:#204a87;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>Double</span> <span style=color:#ce5c00;font-weight:700>=</span> 
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>if</span> <span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>xs</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>isEmpty</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#204a87;font-weight:700>throw</span> <span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>ArithmeticException</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;mean of empty list!&#34;</span><span style=color:#ce5c00;font-weight:700>)</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>else</span> <span style=color:#000>xs</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>sum</span> <span style=color:#ce5c00;font-weight:700>/</span> <span style=color:#000>xs</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>length</span>
</span></span></code></pre></div><p>这是一个典型的<strong>偏函数</strong>，他对一些输入没有做定义。如果一个函数对那些非隐式的输入类型做了一些假设，那它就是一个典型的偏函数。</p><p>除了选择抛出异常，还有其他的选择。</p><p>第一种是返回某个伪造的 Double 类型的值。比如为空时返回<code>Double.NaN</code>，或者其他报警值，或者<code>null</code>。但是以下理由使我们放弃这种方案：</p><ul>
<li>它允许错误<strong>无声</strong>的传播，如果忘了对这样的值进行检查也不会得到警告，会使后面的代码出错。</li><li>使用显式的<code>if</code>来检查是否得到了正确的结果会导致大量的模板代码，特别是调用多个函数时。</li><li>不适用与多态代码。比如一个查找最大值的泛型函数<code>def max[A](xs:List[A])</code>，当传入为空时无法发明一个 A 类型的值。也不能是<code>null</code>，因为<code>null</code>只对非基础类型有效，但是这里的 A 可能是<code>Int</code>或<code>Double</code>。</li><li>需要一个特定的策略或调用约定 - 告诉调用者如何合理的使用<code>mean</code>函数。这导致它不能传递给高阶函数，因为高阶函数对待所有参数都是一致的。</li></ul><p>第二种是强迫调用者提供一个参数告诉我们该如何处理。比如：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scala data-lang=scala><span style=display:flex><span><span style=color:#204a87;font-weight:700>def</span> <span style=color:#000>mean</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>xs</span><span style=color:#204a87;font-weight:700>:</span><span style=color:#204a87;font-weight:700>Seq</span><span style=color:#ce5c00;font-weight:700>[</span><span style=color:#204a87;font-weight:700>Double</span><span style=color:#ce5c00;font-weight:700>],</span> <span style=color:#000>onEmpty</span><span style=color:#204a87;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>Double</span><span style=color:#ce5c00;font-weight:700>)</span><span style=color:#204a87;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>Double</span> <span style=color:#ce5c00;font-weight:700>=</span> 
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>if</span> <span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>xs</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>isEmpty</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#000>onEmpty</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>else</span> <span style=color:#000>xs</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>sum</span> <span style=color:#ce5c00;font-weight:700>/</span> <span style=color:#000>xs</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>length</span>
</span></span></code></pre></div><p>这使<code>mean</code>函数称为一个<strong>完全函数</strong>。调用者必须知道如何处理未定义的情况。</p><h2 id=option-数据类型>Option 数据类型</h2><p>解决方案是在返回值类型明确表示该函数并不总是有结果。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scala data-lang=scala><span style=display:flex><span><span style=color:#204a87;font-weight:700>sealed</span> <span style=color:#204a87;font-weight:700>trait</span> <span style=color:#000>Option</span><span style=color:#ce5c00;font-weight:700>[</span><span style=color:#204a87;font-weight:700>+A</span><span style=color:#ce5c00;font-weight:700>]</span>
</span></span><span style=display:flex><span><span style=color:#000>case</span> <span style=color:#204a87;font-weight:700>class</span> <span style=color:#000>Some</span><span style=color:#ce5c00;font-weight:700>[</span><span style=color:#204a87;font-weight:700>+A</span><span style=color:#ce5c00;font-weight:700>](</span><span style=color:#000>get</span><span style=color:#204a87;font-weight:700>:</span><span style=color:#204a87;font-weight:700>A</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#204a87;font-weight:700>extends</span> <span style=color:#000>Option</span><span style=color:#ce5c00;font-weight:700>[</span><span style=color:#204a87;font-weight:700>A</span><span style=color:#ce5c00;font-weight:700>]</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>case</span> <span style=color:#204a87;font-weight:700>object</span> <span style=color:#000>None</span> <span style=color:#204a87;font-weight:700>extends</span> <span style=color:#000>Option</span><span style=color:#ce5c00;font-weight:700>[</span><span style=color:#204a87;font-weight:700>A</span><span style=color:#ce5c00;font-weight:700>]</span>
</span></span></code></pre></div><p><code>Option</code>是一个最多只包含一个元素的<code>List</code>。</p><h3 id=基础-option-函数>基础 Option 函数</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scala data-lang=scala><span style=display:flex><span><span style=color:#204a87;font-weight:700>trait</span> <span style=color:#000>Option</span><span style=color:#ce5c00;font-weight:700>[</span><span style=color:#204a87;font-weight:700>+A</span><span style=color:#ce5c00;font-weight:700>]</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>def</span> <span style=color:#000>map</span><span style=color:#ce5c00;font-weight:700>[</span><span style=color:#204a87;font-weight:700>B</span><span style=color:#ce5c00;font-weight:700>](</span><span style=color:#000>f</span><span style=color:#204a87;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>A</span> <span style=color:#ce5c00;font-weight:700>=&gt;</span> <span style=color:#000>B</span><span style=color:#ce5c00;font-weight:700>)</span><span style=color:#204a87;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>Option</span><span style=color:#ce5c00;font-weight:700>[</span><span style=color:#204a87;font-weight:700>B</span><span style=color:#ce5c00;font-weight:700>]</span>					<span style=color:#8f5902;font-style:italic>// 如果 Option 不为 None，对其应用 f
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>  <span style=color:#204a87;font-weight:700>def</span> <span style=color:#000>flatMap</span><span style=color:#ce5c00;font-weight:700>[</span><span style=color:#204a87;font-weight:700>B</span><span style=color:#ce5c00;font-weight:700>](</span><span style=color:#000>f</span><span style=color:#204a87;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>A</span> <span style=color:#ce5c00;font-weight:700>=&gt;</span> <span style=color:#000>Option</span><span style=color:#ce5c00;font-weight:700>[</span><span style=color:#204a87;font-weight:700>B</span><span style=color:#ce5c00;font-weight:700>])</span><span style=color:#204a87;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>Option</span><span style=color:#ce5c00;font-weight:700>[</span><span style=color:#204a87;font-weight:700>B</span><span style=color:#ce5c00;font-weight:700>]</span> 		<span style=color:#8f5902;font-style:italic>// 如果 Option 不为 None，对其应用 f，可能会失败
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>  <span style=color:#204a87;font-weight:700>def</span> <span style=color:#000>getOrElse</span><span style=color:#ce5c00;font-weight:700>[</span><span style=color:#204a87;font-weight:700>B</span> <span style=color:#204a87;font-weight:700>&gt;:</span> <span style=color:#204a87;font-weight:700>A</span><span style=color:#ce5c00;font-weight:700>](</span><span style=color:#000>default</span><span style=color:#204a87;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>B</span><span style=color:#ce5c00;font-weight:700>)</span><span style=color:#204a87;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>B</span>				<span style=color:#8f5902;font-style:italic>// 默认值类型 B 必须是 A 的父类
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>  <span style=color:#204a87;font-weight:700>def</span> <span style=color:#000>orElse</span><span style=color:#ce5c00;font-weight:700>[</span><span style=color:#204a87;font-weight:700>B</span> <span style=color:#204a87;font-weight:700>&gt;:</span> <span style=color:#204a87;font-weight:700>A</span><span style=color:#ce5c00;font-weight:700>](</span><span style=color:#000>ob</span><span style=color:#204a87;font-weight:700>:</span> <span style=color:#ce5c00;font-weight:700>=&gt;</span> <span style=color:#000>Option</span><span style=color:#ce5c00;font-weight:700>[</span><span style=color:#204a87;font-weight:700>B</span><span style=color:#ce5c00;font-weight:700>])</span><span style=color:#204a87;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>Option</span><span style=color:#ce5c00;font-weight:700>[</span><span style=color:#204a87;font-weight:700>B</span><span style=color:#ce5c00;font-weight:700>]</span>	<span style=color:#8f5902;font-style:italic>// 不对 ob 求值，除非需要
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>  <span style=color:#204a87;font-weight:700>def</span> <span style=color:#000>filter</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>f</span><span style=color:#204a87;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>A</span> <span style=color:#ce5c00;font-weight:700>=&gt;</span> <span style=color:#000>Boolean</span><span style=color:#ce5c00;font-weight:700>)</span><span style=color:#204a87;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>Option</span><span style=color:#ce5c00;font-weight:700>[</span><span style=color:#204a87;font-weight:700>A</span><span style=color:#ce5c00;font-weight:700>]</span> 			<span style=color:#8f5902;font-style:italic>// 如果值不满足，转换 Some 为 None
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#ce5c00;font-weight:700>}</span>
</span></span></code></pre></div><h3 id=基础函数使用场景>基础函数使用场景</h3><p>???</p><h3 id=option-组合提升面向异常的-api-封装>Option 组合、提升、面向异常的 API 封装</h3><p>可能会认为，一旦开始使用<code>Option</code>，整个库都会受影响，因为一些方法必须改变为接收或返回<code>Option</code>。但是，我们可以把一个普通函数**提升(lift)**为一个对<code>Option</code>操作的函数。</p><p>比如，<code>map</code>函数支持我们用一个类型为<code>A => B</code>的函数来操作一个<code>Option</code>。从另一个角度看，<code>map</code>可以把一个<code>A => B</code>的函数转换为<code>Option[A] => Option[B]</code>类型的函数：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scala data-lang=scala><span style=display:flex><span><span style=color:#204a87;font-weight:700>def</span> <span style=color:#000>lift</span><span style=color:#ce5c00;font-weight:700>[</span><span style=color:#204a87;font-weight:700>A</span>, <span style=color:#204a87;font-weight:700>B</span><span style=color:#ce5c00;font-weight:700>](</span><span style=color:#000>f</span><span style=color:#204a87;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>A</span> <span style=color:#ce5c00;font-weight:700>=&gt;</span> <span style=color:#000>B</span><span style=color:#ce5c00;font-weight:700>)</span><span style=color:#204a87;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>Option</span><span style=color:#ce5c00;font-weight:700>[</span><span style=color:#204a87;font-weight:700>A</span><span style=color:#ce5c00;font-weight:700>]</span> <span style=color:#204a87;font-weight:700>=&gt;</span> <span style=color:#000>Option</span><span style=color:#ce5c00;font-weight:700>[</span><span style=color:#204a87;font-weight:700>B</span><span style=color:#ce5c00;font-weight:700>]</span> <span style=color:#204a87;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>_</span> <span style=color:#000>map</span> <span style=color:#000>f</span>
</span></span></code></pre></div><p>现在，可以把普通的<code>abs</code>函数转换为处理<code>Option</code>的函数：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scala data-lang=scala><span style=display:flex><span><span style=color:#204a87;font-weight:700>val</span> <span style=color:#000>absOpt</span><span style=color:#204a87;font-weight:700>:</span><span style=color:#204a87;font-weight:700>Option</span><span style=color:#ce5c00;font-weight:700>[</span><span style=color:#204a87;font-weight:700>Double</span><span style=color:#ce5c00;font-weight:700>]</span> <span style=color:#204a87;font-weight:700>=&gt;</span> <span style=color:#000>Option</span><span style=color:#ce5c00;font-weight:700>[</span><span style=color:#204a87;font-weight:700>Double</span><span style=color:#ce5c00;font-weight:700>]</span> <span style=color:#204a87;font-weight:700>=</span> <span style=color:#000>lift</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>math</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>abs</span><span style=color:#ce5c00;font-weight:700>)</span>
</span></span></code></pre></div><p>而<code>Try</code>函数是一个通用目的的函数，用于将一个基于异常的 API 转换成一个面向<code>Option</code>的 API。</p><h2 id=either-数据类型>Either 数据类型</h2><p><code>Option</code>只能用来表示可能不存在的值，并不能表示异常条件下发生了什么错误。如果除了需要获取异常时可能的值，还需要知道异常时的错误信息，可以使用<code>Either</code>：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scala data-lang=scala><span style=display:flex><span><span style=color:#204a87;font-weight:700>sealed</span> <span style=color:#204a87;font-weight:700>trait</span> <span style=color:#000>Either</span><span style=color:#ce5c00;font-weight:700>[</span><span style=color:#204a87;font-weight:700>+E</span>, <span style=color:#204a87;font-weight:700>+A</span><span style=color:#ce5c00;font-weight:700>]</span>
</span></span><span style=display:flex><span><span style=color:#000>case</span> <span style=color:#204a87;font-weight:700>class</span> <span style=color:#000>Left</span><span style=color:#ce5c00;font-weight:700>[</span><span style=color:#204a87;font-weight:700>+E</span><span style=color:#ce5c00;font-weight:700>](</span><span style=color:#000>value</span><span style=color:#204a87;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>E</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#204a87;font-weight:700>extends</span> <span style=color:#000>Either</span><span style=color:#ce5c00;font-weight:700>[</span><span style=color:#204a87;font-weight:700>E</span>, <span style=color:#204a87;font-weight:700>Nothing</span><span style=color:#ce5c00;font-weight:700>]</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>case</span> <span style=color:#204a87;font-weight:700>class</span> <span style=color:#000>Right</span><span style=color:#ce5c00;font-weight:700>[</span><span style=color:#204a87;font-weight:700>+A</span><span style=color:#ce5c00;font-weight:700>](</span><span style=color:#000>value</span><span style=color:#204a87;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>A</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#204a87;font-weight:700>extends</span> <span style=color:#000>Either</span><span style=color:#ce5c00;font-weight:700>[</span><span style=color:#204a87;font-weight:700>Nothing</span>, <span style=color:#204a87;font-weight:700>A</span><span style=color:#ce5c00;font-weight:700>]</span>
</span></span></code></pre></div><p><code>Either</code>在两种情况都有值，它的值只能是两种情况中的一种，称他是两个类型的<strong>互斥并集</strong>。一般使用<code>Left</code>表示失败，而<code>Right</code>表示成功。</p><p>使用<code>Either</code>改写前面的<code>mean</code>函数：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scala data-lang=scala><span style=display:flex><span><span style=color:#204a87;font-weight:700>def</span> <span style=color:#000>mean</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>xs</span><span style=color:#204a87;font-weight:700>:</span><span style=color:#204a87;font-weight:700>List</span><span style=color:#ce5c00;font-weight:700>[</span><span style=color:#204a87;font-weight:700>Double</span><span style=color:#ce5c00;font-weight:700>])</span><span style=color:#204a87;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>Either</span><span style=color:#ce5c00;font-weight:700>[</span><span style=color:#204a87;font-weight:700>String</span>, <span style=color:#204a87;font-weight:700>Double</span><span style=color:#ce5c00;font-weight:700>]</span> <span style=color:#204a87;font-weight:700>=</span> 
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>if</span> <span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>xs</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>isEmpty</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#000>Left</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;mean of empty list!&#34;</span><span style=color:#ce5c00;font-weight:700>)</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>else</span> <span style=color:#000>Right</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>xs</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>sum</span> <span style=color:#ce5c00;font-weight:700>/</span> <span style=color:#000>xs</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>length</span><span style=color:#ce5c00;font-weight:700>)</span>
</span></span></code></pre></div><p>或者在<code>Left</code>中包含处理的异常以获取详细的调用栈信息：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scala data-lang=scala><span style=display:flex><span><span style=color:#204a87;font-weight:700>def</span> <span style=color:#000>safeDiv</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>x</span><span style=color:#204a87;font-weight:700>:</span><span style=color:#204a87;font-weight:700>Int</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>y</span><span style=color:#204a87;font-weight:700>:</span><span style=color:#204a87;font-weight:700>Int</span><span style=color:#ce5c00;font-weight:700>)</span><span style=color:#204a87;font-weight:700>:</span><span style=color:#204a87;font-weight:700>Either</span><span style=color:#ce5c00;font-weight:700>[</span><span style=color:#204a87;font-weight:700>Exception</span>, <span style=color:#204a87;font-weight:700>Int</span><span style=color:#ce5c00;font-weight:700>]</span> <span style=color:#204a87;font-weight:700>=</span> 
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>try</span> <span style=color:#000>Right</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>x</span> <span style=color:#ce5c00;font-weight:700>/</span> <span style=color:#000>y</span><span style=color:#ce5c00;font-weight:700>)</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>catch</span> <span style=color:#ce5c00;font-weight:700>{</span><span style=color:#204a87;font-weight:700>case</span> <span style=color:#000>e</span><span style=color:#204a87;font-weight:700>:</span><span style=color:#204a87;font-weight:700>Exception</span> <span style=color:#ce5c00;font-weight:700>=&gt;</span> <span style=color:#000>Left</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>e</span><span style=color:#ce5c00;font-weight:700>)}</span>
</span></span></code></pre></div></div></main></div></div><footer class="bg-dark py-5 row d-print-none">
<div class="container-fluid mx-sm-5">
<div class=row>
<div class="col-6 col-sm-4 text-xs-center order-sm-2">
</div><div class="col-6 col-sm-4 text-right text-xs-center order-sm-3">
<ul class="list-inline mb-0">
<li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title=Weibo aria-label=Weibo>
<a class=text-white target=_blank rel="noopener noreferrer" href=https://weibo.com/u/3848950217>
<i class="fab fa-weibo"></i>
</a>
</li><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title=Twitter aria-label=Twitter>
<a class=text-white target=_blank rel="noopener noreferrer" href=https://twitter.com/zhange_zzg>
<i class="fab fa-twitter"></i>
</a>
</li><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title="Stack Overflow" aria-label="Stack Overflow">
<a class=text-white target=_blank rel="noopener noreferrer" href=https://stackoverflow.com>
<i class="fab fa-stack-overflow"></i>
</a>
</li><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title=GitHub aria-label=GitHub>
<a class=text-white target=_blank rel="noopener noreferrer" href=https://github.com/infilos/infilos.com>
<i class="fab fa-github"></i>
</a>
</li></ul></div><div class="col-12 col-sm-4 text-center py-2 order-sm-2">
<small class=text-white>&copy; 2022 infilos.com All Rights Reserved</small>
</div></div></div></footer></div><script src=/js/popper.min.js integrity=sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49 crossorigin=anonymous></script>
<script src=/js/bootstrap.min.js integrity=sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy crossorigin=anonymous></script>
<script src=/js/main.min.3f3f4f1e22307ccbb13271a98be2e4dbb8386b7e67c3d606db44d3d0649f485e.js integrity="sha256-Pz9PHiIwfMuxMnGpi+Lk27g4a35nw9YG20TT0GSfSF4=" crossorigin=anonymous></script>
</body></html>