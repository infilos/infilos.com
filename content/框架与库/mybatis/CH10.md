---
type: docs
title: "CH10-整体流程"
linkTitle: "CH10-整体流程"
weight: 10
---

<div align="center"> <img src="https://infi-img.oss-cn-hangzhou.aliyuncs.com/img/iShot2021-10-10%2016.22.29.png" style="display:block;width:80%;" alt="NAME" align=center /> </div>

## 1. 通过 Resource 加载配置

```java
import org.apache.ibatis.io.Resources;
import org.apache.ibatis.session.SqlSession;
import org.apache.ibatis.session.SqlSessionFactory;
import org.apache.ibatis.session.SqlSessionFactoryBuilder;

import java.io.IOException;
import java.io.InputStream;

public class MyBatisUtils {
    private static SqlSessionFactory sqlSessionFactory;

    static {
        try {
            String resource = "mybatis-config.xml";
            InputStream inputStream = Resources.getResourceAsStream(resource);
            sqlSessionFactory = new SqlSessionFactoryBuilder().build(inputStream);
        } catch (IOException e) {
            e.printStackTrace();
        }
    }

    public static SqlSession getSqlSession() {
        return sqlSessionFactory.openSession();
    }
}
```

## 2. 实例化 sqlSessionFactoryBuilder 构造器

```java
sqlSessionFactory = new SqlSessionFactoryBuilder().build(inputStream);
```

## 3. 通过 build 中 XmlConfigBuilder 类解析文件流以及环境和属性

```java
XMLConfigBuilder parser = new XMLConfigBuilder(inputStream, environment, properties);
var5 = this.build(parser.parse());
```

## 4. 将配置信息存放到 Configuration 中

```java
public SqlSessionFactory build(Configuration config) {
    return new DefaultSqlSessionFactory(config);
}
```

## 5. 实例化 SqlSessionFactory 实现类 DefaultSqlSessionFactory

## 6. 由 TransactionFactory 创建一个 Transaction 事务对象

<div align="center"> <img src="https://infi-img.oss-cn-hangzhou.aliyuncs.com/img/20211010162704.png" style="display:block;width:70%;" alt="NAME" align=center /> </div>

## 7. 创建执行器 Excutor，执行 mapper

<div align="center"> <img src="https://infi-img.oss-cn-hangzhou.aliyuncs.com/img/20211010162729.png" style="display:block;width:70%;" alt="NAME" align=center /> </div>

## 8. 创建 SqlSession 接口实现类 DefaultSqlSession

```java
SqlSession sqlSession = MybatisUtils.getSqlSession()
UserMapper mapper = sqlSession.getMapper(UserMapper.class);
```

## 9. 执行 CRUD

<div align="center"> <img src="https://infi-img.oss-cn-hangzhou.aliyuncs.com/img/20211010162814.png" style="display:block;width:70%;" alt="NAME" align=center /> </div>

## 10. 判断是否成功，失败则回滚到事务提交器

## 11. 提交事务

```java
sqlSession.commit();
```

## 12. 关闭

```java
sqlSession.close();
```
