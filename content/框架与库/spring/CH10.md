---
type: docs
title: "CH10-配置注入"
linkTitle: "CH10-配置注入"
weight: 10
---

## 直接注入

```properties
susan.test.userName=someone
```

```java
@Service
public class UserService {

    @Value("${susan.test.userName}")
    private String userName;

    public String test() {
        System.out.println(userName);
        return userName;
    }
}
```

## 默认值


```properties
@Value(value = "${susan.test.userName:susan}")
private String userName;
```

## 静态变量

```java
@Service
public class UserService {

    private static String userName;

    @Value("${susan.test.userName}")
    public void setUserName(String userName) {
        UserService.userName = userName;
    }

    public String test() {
        return userName;
    }
}
```

## 变量类型

在 Java 中的基本数据类型有4类8种，然我们一起回顾一下：

- 整型：byte、short、int、long
- 浮点型：float、double
- 布尔型：boolean
- 字符型：char

相对应地提供了8种包装类：

- 整型：Byte、Short、Integer、Long
- 浮点型：Float、Double
- 布尔型：Boolean
- 字符型：Character

@Value 注解对这8中基本类型和相应的包装类，有非常良好的支持，例如：

```java
@Value("${susan.test.a:1}")
private byte a;

@Value("${susan.test.b:100}")
private short b;

@Value("${susan.test.c:3000}")
private int c;

@Value("${susan.test.d:4000000}")
private long d;

@Value("${susan.test.e:5.2}")
private float e;

@Value("${susan.test.f:6.1}")
private double f;

@Value("${susan.test.g:false}")
private boolean g;

@Value("${susan.test.h:h}")
private char h;

@Value("${susan.test.a:1}")
private byte a1;

@Value("${susan.test.b:100}")
private Short b1;

@Value("${susan.test.c:3000}")
private Integer c1;

@Value("${susan.test.d:4000000}")
private Long d1;

@Value("${susan.test.e:5.2}")
private Float e1;

@Value("${susan.test.f:6.1}")
private Double f1;

@Value("${susan.test.g:false}")
private Boolean g1;

@Value("${susan.test.h:h}")
private Character h1;
```

## 数组类型

```java
@Value("${susan.test.array:1,2,3,4,5}")
private int[] array;
```

## 集合类型

### List

```properties
susan.test.list[0]=10
susan.test.list[1]=11
susan.test.list[2]=12
susan.test.list[3]=13
```

```java
@Configuration
@ConfigurationProperties(prefix = "susan.test")
@Data
public class MyConfig {
    private List<String> list;
}
```

或：

```java
@Value("#{'${susan.test.list}'.split(',')}")
private List<String> list;
```

### Set

```properties
susan.test.set=10,11,12,13
```

```java
@Value("#{'${susan.test.set}'.split(',')}")
private Set<String> set;
```

支持空值：

```java
@Value("#{'${susan.test.set:}'.empty ? null : '${susan.test.set:}'.split(',')}")
private Set<String> set;
```

### Map

```properties
susan.test.map={"name":"苏三", "age":"18"}
```

```java
@Value("#{'${susan.test.map:}'.empty ? null : '${susan.test.map:}'}")
private Map<String, String> map;
```

## 注入 Bean

```java
@Service
public class RoleService {
    public static final int DEFAULT_AGE = 18;
    public int id = 1000;

    public String getRoleName() {
        return "管理员";
    }

    public static int getParentId() {
        return 2000;
    }
}
```

```java
@Service
public class UserService {

    @Value("#{roleService.DEFAULT_AGE}")
    private int myAge;

    @Value("#{roleService.id}")
    private int id;

    @Value("#{roleService.getRoleName()}")
    private String myRoleName;

    @Value("#{roleService.getParentId()}")
    private String myParentId;

    public String test() {
        System.out.println(myAge);
        System.out.println(id);
        System.out.println(myRoleName);
        System.out.println(myParentId);
        return null;
    }
}
```

## 静态类

```java
@Value("#{T(java.io.File).separator}")
private String path;

@Value("#{T(java.lang.Math).random()}")
private double randomValue;
```

## 逻辑运算

```java
@Value("#{roleService.roleName + '' + roleService.DEFAULT_AGE}")
private String value;

@Value("#{roleService.DEFAULT_AGE > 16 and roleService.roleName.equals('苏三')}")
private String operation;

@Value("#{roleService.DEFAULT_AGE > 16 ? roleService.roleName: '苏三' }")
private String realRoleName;
```

## `${}` 与 `#{}`

### `${}`

用于获取配置文件中的系统属性值。

```java
@Value(value = "${susan.test.userName:susan}")
private String userName;
```

通过 `:` 可以设置默认值。如果在配置文件中找不到susan.test.userName的配置，则注入时用默认值。

### `#{}`

主要用于通过spring的EL表达式，获取bean的属性，或者调用bean的某个方法。还有调用类的静态常量和静态方法。

```java
@Value("#{roleService.DEFAULT_AGE}")
private int myAge;

@Value("#{roleService.id}")
private int id;

@Value("#{roleService.getRoleName()}")
private String myRoleName;

@Value("#{T(java.lang.Math).random()}")
private double randomValue;
```

如果是调用类的静态方法，则需要加T(包名 + 方法名称)。
