<!doctype html><html lang=zh class=no-js>
<head>
<meta charset=utf-8>
<meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no">
<meta name=generator content="Hugo 0.92.2">
<meta name=ROBOTS content="INDEX, FOLLOW">
<link rel="shortcut icon" href=/favicons/favicon.ico>
<link rel=apple-touch-icon href=/favicons/apple-touch-icon-180x180.png sizes=180x180>
<link rel=icon type=image/png href=/favicons/favicon-16x16.png sizes=16x16>
<link rel=icon type=image/png href=/favicons/favicon-32x32.png sizes=32x32>
<link rel=icon type=image/png href=/favicons/android-36x36.png sizes=36x36>
<link rel=icon type=image/png href=/favicons/android-48x48.png sizes=48x48>
<link rel=icon type=image/png href=/favicons/android-72x72.png sizes=72x72>
<link rel=icon type=image/png href=/favicons/android-96x96.png sizes=96x96>
<link rel=icon type=image/png href=/favicons/android-144x144.png sizes=144x144>
<link rel=icon type=image/png href=/favicons/android-192x192.png sizes=192x192>
<title>Token 多平台认证 | infilos.com</title><meta property="og:title" content="Token 多平台认证">
<meta property="og:description" content="概述 在存在账号体系的信息系统中，对身份的鉴定是非常重要的事情。随着移动互联网时代到来，客户端的类型越来越多， 逐渐出现了 一个服务器，N 个客户端的格局 。
 不同的客户端产生了不同的用户使用场景，这些场景：
 有不同的环境安全威胁 不同的会话生存周期 不同的用户权限控制体系 不同级别的接口调用方式  综上所述，它们的身份认证方式也存在一定的区别。
应用场景 下面是一些在 IT 服务常见的一些使用场景:
 用户在web浏览器端登录系统,使用系统服务 用户在手机端（Android/iOS）登录系统,使用系统服务 用户使用开放接口登录系统,调用系统服务 用户在PC处理登录状态时通过手机扫码授权手机登录（使用得比较少） 用户在手机处理登录状态进通过手机扫码授权PC进行登录（比较常见）  通过对场景的细分,得到如下不同的认证token类别：
 原始账户密码  用户名和密码 API 应用 ID/KEY   会话 ID  浏览器端 token 移动端 token API 应用 token   接口调用  接口访问 token 身份授权 PC 和移动端相互授权的 token    Token 的类别 不同场景的 token 进行如下几个维度的对比：
天然属性对比   使用成本：本认证方式在使用的时候,造成的不便性。比如:
  账号密码需要用户打开页面然后逐个键入">
<meta property="og:type" content="article">
<meta property="og:url" content="/%E7%94%A8%E6%88%B7%E7%B3%BB%E7%BB%9F/%E7%94%A8%E6%88%B7%E8%AE%A4%E8%AF%81/multi-platform/"><meta property="article:section" content="用户系统">
<meta property="og:site_name" content="infilos.com">
<meta itemprop=name content="Token 多平台认证">
<meta itemprop=description content="概述 在存在账号体系的信息系统中，对身份的鉴定是非常重要的事情。随着移动互联网时代到来，客户端的类型越来越多， 逐渐出现了 一个服务器，N 个客户端的格局 。
 不同的客户端产生了不同的用户使用场景，这些场景：
 有不同的环境安全威胁 不同的会话生存周期 不同的用户权限控制体系 不同级别的接口调用方式  综上所述，它们的身份认证方式也存在一定的区别。
应用场景 下面是一些在 IT 服务常见的一些使用场景:
 用户在web浏览器端登录系统,使用系统服务 用户在手机端（Android/iOS）登录系统,使用系统服务 用户使用开放接口登录系统,调用系统服务 用户在PC处理登录状态时通过手机扫码授权手机登录（使用得比较少） 用户在手机处理登录状态进通过手机扫码授权PC进行登录（比较常见）  通过对场景的细分,得到如下不同的认证token类别：
 原始账户密码  用户名和密码 API 应用 ID/KEY   会话 ID  浏览器端 token 移动端 token API 应用 token   接口调用  接口访问 token 身份授权 PC 和移动端相互授权的 token    Token 的类别 不同场景的 token 进行如下几个维度的对比：
天然属性对比   使用成本：本认证方式在使用的时候,造成的不便性。比如:
  账号密码需要用户打开页面然后逐个键入">
<meta itemprop=wordCount content="218">
<meta itemprop=keywords content><meta name=twitter:card content="summary">
<meta name=twitter:title content="Token 多平台认证">
<meta name=twitter:description content="概述 在存在账号体系的信息系统中，对身份的鉴定是非常重要的事情。随着移动互联网时代到来，客户端的类型越来越多， 逐渐出现了 一个服务器，N 个客户端的格局 。
 不同的客户端产生了不同的用户使用场景，这些场景：
 有不同的环境安全威胁 不同的会话生存周期 不同的用户权限控制体系 不同级别的接口调用方式  综上所述，它们的身份认证方式也存在一定的区别。
应用场景 下面是一些在 IT 服务常见的一些使用场景:
 用户在web浏览器端登录系统,使用系统服务 用户在手机端（Android/iOS）登录系统,使用系统服务 用户使用开放接口登录系统,调用系统服务 用户在PC处理登录状态时通过手机扫码授权手机登录（使用得比较少） 用户在手机处理登录状态进通过手机扫码授权PC进行登录（比较常见）  通过对场景的细分,得到如下不同的认证token类别：
 原始账户密码  用户名和密码 API 应用 ID/KEY   会话 ID  浏览器端 token 移动端 token API 应用 token   接口调用  接口访问 token 身份授权 PC 和移动端相互授权的 token    Token 的类别 不同场景的 token 进行如下几个维度的对比：
天然属性对比   使用成本：本认证方式在使用的时候,造成的不便性。比如:
  账号密码需要用户打开页面然后逐个键入">
<script type=application/javascript>var doNotTrack=!1;doNotTrack||(window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga('create','UA-123062585-1','auto'),ga('send','pageview'))</script>
<script async src=https://www.google-analytics.com/analytics.js></script>
<link rel=preload href=/scss/main.min.847464b684a6e89d7276700a5c500c17ab494dd1755b2654a7b27d8b59e3347e.css as=style>
<link href=/scss/main.min.847464b684a6e89d7276700a5c500c17ab494dd1755b2654a7b27d8b59e3347e.css rel=stylesheet integrity>
<script src=/js/jquery-3.5.1.min.js integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin=anonymous></script>
</head>
<body class=td-page>
<header>
<nav class="js-navbar-scroll navbar navbar-expand navbar-dark flex-column flex-md-row td-navbar">
<a class=navbar-brand href=/>
<span class=navbar-logo><svg id="Capa_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 512 512" style="enable-background:new 0 0 512 512"><path style="fill:#ffc107" d="M432.384 143.616c-4.165-4.164-10.917-4.164-15.083.0l-60.352 60.352c-4.164 4.165-4.164 10.917.0 15.083 21.187 20.463 54.951 19.876 75.413-1.311 19.962-20.668 19.962-53.435.0-74.102L432.384 143.616z"/><path style="fill:#607d8b" d="M42.667 277.334c-5.891.003-10.669-4.771-10.672-10.662-.002-4.338 2.623-8.245 6.64-9.882l234.667-96c5.455-2.233 11.687.38 13.92 5.835s-.38 11.687-5.835 13.92l-234.667 96C45.433 277.069 44.056 277.337 42.667 277.334z"/><path style="fill:#546e7a" d="M391.552 56.448l-32-32C343.938 8.745 322.689-.059 300.544.0h-3.755c-46.082.024-83.432 37.374-83.456 83.456v3.755c-.053 22.138 8.75 43.377 24.448 58.987l32 32c4.165 4.164 10.917 4.164 15.083.0L391.531 71.531C395.701 67.372 395.71 60.62 391.552 56.448z"/><path style="fill:#607d8b" d="M160 469.334c-3.279.006-6.379-1.497-8.405-4.075L34.261 315.926c-3.635-4.636-2.823-11.341 1.813-14.976s11.341-2.823 14.976 1.813l117.333 149.333c3.629 4.641 2.809 11.344-1.832 14.973C164.681 468.533 162.375 469.329 160 469.334z"/><path style="fill:#455a64" d="M487.467 86.848l-3.669-3.648c-37.687-36.557-97.71-36.197-134.955.811l-51.413 51.413c-36.996 37.25-37.357 97.263-.811 134.955l3.584 3.669c1.7 2.457 4.671 3.706 7.616 3.2 2.831.005 5.548-1.115 7.552-3.115l172.181-172.181c4.189-4.143 4.226-10.896.083-15.085-.028-.028-.055-.056-.083-.083L487.467 86.848z"/><g><path style="fill:#ffc107" d="M501.333 192H480c-5.891.0-10.667-4.776-10.667-10.667s4.776-10.667 10.667-10.667h21.333c5.891.0 10.667 4.776 10.667 10.667S507.225 192 501.333 192z"/><path style="fill:#ffc107" d="M394.667 298.667c-5.891.0-10.667-4.776-10.667-10.667v-21.333c0-5.891 4.776-10.667 10.667-10.667 5.891.0 10.667 4.776 10.667 10.667V288C405.333 293.891 400.558 298.667 394.667 298.667z"/><path style="fill:#ffc107" d="M480 277.334c-2.831.005-5.548-1.115-7.552-3.115l-21.333-21.333c-4.093-4.237-3.975-10.99.262-15.083 4.134-3.993 10.687-3.993 14.821.0l21.333 21.333c4.159 4.172 4.148 10.926-.024 15.085C485.514 276.209 482.815 277.327 480 277.334z"/></g><g><path style="fill:#455a64" d="M266.667 448H96c-29.455.0-53.333 23.878-53.333 53.333.0 5.891 4.776 10.667 10.667 10.667h256c5.891.0 10.667-4.776 10.667-10.667C320 471.878 296.122 448 266.667 448z"/><circle style="fill:#455a64" cx="32" cy="288" r="32"/></g><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/></svg></span><span class=font-weight-bold>infilos.com</span>
</a>
<div class="collapse navbar-collapse" id=navbarSupportedContent>
<ul class="navbar-nav mr-auto">
<li class=nav-item style=max-width:90px;min-width:10px>
<a class=nav-link href=/%e5%9f%ba%e7%a1%80%e7%9f%a5%e8%af%86>
<span>基础</span>
</a>
</li>
<li class=nav-item style=max-width:90px;min-width:10px>
<a class=nav-link href=/%e7%bc%96%e7%a8%8b%e8%af%ad%e8%a8%80>
<span>语言</span>
</a>
</li>
<li class=nav-item style=max-width:90px;min-width:10px>
<a class=nav-link href=/%e6%a1%86%e6%9e%b6%e4%b8%8e%e5%ba%93>
<span>框架库</span>
</a>
</li>
<li class="nav-item dropdown" style=max-width:90px;min-width:10px>
<a class="nav-link dropdown-toggle" href=# id=navbarDropdown role=button data-toggle=dropdown aria-haspopup=true aria-expanded=false>
分布式
<span>+</span>
</a>
<div class=dropdown-menu aria-labelledby=navbarDropdown>
<a class=dropdown-item href=/%e5%88%86%e5%b8%83%e5%bc%8f/base>基本构成</a>
</div>
</li>
<li class="nav-item dropdown" style=max-width:90px;min-width:10px>
<a class="nav-link dropdown-toggle" href=# id=navbarDropdown role=button data-toggle=dropdown aria-haspopup=true aria-expanded=false>
大数据
<span>+</span>
</a>
<div class=dropdown-menu aria-labelledby=navbarDropdown>
<a class=dropdown-item href=/%e5%ad%98%e5%82%a8%e7%b3%bb%e7%bb%9f>存储系统</a>
<a class=dropdown-item href=/%e6%9f%a5%e8%af%a2%e7%b3%bb%e7%bb%9f>查询系统</a>
<a class=dropdown-item href=/%e6%b6%88%e6%81%af%e7%b3%bb%e7%bb%9f>消息系统</a>
<a class=dropdown-item href=/%e5%a4%84%e7%90%86%e7%b3%bb%e7%bb%9f>处理系统</a>
<a class=dropdown-item href=/%e6%95%b0%e6%8d%ae%e6%b2%bb%e7%90%86>数据治理</a>
</div>
</li>
<li class="nav-item dropdown" style=max-width:90px;min-width:10px>
<a class="nav-link dropdown-toggle" href=# id=navbarDropdown role=button data-toggle=dropdown aria-haspopup=true aria-expanded=false>
中后台
<span>+</span>
</a>
<div class=dropdown-menu aria-labelledby=navbarDropdown>
<a class=dropdown-item href=/%e5%9f%ba%e7%a1%80%e8%ae%be%e6%96%bd>基础设施</a>
<a class=dropdown-item href=/%e7%94%a8%e6%88%b7%e7%b3%bb%e7%bb%9f>用户系统</a>
<a class=dropdown-item href=/%e4%ba%a4%e4%ba%92%e7%95%8c%e9%9d%a2>交互界面</a>
<a class=dropdown-item href=/%e4%b8%9a%e5%8a%a1%e7%b3%bb%e7%bb%9f>业务系统</a>
</div>
</li>
<li class=nav-item style=max-width:90px;min-width:10px>
<a class=nav-link href=/%e6%a8%a1%e5%bc%8f%e6%9e%b6%e6%9e%84>
<span>模式架构</span>
</a>
</li>
<li class=nav-item style=max-width:90px;min-width:10px>
<a class=nav-link href=/%e9%9d%a2%e8%af%95%e9%97%ae%e7%ad%94>
<span>面试</span>
</a>
</li>
<li class=nav-item style=max-width:90px;min-width:10px>
<a class=nav-link href=/%e7%ae%a1%e7%90%86%e8%b7%af%e5%be%84>
<span>管理</span>
</a>
</li>
<li class=nav-item style=max-width:90px;min-width:10px>
<a class=nav-link href=/%e5%bc%80%e6%ba%90%e9%a1%b9%e7%9b%ae>
<span>开源</span>
</a>
</li>
</ul>
<div class="form-inline my-2 my-lg-0">
<div class="nav-item nav-search-item my-2 my-md-0">
<input type=search class="form-control td-search-input" placeholder="&#xf002; 站内搜索…" aria-label=站内搜索… autocomplete=off>
</div>
</div>
</div>
</nav>
</header>
<div class="container-fluid td-outer">
<div class=td-main>
<div class="row flex-xl-nowrap">
<aside class="col-12 col-md-3 col-xl-2 td-sidebar d-print-none">
<div id=td-sidebar-menu class=td-sidebar__inner>
<div id=content-mobile>
<form class="td-sidebar__search d-flex align-items-center">
<input type=search class="form-control td-search-input" placeholder="&#xf002; 站内搜索…" aria-label=站内搜索… autocomplete=off>
<button class="btn btn-link td-sidebar__toggle d-md-none p-0 ml-3 fas fa-bars" type=button data-toggle=collapse data-target=#td-section-nav aria-controls=td-docs-nav aria-expanded=false aria-label="Toggle section navigation">
</button>
</form>
</div>
<div id=content-desktop></div>
<nav class="collapse td-sidebar-nav" id=td-section-nav>
<ul class="td-sidebar-nav__section pr-md-3 ul-0">
<li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child active-path" id=m-e794a8e688b7e7b3bbe7bb9f-li>
<a href=/%E7%94%A8%E6%88%B7%E7%B3%BB%E7%BB%9F/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section tree-root" id=m-e794a8e688b7e7b3bbe7bb9f><span>用户系统</span></a>
<ul class=ul-1>
<li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child active-path" id=m-e794a8e688b7e7b3bbe7bb9fe794a8e688b7e8aea4e8af81-li>
<a href=/%E7%94%A8%E6%88%B7%E7%B3%BB%E7%BB%9F/%E7%94%A8%E6%88%B7%E8%AE%A4%E8%AF%81/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-e794a8e688b7e7b3bbe7bb9fe794a8e688b7e8aea4e8af81><span>用户认证</span></a>
<ul class="ul-2 foldable">
<li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-e794a8e688b7e7b3bbe7bb9fe794a8e688b7e8aea4e8af81auth-method-li>
<a href=/%E7%94%A8%E6%88%B7%E7%B3%BB%E7%BB%9F/%E7%94%A8%E6%88%B7%E8%AE%A4%E8%AF%81/auth-method/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-e794a8e688b7e7b3bbe7bb9fe794a8e688b7e8aea4e8af81auth-method><span>认证方法</span></a>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child active-path" id=m-e794a8e688b7e7b3bbe7bb9fe794a8e688b7e8aea4e8af81multi-platform-li>
<a href=/%E7%94%A8%E6%88%B7%E7%B3%BB%E7%BB%9F/%E7%94%A8%E6%88%B7%E8%AE%A4%E8%AF%81/multi-platform/ class="align-left pl-0 active td-sidebar-link td-sidebar-link__page" id=m-e794a8e688b7e7b3bbe7bb9fe794a8e688b7e8aea4e8af81multi-platform><span class=td-sidebar-nav-active-item>Token 多平台认证</span></a>
</li>
</ul>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-e794a8e688b7e7b3bbe7bb9fe794a8e688b7e68e88e69d83-li>
<a href=/%E7%94%A8%E6%88%B7%E7%B3%BB%E7%BB%9F/%E7%94%A8%E6%88%B7%E6%8E%88%E6%9D%83/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-e794a8e688b7e7b3bbe7bb9fe794a8e688b7e68e88e69d83><span>用户授权</span></a>
</li>
</ul>
</li>
</ul>
</nav>
</div>
</aside>
<aside class="d-none d-xl-block col-xl-2 td-sidebar-toc d-print-none">
<div class="td-page-meta ml-2 pb-1 pt-2 mb-0">
<a href=https://github.com/infilos/infilos.com/edit/master/content/zh/%e7%94%a8%e6%88%b7%e7%b3%bb%e7%bb%9f/%e7%94%a8%e6%88%b7%e8%ae%a4%e8%af%81/multi-platform.md target=_blank><i class="fa fa-edit fa-fw"></i> 编辑此页</a>
<a href="https://github.com/infilos/infilos.com/new/master/content/zh/%e7%94%a8%e6%88%b7%e7%b3%bb%e7%bb%9f/%e7%94%a8%e6%88%b7%e8%ae%a4%e8%af%81/multi-platform.md?filename=change-me.md&value=---%0Atitle%3A+%22Long+Page+Title%22%0AlinkTitle%3A+%22Short+Nav+Title%22%0Aweight%3A+100%0Adescription%3A+%3E-%0A+++++Page+description+for+heading+and+indexes.%0A---%0A%0A%23%23+Heading%0A%0AEdit+this+template+to+create+your+new+page.%0A%0A%2A+Give+it+a+good+name%2C+ending+in+%60.md%60+-+e.g.+%60getting-started.md%60%0A%2A+Edit+the+%22front+matter%22+section+at+the+top+of+the+page+%28weight+controls+how+its+ordered+amongst+other+pages+in+the+same+directory%3B+lowest+number+first%29.%0A%2A+Add+a+good+commit+message+at+the+bottom+of+the+page+%28%3C80+characters%3B+use+the+extended+description+field+for+more+detail%29.%0A%2A+Create+a+new+branch+so+you+can+preview+your+new+file+and+request+a+review+via+Pull+Request.%0A" target=_blank><i class="fa fa-edit fa-fw"></i> 添加子页面</a>
<a href="https://github.com/infilos/infilos.com/issues/new?title=Token%20%e5%a4%9a%e5%b9%b3%e5%8f%b0%e8%ae%a4%e8%af%81" target=_blank><i class="fab fa-github fa-fw"></i> 提交文档问题</a>
<a id=print href=/%E7%94%A8%E6%88%B7%E7%B3%BB%E7%BB%9F/%E7%94%A8%E6%88%B7%E8%AE%A4%E8%AF%81/_print/><i class="fa fa-print fa-fw"></i> 整节打印</a>
</div>
<div class=td-toc><nav id=TableOfContents>
<ul>
<li><a href=#概述>概述</a></li>
<li><a href=#应用场景>应用场景</a></li>
<li><a href=#token-的类别>Token 的类别</a>
<ul>
<li><a href=#天然属性对比>天然属性对比</a></li>
<li><a href=#可控属性对比>可控属性对比</a></li>
<li><a href=#最终目标安全和影响>最终目标：安全和影响</a></li>
</ul>
</li>
<li><a href=#token-的层级关系>Token 的层级关系</a>
<ul>
<li><a href=#账户密码>账户密码</a></li>
<li><a href=#客户端会话-token>客户端会话 Token</a></li>
<li><a href=#access_token>access_token</a></li>
<li><a href=#pam_token>pam_token</a></li>
<li><a href=#map_token>map_token</a></li>
</ul>
</li>
<li><a href=#总结>总结</a></li>
</ul>
</nav></div>
</aside>
<main class="col-12 col-md-9 col-xl-8 pl-md-5" role=main>
<nav aria-label=breadcrumb class="d-none d-md-block d-print-none">
<ol class="breadcrumb spb-1">
<li class=breadcrumb-item>
<a href=/%E7%94%A8%E6%88%B7%E7%B3%BB%E7%BB%9F/>用户系统</a>
</li>
<li class=breadcrumb-item>
<a href=/%E7%94%A8%E6%88%B7%E7%B3%BB%E7%BB%9F/%E7%94%A8%E6%88%B7%E8%AE%A4%E8%AF%81/>用户认证</a>
</li>
<li class="breadcrumb-item active" aria-current=page>
<a href=/%E7%94%A8%E6%88%B7%E7%B3%BB%E7%BB%9F/%E7%94%A8%E6%88%B7%E8%AE%A4%E8%AF%81/multi-platform/>Token 多平台认证</a>
</li>
</ol>
</nav>
<div class=td-content>
<h1>Token 多平台认证</h1>
<header class=article-meta>
</header>
<h2 id=概述>概述</h2>
<p>在存在账号体系的信息系统中，对身份的鉴定是非常重要的事情。随着移动互联网时代到来，客户端的类型越来越多， 逐渐出现了 一个服务器，N 个客户端的格局 。</p>
<div><img src=https://infi-img.oss-cn-hangzhou.aliyuncs.com/img/20220220221550.png style=display:block;margin-left:auto;margin-right:auto;width:60% alt=20220220221550></div>
<p>不同的客户端产生了不同的用户使用场景，这些场景：</p>
<ul>
<li>有不同的环境安全威胁</li>
<li>不同的会话生存周期</li>
<li>不同的用户权限控制体系</li>
<li>不同级别的接口调用方式</li>
</ul>
<p>综上所述，它们的身份认证方式也存在一定的区别。</p>
<h2 id=应用场景>应用场景</h2>
<p>下面是一些在 IT 服务常见的一些使用场景:</p>
<ul>
<li>用户在web浏览器端登录系统,使用系统服务</li>
<li>用户在手机端（Android/iOS）登录系统,使用系统服务</li>
<li>用户使用开放接口登录系统,调用系统服务</li>
<li>用户在PC处理登录状态时通过手机扫码授权手机登录（使用得比较少）</li>
<li>用户在手机处理登录状态进通过手机扫码授权PC进行登录（比较常见）</li>
</ul>
<p>通过对场景的细分,得到如下不同的认证token类别：</p>
<ol>
<li>原始账户密码
<ol>
<li>用户名和密码</li>
<li>API 应用 ID/KEY</li>
</ol>
</li>
<li>会话 ID
<ol>
<li>浏览器端 token</li>
<li>移动端 token</li>
<li>API 应用 token</li>
</ol>
</li>
<li>接口调用
<ol>
<li>接口访问 token</li>
<li>身份授权</li>
<li>PC 和移动端相互授权的 token</li>
</ol>
</li>
</ol>
<h2 id=token-的类别>Token 的类别</h2>
<p>不同场景的 token 进行如下几个维度的对比：</p>
<h3 id=天然属性对比>天然属性对比</h3>
<ul>
<li>
<p>使用成本：本认证方式在使用的时候,造成的不便性。比如:</p>
<ul>
<li>
<p>账号密码需要用户打开页面然后逐个键入</p>
</li>
<li>
<p>二维码需要用户掏出手机进行扫码操作</p>
</li>
</ul>
</li>
<li>
<p>变化成本：本认证方式,token发生变化时,用户需要做出的相应更改的成本:</p>
<ul>
<li>
<p>用户名和密码发生变化时,用户需要额外记忆和重新键入新密码</p>
</li>
<li>
<p>API应用ID/KEY发生变化时,第三方应用需要重新在代码中修改并部署</p>
</li>
<li>
<p>授权二维码发生变化时,需要用户重新打开手机应用进行扫码</p>
</li>
</ul>
</li>
<li>
<p>环境风险</p>
<ul>
<li>
<p>被偷窥的风险</p>
</li>
<li>
<p>被抓包的风险</p>
</li>
<li>
<p>被伪造的风险</p>
</li>
</ul>
</li>
</ul>
<h3 id=可控属性对比>可控属性对比</h3>
<ul>
<li>使用频率
<ul>
<li>在网路中传送的频率。</li>
</ul>
</li>
<li>有效时间
<ul>
<li>此token从创建到终结的生存时间</li>
</ul>
</li>
</ul>
<h3 id=最终目标安全和影响>最终目标：安全和影响</h3>
<p>安全和隐私性主要体现在:</p>
<ul>
<li>token 不容易被窃取和盗用（通过对传送频率控制）</li>
<li>token 即使被窃取,产生的影响也是可控的（通过对有效时间控制）</li>
</ul>
<p>关于隐私及隐私破坏后的后果,有如下的基本结论:</p>
<ul>
<li>曝光频率高的容易被截获</li>
<li>生存周期长的在被截获后产生的影响更严重和深远</li>
</ul>
<p>遵守如下原则:</p>
<ul>
<li>变化成本高的token不要轻易变化</li>
<li>不轻易变化的token要减少曝光频率（网络传输次数）</li>
<li>曝光频率高的token的生存周期要尽量短</li>
</ul>
<p>将各类token的固有特点及可控属性进行调控后, 对每个指标进行量化评分（1~5分），我们可以得到如下的对比表：</p>
<div><img src=https://infi-img.oss-cn-hangzhou.aliyuncs.com/img/20220220222115.png style=display:block;margin-left:auto;margin-right:auto;width:80% alt=20220220222115></div>
<blockquote>
<p>备注：user_name/passwd 和 app_id/app_key 是等价的效果</p>
</blockquote>
<h2 id=token-的层级关系>Token 的层级关系</h2>
<p>参考上一节的对比表，可以很容易对这些不同用途的token进行分层，主要可以分为4层：</p>
<ul>
<li>密码层：最传统的用户和系统之间约定的数字身份认证方式</li>
<li>会话层：用户登录后的会话生命周期的会话认证</li>
<li>调用层：用户在会话期间对应用程序接口的调用认证</li>
<li>应用层：用户获取了接口访问调用权限后的一些场景或者身份认证应用</li>
</ul>
<p>Token 的分层图如下：</p>
<div><img src=https://infi-img.oss-cn-hangzhou.aliyuncs.com/img/20220220222208.png style=display:block;margin-left:auto;margin-right:auto;width:80% alt=20220220222208></div>
<p>在一个多客户端的信息系统里面,这些token的产生及应用的内在联系如下:</p>
<ul>
<li>用户输入用户名和用户口令进行一次性认证</li>
<li>在 不同 的终端里面生成拥有 不同 生命周期的会话token</li>
<li>客户端会话token从服务端交换生命周期短但曝光 频繁 的接口访问token</li>
<li>会话token可以生成和刷新延长 access_token 的生存时间</li>
<li>access_token可以生成生存周期最短的用于授权的二维码的token</li>
</ul>
<p>使用如上的架构有如下的好处：</p>
<ul>
<li>良好的统一性：可以解决不同平台上认证token的生存周期的 归一化 问题</li>
<li>良好的解耦性：核心接口调用服务器的认证 access_token 可以完成独立的实现和部署</li>
<li>良好的层次性：不同平台的可以有完全不同的用户权限控制系统，这个控制可以在 会话层 中各平台解决掉</li>
</ul>
<h3 id=账户密码>账户密码</h3>
<p>广义的 账号/密码 有如下的呈现方式:</p>
<ul>
<li>传统的注册用户名和密码</li>
<li>应用程序的app_id/app_key</li>
</ul>
<p>它们的特点如下：</p>
<ul>
<li>会有特别的意义
<ul>
<li>比如：用户自己为了方便记忆，会设置有一定含义的账号和密码。</li>
</ul>
</li>
<li>不常修改
<ul>
<li>账号密码对用户有特别含义，一般没有特殊情况不会愿意修改。而app_id/app_key则会写在应用程序中，修改会意味着重新发布上线的成本。</li>
</ul>
</li>
<li><strong>一旦泄露影响深远</strong>
<ul>
<li>正因为不常修改，只要泄露了基本相当于用户的网络身份被泄露，而且只要没被察觉这种身份盗用就会一直存在。</li>
<li>所以在认证系统中应该尽量减少传输的机会，避免泄露。</li>
</ul>
</li>
</ul>
<h3 id=客户端会话-token>客户端会话 Token</h3>
<p><strong>功能</strong>：充当着session的角色，不同的客户端有不同的生命周期。</p>
<p>使用步骤：用户使用账号密码，换取会话token。</p>
<p>不同的平台的 token 有不同的特点：</p>
<ul>
<li>Web 平台生存周期短，主要原因是：
<ul>
<li>环境安全性：由于web登录环境一般很可能是公共环境，被他人盗取的风险值较大。</li>
<li>输入便捷性：在PC上使用键盘输入会比较便捷。</li>
</ul>
</li>
<li><strong>移动端生存周期长，主要原因是</strong>：
<ul>
<li>环境安全性：移动端平台是个人用户极其私密的平台，它人接触的机会不大。</li>
<li>输入便捷性：在移动端上使用手指在小屏幕上触摸输入体验差，输入成本高。</li>
</ul>
</li>
</ul>
<h3 id=access_token>access_token</h3>
<p>**功能：**服务端应用程序api接口访问和调用的凭证。</p>
<p>**使用步骤：**使用具有较长生命周期的会话token来换取此接口访问token。</p>
<p>其曝光频率直接和接口调用频率有关，属于高频使用的凭证。为了照顾到隐私性，尽量减少其生命周期，即使被截取了，也不至于产生严重的后果。</p>
<blockquote>
<p>注意：在客户端token之下还加上一个access_token， 主要是为了让具有不同生命周期的客户端token最后在调用 API 的时候， 能够具有统一的认证方式。</p>
</blockquote>
<h3 id=pam_token>pam_token</h3>
<p>**功能：**由已经登录和认证的PC端生成的二维码的原始串号（Pc Auth Mobile）。</p>
<p><strong>主要步骤如下：</strong></p>
<ol>
<li>PC上用户已经完成认证，登录了系统</li>
<li>PC端生成一组和此用户相关联的pam_token</li>
<li>PC端将此pam_token的使用链接生成二维码</li>
<li>移动端扫码后，请求服务器，并和用户信息关联</li>
<li>移动端获取refresh_token(长时效的会话)</li>
<li>根据 refresh_token 获取 access_token</li>
<li>完成正常的接口调用工作</li>
</ol>
<blockquote>
<p>备注:</p>
<ul>
<li>生存周期为2分钟,2分钟后过期删除</li>
<li>没有被使用时,每1分钟变一次</li>
<li>被使用后,立刻删除掉</li>
<li>此种认证模式一般不会被使用到</li>
</ul>
</blockquote>
<h3 id=map_token>map_token</h3>
<p>**功能：**由已经登录的移动app来扫码认证PC端系统，并完成PC端系统的登录（Mobile Auth Pc）。</p>
<p><strong>主要步骤：</strong></p>
<ol>
<li>移动端完成用户身份的认证登录app</li>
<li>未登录的PC生成匿名的 map_token</li>
<li>移动端扫码后在db中生成 map_token 和用户关联（完成签名）</li>
<li>db同时针对此用户生成 web_token</li>
<li>PC端一直以 map_token 为参数查找此命名用户的 web_token</li>
<li>PC端根据 web_token 去获取 access_token</li>
<li>后续正常的调用接口调用工作</li>
</ol>
<blockquote>
<p>备注:</p>
<ul>
<li>生存周期为2分钟,2分钟后过期删除</li>
<li>没有被使用时,每1分钟变一次</li>
<li>被使用后,立刻删除掉</li>
</ul>
</blockquote>
<h2 id=总结>总结</h2>
<p>本文所设计的基于token的身份认证系统，主要解决了如下的问题：</p>
<ul>
<li>token的分类问题</li>
<li>token的隐私性参数设置问题</li>
<li>token的使用场景问题</li>
<li>不同生命周期的token分层转化关系</li>
</ul>
<p>本文中提到的设计方法，在 应用层 中可以适用于且不限于如下场景中：</p>
<ul>
<li>用户登录</li>
<li>有时效的优惠券发放</li>
<li>有时效的邀请码发放</li>
<li>有时效的二维码授权</li>
<li>具有时效 手机/邮件 验证码</li>
<li>多个不同平台调用同一套API接口</li>
<li>多个平台使用同一个身份认证中心</li>
</ul>
<style>.feedback--answer{display:inline-block}.feedback--answer-no{margin-left:1em}.feedback--response{display:none;margin-top:1em}.feedback--response__visible{display:block}</style>
<div class=d-print-none>
<h2 class=feedback--title>Feedback</h2>
<p class=feedback--question>Was this page helpful?</p>
<button class="btn btn-primary mb-4 feedback--answer feedback--answer-yes">Yes</button>
<button class="btn btn-primary mb-4 feedback--answer feedback--answer-no">No</button>
<p class="feedback--response feedback--response-yes">
Glad to hear it! Please <a href=https://github.com/infilos/infilos.com/issues/new>tell us how we can improve</a>.
</p>
<p class="feedback--response feedback--response-no">
Sorry to hear that. Please <a href=https://github.com/infilos/infilos.com/issues/new>tell us how we can improve</a>.
</p>
</div>
<script>const yesButton=document.querySelector('.feedback--answer-yes'),noButton=document.querySelector('.feedback--answer-no'),yesResponse=document.querySelector('.feedback--response-yes'),noResponse=document.querySelector('.feedback--response-no'),disableButtons=()=>{yesButton.disabled=!0,noButton.disabled=!0},sendFeedback=b=>{if(typeof ga!='function')return;const a={command:'send',hitType:'event',category:'Helpful',action:'click',label:window.location.pathname,value:b};ga(a.command,a.hitType,a.category,a.action,a.label,a.value)};yesButton.addEventListener('click',()=>{yesResponse.classList.add('feedback--response__visible'),disableButtons(),sendFeedback(1)}),noButton.addEventListener('click',()=>{noResponse.classList.add('feedback--response__visible'),disableButtons(),sendFeedback(0)})</script>
<br>
</div>
</main>
</div>
</div>
<footer class="bg-dark py-5 row d-print-none">
<div class="container-fluid mx-sm-5">
<div class=row>
<div class="col-6 col-sm-4 text-xs-center order-sm-2">
</div>
<div class="col-6 col-sm-4 text-right text-xs-center order-sm-3">
<ul class="list-inline mb-0">
<li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title=Weibo aria-label=Weibo>
<a class=text-white target=_blank rel="noopener noreferrer" href=https://weibo.com/u/3848950217>
<i class="fab fa-weibo"></i>
</a>
</li>
<li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title=Twitter aria-label=Twitter>
<a class=text-white target=_blank rel="noopener noreferrer" href=https://twitter.com/zhange_zzg>
<i class="fab fa-twitter"></i>
</a>
</li>
<li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title="Stack Overflow" aria-label="Stack Overflow">
<a class=text-white target=_blank rel="noopener noreferrer" href=https://stackoverflow.com>
<i class="fab fa-stack-overflow"></i>
</a>
</li>
<li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title=GitHub aria-label=GitHub>
<a class=text-white target=_blank rel="noopener noreferrer" href=https://github.com/infilos/infilos.com>
<i class="fab fa-github"></i>
</a>
</li>
</ul>
</div>
<div class="col-12 col-sm-4 text-center py-2 order-sm-2">
<small class=text-white>&copy; 2022 infilos.com All Rights Reserved</small>
</div>
</div>
</div>
</footer>
</div>
<script src=/js/popper.min.js integrity=sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49 crossorigin=anonymous></script>
<script src=/js/bootstrap.min.js integrity=sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy crossorigin=anonymous></script>
<script src=/js/main.min.5c74b870c6953931a705f390a49c7e4c0a842ec5c83b24354758dd674343ed0d.js integrity="sha256-XHS4cMaVOTGnBfOQpJx+TAqELsXIOyQ1R1jdZ0ND7Q0=" crossorigin=anonymous></script>
</body>
</html>