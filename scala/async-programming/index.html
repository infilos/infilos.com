
<!doctype html>
<html lang="zh" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Infilos's persional workspace.">
      
      
      
        <meta name="author" content="infilos">
      
      
        <link rel="canonical" href="https://www.infilos.com/scala/async-programming/">
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.1.2, mkdocs-material-7.1.3">
    
    
      
        <title>异步编程 - Infilos Workspace</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.e35208c4.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.ef6f36e2.min.css">
        
          
          
          <meta name="theme-color" content="#009485">
        
      
    
    
    
      
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Ubuntu:300,400,400i,700%7CUbuntu+Mono&display=fallback">
        <style>:root{--md-text-font-family:"Ubuntu";--md-code-font-family:"Ubuntu Mono"}</style>
      
    
    
    
    
      
        
<script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-123062585-1","auto"),ga("set","anonymizeIp",!0),ga("send","pageview"),document.addEventListener("DOMContentLoaded",function(){document.forms.search&&document.forms.search.query.addEventListener("blur",function(){var e;this.value&&(e=document.location.pathname,ga("send","pageview",e+"?q="+this.value))}),"undefined"!=typeof location$&&location$.subscribe(function(e){ga("send","pageview",e.pathname)})})</script>
<script async src="https://www.google-analytics.com/analytics.js"></script>
      
    
    
  
  
    
  
  
  <meta property="og:type" content="website">
  <meta property="og:title" content="Infilos Workspace - 异步编程">
  <meta property="og:description" content="Infilos's persional workspace.">
  <meta property="og:url" content="https://www.infilos.com/scala/async-programming/">
  <meta property="og:image" content="https://www.infilos.comassets/images/banner.png">
  <meta property="og:image:type" content="image/png">
  <meta property="og:image:width" content="1080">
  <meta property="og:image:height" content="568">
  <link rel="stylesheet" href="../../assets/stylesheets/main.4ea92eb1.min.css">

  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="teal" data-md-color-accent="deep-orange">
  
    
    <script>function __prefix(e){return new URL("../..",location).pathname+"."+e}function __get(e,t=localStorage){return JSON.parse(t.getItem(__prefix(e)))}</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#_1" class="md-skip">
          跳转至
        </a>
      
    </div>
    <div data-md-component="announce">
      
        <aside class="md-announce">
          <div class="md-announce__inner md-grid md-typeset">
            

          </div>
        </aside>
      
    </div>
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Infilos Workspace" class="md-header__button md-logo" aria-label="Infilos Workspace" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Infilos Workspace
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              异步编程
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="搜索" placeholder="搜索" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" data-md-state="active" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            正在初始化搜索引擎
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        
<a href="https://github.com/infilos/infilos.com" title="前往 GitHub 仓库" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 480 512"><path d="M186.1 328.7c0 20.9-10.9 55.1-36.7 55.1s-36.7-34.2-36.7-55.1 10.9-55.1 36.7-55.1 36.7 34.2 36.7 55.1zM480 278.2c0 31.9-3.2 65.7-17.5 95-37.9 76.6-142.1 74.8-216.7 74.8-75.8 0-186.2 2.7-225.6-74.8-14.6-29-20.2-63.1-20.2-95 0-41.9 13.9-81.5 41.5-113.6-5.2-15.8-7.7-32.4-7.7-48.8 0-21.5 4.9-32.3 14.6-51.8 45.3 0 74.3 9 108.8 36 29-6.9 58.8-10 88.7-10 27 0 54.2 2.9 80.4 9.2 34-26.7 63-35.2 107.8-35.2 9.8 19.5 14.6 30.3 14.6 51.8 0 16.4-2.6 32.7-7.7 48.2 27.5 32.4 39 72.3 39 114.2zm-64.3 50.5c0-43.9-26.7-82.6-73.5-82.6-18.9 0-37 3.4-56 6-14.9 2.3-29.8 3.2-45.1 3.2-15.2 0-30.1-.9-45.1-3.2-18.7-2.6-37-6-56-6-46.8 0-73.5 38.7-73.5 82.6 0 87.8 80.4 101.3 150.4 101.3h48.2c70.3 0 150.6-13.4 150.6-101.3zm-82.6-55.1c-25.8 0-36.7 34.2-36.7 55.1s10.9 55.1 36.7 55.1 36.7-34.2 36.7-55.1-10.9-55.1-36.7-55.1z"/></svg>
  </div>
  <div class="md-source__repository">
    infilos/infilos.com
  </div>
</a>
      </div>
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        
  
  


  <li class="md-tabs__item">
    <a href="../.." class="md-tabs__link">
      Home
    </a>
  </li>

      
        
  
  


  
  
  
    

  
  
  
    <li class="md-tabs__item">
      <a href="../../os/" class="md-tabs__link">
        Basic
      </a>
    </li>
  

  

      
        
  
  
    
  


  
  
  
    

  
  
  
    

  
  
  
    <li class="md-tabs__item">
      <a href="../../java-base/CH01-%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1/" class="md-tabs__link md-tabs__link--active">
        Language
      </a>
    </li>
  

  

  

      
        
  
  


  
  
  
    

  
  
  
    <li class="md-tabs__item">
      <a href="../../spring/CH01-IOC/" class="md-tabs__link">
        Project
      </a>
    </li>
  

  

      
        
  
  


  
  
  
    

  
  
  
    

  
  
  
    <li class="md-tabs__item">
      <a href="../../rdbms/CH01-%E5%B7%A5%E4%BD%9C%E6%96%B9%E5%BC%8F/" class="md-tabs__link">
        Architect
      </a>
    </li>
  

  

  

      
        
  
  


  
  
  
    

  
  
  
    <li class="md-tabs__item">
      <a href="../../ds/CH01-%E6%95%B0%E7%BB%84-%E9%93%BE%E8%A1%A8/" class="md-tabs__link">
        Interview
      </a>
    </li>
  

  

      
        
  
  


  <li class="md-tabs__item">
    <a href="../../open-source/" class="md-tabs__link">
      Open Source
    </a>
  </li>

      
        
  
  


  <li class="md-tabs__item">
    <a href="../../wip/" class="md-tabs__link">
      Blog
    </a>
  </li>

      
        
  
  


  <li class="md-tabs__item">
    <a href="../../wip/" class="md-tabs__link">
      About
    </a>
  </li>

      
    </ul>
  </div>
</nav>
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Infilos Workspace" class="md-nav__button md-logo" aria-label="Infilos Workspace" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    Infilos Workspace
  </label>
  
    <div class="md-nav__source">
      
<a href="https://github.com/infilos/infilos.com" title="前往 GitHub 仓库" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 480 512"><path d="M186.1 328.7c0 20.9-10.9 55.1-36.7 55.1s-36.7-34.2-36.7-55.1 10.9-55.1 36.7-55.1 36.7 34.2 36.7 55.1zM480 278.2c0 31.9-3.2 65.7-17.5 95-37.9 76.6-142.1 74.8-216.7 74.8-75.8 0-186.2 2.7-225.6-74.8-14.6-29-20.2-63.1-20.2-95 0-41.9 13.9-81.5 41.5-113.6-5.2-15.8-7.7-32.4-7.7-48.8 0-21.5 4.9-32.3 14.6-51.8 45.3 0 74.3 9 108.8 36 29-6.9 58.8-10 88.7-10 27 0 54.2 2.9 80.4 9.2 34-26.7 63-35.2 107.8-35.2 9.8 19.5 14.6 30.3 14.6 51.8 0 16.4-2.6 32.7-7.7 48.2 27.5 32.4 39 72.3 39 114.2zm-64.3 50.5c0-43.9-26.7-82.6-73.5-82.6-18.9 0-37 3.4-56 6-14.9 2.3-29.8 3.2-45.1 3.2-15.2 0-30.1-.9-45.1-3.2-18.7-2.6-37-6-56-6-46.8 0-73.5 38.7-73.5 82.6 0 87.8 80.4 101.3 150.4 101.3h48.2c70.3 0 150.6-13.4 150.6-101.3zm-82.6-55.1c-25.8 0-36.7 34.2-36.7 55.1s10.9 55.1 36.7 55.1 36.7-34.2 36.7-55.1-10.9-55.1-36.7-55.1z"/></svg>
  </div>
  <div class="md-source__repository">
    infilos/infilos.com
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2" type="checkbox" id="__nav_2" >
      
      <label class="md-nav__link" for="__nav_2">
        Basic
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Basic" data-md-level="1">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          Basic
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2_1" type="checkbox" id="__nav_2_1" >
      
      <label class="md-nav__link" for="__nav_2_1">
        操作系统
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="操作系统" data-md-level="2">
        <label class="md-nav__title" for="__nav_2_1">
          <span class="md-nav__icon md-icon"></span>
          操作系统
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../os/" class="md-nav__link">
        CH00-概览
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../os/CH02-%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E4%BB%8B%E7%BB%8D/" class="md-nav__link">
        CH02-操作系统介绍
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../os/CH04-%E6%8A%BD%E8%B1%A1-%E8%BF%9B%E7%A8%8B/" class="md-nav__link">
        CH04-抽象-进程
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../os/CH05-%E6%8F%92%E5%8F%99-%E8%BF%9B%E7%A8%8B%20API/" class="md-nav__link">
        CH05-插叙-进程 API
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../os/CH06-%E6%9C%BA%E5%88%B6-%E5%8F%97%E9%99%90%E7%9B%B4%E6%8E%A5%E6%89%A7%E8%A1%8C/" class="md-nav__link">
        CH06-机制-受限直接执行
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../os/CH07-%E8%BF%9B%E7%A8%8B%E8%B0%83%E5%BA%A6/" class="md-nav__link">
        CH07-进程调度
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../os/CH08-%E8%B0%83%E5%BA%A6-%E5%A4%9A%E7%BA%A7%E5%8F%8D%E9%A6%88%E9%98%9F%E5%88%97/" class="md-nav__link">
        CH08-调度-多级反馈队列
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../os/CH09-%E8%B0%83%E5%BA%A6-%E6%AF%94%E4%BE%8B%E4%BB%BD%E9%A2%9D/" class="md-nav__link">
        CH09-调度-比例份额
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../os/CH10-%E5%A4%9A%E5%A4%84%E7%90%86%E5%99%A8%E8%B0%83%E5%BA%A6/" class="md-nav__link">
        CH10-多处理器调度
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../os/CH13-%E6%8A%BD%E8%B1%A1-%E5%9C%B0%E5%9D%80%E7%A9%BA%E9%97%B4/" class="md-nav__link">
        CH13-抽象-地址空间
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../os/CH14-%E5%86%85%E5%AD%98%E6%8E%A5%E5%8F%A3/" class="md-nav__link">
        CH14-内存接口
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../os/CH15-%E5%9C%B0%E5%9D%80%E8%BD%AC%E6%8D%A2/" class="md-nav__link">
        CH15-地址转换
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../os/CH16-%E5%88%86%E6%AE%B5/" class="md-nav__link">
        CH16-分段
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../wip/" class="md-nav__link">
        None
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

          
            
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2_2" type="checkbox" id="__nav_2_2" >
      
      <label class="md-nav__link" for="__nav_2_2">
        操作系统-性能之殇
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="操作系统-性能之殇" data-md-level="2">
        <label class="md-nav__title" for="__nav_2_2">
          <span class="md-nav__icon md-icon"></span>
          操作系统-性能之殇
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../os-perf/" class="md-nav__link">
        CH00-概览
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../os-perf/CH01-%E5%86%AF%E8%AF%BA%E4%BE%9D%E6%9B%BC%E7%93%B6%E9%A2%88/" class="md-nav__link">
        CH01-冯诺依曼瓶颈
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../os-perf/CH02-CPU%E5%AE%9E%E7%8E%B0/" class="md-nav__link">
        CH02-CPU实现
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../os-perf/CH03-%E4%BA%8B%E4%BB%B6%E9%A9%B1%E5%8A%A8/" class="md-nav__link">
        CH03-事件驱动
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../os-perf/CH04-Unix%E8%BF%9B%E7%A8%8B%E6%A8%A1%E5%9E%8B/" class="md-nav__link">
        CH04-Unix进程模型
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../os-perf/CH05-DPDK-SDN-%E5%A4%A7%E9%A1%B5%E5%86%85%E5%AD%98/" class="md-nav__link">
        CH05-DPDK-SDN-大页内存
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../os-perf/CH06-%E5%B1%80%E9%83%A8%E6%80%A7%E4%B8%8E%E4%B9%90%E8%A7%82/" class="md-nav__link">
        CH06-局部性与乐观
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../os-perf/CH07-%E5%85%B1%E5%90%8C%E7%9A%84%E7%93%B6%E9%A2%88/" class="md-nav__link">
        CH07-共同的瓶颈
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

          
            
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2_3" type="checkbox" id="__nav_2_3" >
      
      <label class="md-nav__link" for="__nav_2_3">
        I/O 模型
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="I/O 模型" data-md-level="2">
        <label class="md-nav__title" for="__nav_2_3">
          <span class="md-nav__icon md-icon"></span>
          I/O 模型
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../io-model/CH01-IO%E6%A8%A1%E5%9E%8B/" class="md-nav__link">
        CH01-Linux IO/线程 模型
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../io-model/CH02-IO%E9%9B%B6%E6%8B%B7%E8%B4%9D/" class="md-nav__link">
        CH02-Linux IO 零拷贝
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../io-model/CH03-Netty%E6%A8%A1%E5%9E%8B/" class="md-nav__link">
        CH03-Netty IO 模型
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../io-model/CH04-Redis%E6%A8%A1%E5%9E%8B/" class="md-nav__link">
        CH04-Redis IO 模型
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../io-model/CH05-Nginx%E6%A8%A1%E5%9E%8B/" class="md-nav__link">
        CH05-Nginx IO 模型
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../io-model/CH06-MySQL%E6%A8%A1%E5%9E%8B/" class="md-nav__link">
        CH06-MySQL模型
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

          
            
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2_4" type="checkbox" id="__nav_2_4" >
      
      <label class="md-nav__link" for="__nav_2_4">
        Network
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Network" data-md-level="2">
        <label class="md-nav__title" for="__nav_2_4">
          <span class="md-nav__icon md-icon"></span>
          Network
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../network/CH01-%E7%BD%91%E7%BB%9C%E5%88%86%E5%B1%82/" class="md-nav__link">
        CH01-网络分层
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../network/CH02-IP%E5%8D%8F%E8%AE%AE/" class="md-nav__link">
        CH02-IP协议
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../network/CH03-TCP%E5%8D%8F%E8%AE%AE/" class="md-nav__link">
        CH03-TCP协议
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../network/CH04-UDP%E5%8D%8F%E8%AE%AE/" class="md-nav__link">
        CH04-UDP协议
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../network/CH05-HTTP%E5%8D%8F%E8%AE%AE/" class="md-nav__link">
        CH05-HTTP协议
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../network/CH06-WebSocket/" class="md-nav__link">
        CH06-WebSocket
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../network/CH07-DNS%E6%9C%8D%E5%8A%A1/" class="md-nav__link">
        CH07-DNS服务
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../network/CH08-%E6%B5%8F%E8%A7%88%E5%99%A8%E8%BF%87%E7%A8%8B/" class="md-nav__link">
        CH08-浏览器过程
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

          
            
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2_5" type="checkbox" id="__nav_2_5" >
      
      <label class="md-nav__link" for="__nav_2_5">
        TCP/IP
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="TCP/IP" data-md-level="2">
        <label class="md-nav__title" for="__nav_2_5">
          <span class="md-nav__icon md-icon"></span>
          TCP/IP
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../tcpip/CH01-%E6%8F%A1%E6%89%8B%E6%9C%BA%E5%88%B6/" class="md-nav__link">
        CH01-握手机制
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../tcpip/CH02-%E5%8D%8F%E8%AE%AE%E6%A0%88%E7%B2%BE%E8%A6%81/" class="md-nav__link">
        CH02-协议栈精要
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../tcpip/CH03-%E8%B0%83%E4%BC%98%E5%8F%82%E6%95%B0/" class="md-nav__link">
        CH03-调优参数
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../tcpip/CH04-%E7%90%86%E8%A7%A3%E7%BD%91%E7%BB%9C%E6%A0%88/" class="md-nav__link">
        CH04-理解网络栈
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../tcpip/CH05-RFC-1180/" class="md-nav__link">
        CH05-RFC-1180
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../tcpip/CH06-%E5%8F%AF%E9%9D%A0%E6%80%A7%E7%96%91%E9%97%AE/" class="md-nav__link">
        CH06-可靠性疑问
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

          
            
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2_6" type="checkbox" id="__nav_2_6" >
      
      <label class="md-nav__link" for="__nav_2_6">
        HTTP
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="HTTP" data-md-level="2">
        <label class="md-nav__title" for="__nav_2_6">
          <span class="md-nav__icon md-icon"></span>
          HTTP
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../http/CH01-%E6%A6%82%E8%BF%B0/" class="md-nav__link">
        CH01-HTTP 概述
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../http/CH02-URL%E4%B8%8E%E8%B5%84%E6%BA%90/" class="md-nav__link">
        CH02-URL与资源
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../http/CH03-HTTP%E6%8A%A5%E6%96%87/" class="md-nav__link">
        CH03-HTTP报文
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../http/CH04-%E8%BF%9E%E6%8E%A5%E7%AE%A1%E7%90%86/" class="md-nav__link">
        CH04-连接管理
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../http/CH99-%E6%80%A7%E8%83%BD%E6%8E%A2%E7%B4%A2/" class="md-nav__link">
        CH99-性能探索
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3" type="checkbox" id="__nav_3" checked>
      
      <label class="md-nav__link" for="__nav_3">
        Language
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Language" data-md-level="1">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          Language
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_1" type="checkbox" id="__nav_3_1" >
      
      <label class="md-nav__link" for="__nav_3_1">
        Java
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Java" data-md-level="2">
        <label class="md-nav__title" for="__nav_3_1">
          <span class="md-nav__icon md-icon"></span>
          Java
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_1_1" type="checkbox" id="__nav_3_1_1" >
      
      <label class="md-nav__link" for="__nav_3_1_1">
        Java 基础
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Java 基础" data-md-level="3">
        <label class="md-nav__title" for="__nav_3_1_1">
          <span class="md-nav__icon md-icon"></span>
          Java 基础
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../java-base/CH01-%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1/" class="md-nav__link">
        CH01-面向对象
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../java-base/CH02-%E5%9F%BA%E6%9C%AC%E7%9F%A5%E8%AF%86/" class="md-nav__link">
        CH02-基本知识
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../java-base/CH03-%E5%9F%BA%E6%9C%AC%E5%9B%BE%E8%B0%B1/" class="md-nav__link">
        CH03-基本图谱
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../java-base/CH04-%E6%B3%9B%E5%9E%8B%E6%9C%BA%E5%88%B6/" class="md-nav__link">
        CH04-泛型机制
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../java-base/CH05-%E6%B3%A8%E8%A7%A3%E6%9C%BA%E5%88%B6/" class="md-nav__link">
        CH05-注解机制
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../java-base/CH06-%E5%BC%82%E5%B8%B8%E6%9C%BA%E5%88%B6/" class="md-nav__link">
        CH06-异常机制
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../java-base/CH07-%E5%8F%8D%E5%B0%84%E6%9C%BA%E5%88%B6/" class="md-nav__link">
        CH07-反射机制
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../java-base/CH08-SPI%E6%9C%BA%E5%88%B6/" class="md-nav__link">
        CH08-SPI机制
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

          
            
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_1_2" type="checkbox" id="__nav_3_1_2" >
      
      <label class="md-nav__link" for="__nav_3_1_2">
        Java 集合
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Java 集合" data-md-level="3">
        <label class="md-nav__title" for="__nav_3_1_2">
          <span class="md-nav__icon md-icon"></span>
          Java 集合
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../java-collection/CH01-%E9%9B%86%E5%90%88%E7%BB%93%E6%9E%84/" class="md-nav__link">
        CH01-集合结构
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../java-collection/CH02-ArrayList/" class="md-nav__link">
        CH02-ArrayList
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../java-collection/CH03-LinkedList/" class="md-nav__link">
        CH03-LinkedList
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../java-collection/CH04-Stack-Queue/" class="md-nav__link">
        CH04-Stack-Queue
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../java-collection/CH05-PriorityQueue/" class="md-nav__link">
        CH05-PriorityQueue
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../java-collection/CH06-HashSet-Map/" class="md-nav__link">
        CH06-HashSet-Map
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../java-collection/CH07-LinkedHashSet-Map/" class="md-nav__link">
        CH07-LinkedHashSet-Map
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../java-collection/CH08-TreeSet-Map/" class="md-nav__link">
        CH08-TreeSet-Map
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../java-collection/CH09-WeakHashMap/" class="md-nav__link">
        CH09-WeakHashMap
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

          
            
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_1_3" type="checkbox" id="__nav_3_1_3" >
      
      <label class="md-nav__link" for="__nav_3_1_3">
        Java 并发
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Java 并发" data-md-level="3">
        <label class="md-nav__title" for="__nav_3_1_3">
          <span class="md-nav__icon md-icon"></span>
          Java 并发
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_1_3_1" type="checkbox" id="__nav_3_1_3_1" >
      
      <label class="md-nav__link" for="__nav_3_1_3_1">
        基础
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="基础" data-md-level="4">
        <label class="md-nav__title" for="__nav_3_1_3_1">
          <span class="md-nav__icon md-icon"></span>
          基础
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../java-concurrent/CH01-%E5%B9%B6%E5%8F%91%E4%BD%93%E7%B3%BB/" class="md-nav__link">
        CH01-并发体系
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../java-concurrent/CH02-%E7%90%86%E8%AE%BA%E5%9F%BA%E7%A1%80/" class="md-nav__link">
        CH02-理论基础
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../java-concurrent/CH03-%E7%BA%BF%E7%A8%8B%E5%9F%BA%E7%A1%80-1/" class="md-nav__link">
        CH03-线程基础-1
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../java-concurrent/CH04-%E7%BA%BF%E7%A8%8B%E5%9F%BA%E7%A1%80-2/" class="md-nav__link">
        CH04-线程基础-2
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

          
            
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_1_3_2" type="checkbox" id="__nav_3_1_3_2" >
      
      <label class="md-nav__link" for="__nav_3_1_3_2">
        关键字
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="关键字" data-md-level="4">
        <label class="md-nav__title" for="__nav_3_1_3_2">
          <span class="md-nav__icon md-icon"></span>
          关键字
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../java-concurrent/CH05-Synchronized/" class="md-nav__link">
        CH05-Synchronized
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../java-concurrent/CH06-Volatile/" class="md-nav__link">
        CH06-Volatile
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../java-concurrent/CH07-Final/" class="md-nav__link">
        CH07-Final
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

          
            
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_1_3_3" type="checkbox" id="__nav_3_1_3_3" >
      
      <label class="md-nav__link" for="__nav_3_1_3_3">
        锁
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="锁" data-md-level="4">
        <label class="md-nav__title" for="__nav_3_1_3_3">
          <span class="md-nav__icon md-icon"></span>
          锁
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../java-concurrent/CH08-%E5%B9%B6%E5%8F%91%E6%A6%82%E8%A7%88/" class="md-nav__link">
        CH08-并发概览
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../java-concurrent/CH09-%E5%BA%95%E5%B1%82%E6%94%AF%E6%92%91/" class="md-nav__link">
        CH09-底层支撑
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../java-concurrent/CH10-LockSupport/" class="md-nav__link">
        CH10-LockSupport
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../java-concurrent/CH11-AQS-1/" class="md-nav__link">
        CH11-AQS-1
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../java-concurrent/CH12-AQS-2/" class="md-nav__link">
        CH12-AQS-2
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../java-concurrent/CH13-AQS-3/" class="md-nav__link">
        CH13-AQS-3
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../java-concurrent/CH14-AQS-4/" class="md-nav__link">
        CH14-AQS-4
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../java-concurrent/CH15-ReentrantLock/" class="md-nav__link">
        CH15-ReentrantLock
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../java-concurrent/CH16-ReentrantReadWriteLock/" class="md-nav__link">
        CH16-ReentrantReadWriteLock
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

          
            
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_1_3_4" type="checkbox" id="__nav_3_1_3_4" >
      
      <label class="md-nav__link" for="__nav_3_1_3_4">
        集合
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="集合" data-md-level="4">
        <label class="md-nav__title" for="__nav_3_1_3_4">
          <span class="md-nav__icon md-icon"></span>
          集合
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../java-concurrent/CH17-ConcurrentHashMap/" class="md-nav__link">
        CH17-ConcurrentHashMap
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../java-concurrent/CH18-ConcurrentLinkedQueue/" class="md-nav__link">
        CH18-ConcurrentLinkedQueue
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../java-concurrent/CH19-BlockingQueue/" class="md-nav__link">
        CH19-BlockingQueue
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

          
            
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_1_3_5" type="checkbox" id="__nav_3_1_3_5" >
      
      <label class="md-nav__link" for="__nav_3_1_3_5">
        线程池
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="线程池" data-md-level="4">
        <label class="md-nav__title" for="__nav_3_1_3_5">
          <span class="md-nav__icon md-icon"></span>
          线程池
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../java-concurrent/CH20-FutureTask/" class="md-nav__link">
        CH20-FutureTask
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../java-concurrent/CH21-ThreadPoolExecutor/" class="md-nav__link">
        CH21-ThreadPoolExecutor
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../java-concurrent/CH22-ScheduledThreadPoolExecutor/" class="md-nav__link">
        CH22-ScheduledThreadPoolExecutor
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../java-concurrent/CH23-ForkJoin/" class="md-nav__link">
        CH23-ForkJoin.md
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

          
            
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_1_3_6" type="checkbox" id="__nav_3_1_3_6" >
      
      <label class="md-nav__link" for="__nav_3_1_3_6">
        工具
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="工具" data-md-level="4">
        <label class="md-nav__title" for="__nav_3_1_3_6">
          <span class="md-nav__icon md-icon"></span>
          工具
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../java-concurrent/CH24-CountDownLatch/" class="md-nav__link">
        CH24-CountDownLatch
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../java-concurrent/CH25-CyclicBarrier/" class="md-nav__link">
        CH25-CyclicBarrier
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../java-concurrent/CH26-Semaphore/" class="md-nav__link">
        CH26-Semaphore
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../java-concurrent/CH27-Phaser/" class="md-nav__link">
        CH27-Phaser
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../java-concurrent/CH28-Exchanger/" class="md-nav__link">
        CH28-Exchanger
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../java-concurrent/CH29-ThreadLocal/" class="md-nav__link">
        CH29-ThreadLocal
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

          
            
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_1_3_7" type="checkbox" id="__nav_3_1_3_7" >
      
      <label class="md-nav__link" for="__nav_3_1_3_7">
        汇总
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="汇总" data-md-level="4">
        <label class="md-nav__title" for="__nav_3_1_3_7">
          <span class="md-nav__icon md-icon"></span>
          汇总
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../java-concurrent/CH30-AllLocks/" class="md-nav__link">
        CH30-AllLocks
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../java-concurrent/CH31-AllQueues/" class="md-nav__link">
        CH31-AllQueues
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../java-concurrent/CH32-AllPools/" class="md-nav__link">
        CH32-AllPools
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

          
            
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_1_4" type="checkbox" id="__nav_3_1_4" >
      
      <label class="md-nav__link" for="__nav_3_1_4">
        Java I/O
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Java I/O" data-md-level="3">
        <label class="md-nav__title" for="__nav_3_1_4">
          <span class="md-nav__icon md-icon"></span>
          Java I/O
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../java-io/CH01-IO%E5%88%86%E7%B1%BB/" class="md-nav__link">
        CH01-IO分类
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../java-io/CH02-%E8%A3%85%E9%A5%B0%E6%A8%A1%E5%BC%8F/" class="md-nav__link">
        CH02-装饰模式
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../java-io/CH03-InputStream/" class="md-nav__link">
        CH03-InputStream
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../java-io/CH04-OutputStream/" class="md-nav__link">
        CH04-OutputStream
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../java-io/CH05-%E5%B8%B8%E7%94%A8%E6%93%8D%E4%BD%9C/" class="md-nav__link">
        CH05-常用操作.md
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../java-io/CH06-IO%E5%AE%9E%E7%8E%B0/" class="md-nav__link">
        CH06-IO实现
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../java-io/CH07-IO%E6%A8%A1%E5%9E%8B/" class="md-nav__link">
        CH07-IO模型
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../java-io/CH08-BIO%E5%8E%9F%E7%90%86/" class="md-nav__link">
        CH08-BIO原理
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../java-io/CH09-NIO%E5%9F%BA%E7%A1%80/" class="md-nav__link">
        CH09-NIO基础
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../java-io/CH10-NIO%E5%8E%9F%E7%90%86/" class="md-nav__link">
        CH10-NIO原理
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../java-io/CH11-AIO%E5%8E%9F%E7%90%86/" class="md-nav__link">
        CH11-AIO原理
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../java-io/CH12-%E9%9B%B6%E6%8B%B7%E8%B4%9D/" class="md-nav__link">
        CH12-零拷贝
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../java-io/CH13-%E5%86%85%E5%AD%98%E6%98%A0%E5%B0%84/" class="md-nav__link">
        CH13-内存映射
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

          
            
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_1_5" type="checkbox" id="__nav_3_1_5" >
      
      <label class="md-nav__link" for="__nav_3_1_5">
        Java JVM
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Java JVM" data-md-level="3">
        <label class="md-nav__title" for="__nav_3_1_5">
          <span class="md-nav__icon md-icon"></span>
          Java JVM
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../java-jvm/CH01-JVM%E6%A6%82%E8%A7%88/" class="md-nav__link">
        CH01-JVM概览
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../java-jvm/CH02-JVM%E5%AD%97%E8%8A%82%E7%A0%81/" class="md-nav__link">
        CH02-JVM字节码
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../java-jvm/CH03-JVM%E7%B1%BB%E5%8A%A0%E8%BD%BD/" class="md-nav__link">
        CH03-JVM类加载
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../java-jvm/CH04-JVM%E5%86%85%E5%AD%98%E7%BB%93%E6%9E%84/" class="md-nav__link">
        CH04-JVM内存结构
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../java-jvm/CH05-JVM%E5%86%85%E5%AD%98%E6%A8%A1%E5%9E%8B-1/" class="md-nav__link">
        CH05-JVM内存模型-1
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../java-jvm/CH06-JVM%E5%86%85%E5%AD%98%E6%A8%A1%E5%9E%8B-2/" class="md-nav__link">
        CH06-JVM内存模型-2
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../java-jvm/CH07-JVM%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6/" class="md-nav__link">
        CH07-JVM垃圾回收
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../java-jvm/CH08-JVM-G1/" class="md-nav__link">
        CH08-JVM-G1.md
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../java-jvm/CH09-JVM-ZGC/" class="md-nav__link">
        CH09-JVM-ZGC
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../java-jvm/CH10-JVM%E8%B0%83%E4%BC%98%E5%8F%82%E6%95%B0/" class="md-nav__link">
        CH10-JVM调优参数
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../java-jvm/CH11-JVM-OOM/" class="md-nav__link">
        CH11-JVM-OOM
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../java-jvm/CH12-JVM%E7%BA%BF%E7%A8%8BDump/" class="md-nav__link">
        CH12-JVM线程Dump
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../java-jvm/CH13-JVM%E8%B0%83%E8%AF%95%E5%91%BD%E4%BB%A4/" class="md-nav__link">
        CH13-JVM调试命令
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../java-jvm/CH14-JVM%E8%B0%83%E8%AF%95%E5%B7%A5%E5%85%B7/" class="md-nav__link">
        CH14-JVM调试工具
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../java-jvm/CH15-JVM%E5%8A%A8%E6%80%81%E8%B0%83%E8%AF%95/" class="md-nav__link">
        CH15-JVM动态调试
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

          
            
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_2" type="checkbox" id="__nav_3_2" >
      
      <label class="md-nav__link" for="__nav_3_2">
        JVM
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="JVM" data-md-level="2">
        <label class="md-nav__title" for="__nav_3_2">
          <span class="md-nav__icon md-icon"></span>
          JVM
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_2_1" type="checkbox" id="__nav_3_2_1" >
      
      <label class="md-nav__link" for="__nav_3_2_1">
        Java JSR-133
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Java JSR-133" data-md-level="3">
        <label class="md-nav__title" for="__nav_3_2_1">
          <span class="md-nav__icon md-icon"></span>
          Java JSR-133
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../jmm-133/CH01-%E6%8C%87%E4%BB%A4%E9%87%8D%E6%8E%92/" class="md-nav__link">
        CH01-指令重排
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../jmm-133/CH02-%E5%86%85%E5%AD%98%E5%B1%8F%E9%9A%9C/" class="md-nav__link">
        CH02-内存屏障
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../jmm-133/CH03-%E5%A4%9A%E5%A4%84%E7%90%86%E5%99%A8/" class="md-nav__link">
        CH03-多处理器
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../jmm-133/CH04-%E5%BC%80%E5%8F%91%E6%8C%87%E5%8D%97/" class="md-nav__link">
        CH04-开发指南
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

          
            
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_2_2" type="checkbox" id="__nav_3_2_2" >
      
      <label class="md-nav__link" for="__nav_3_2_2">
        Java JMM 规范
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Java JMM 规范" data-md-level="3">
        <label class="md-nav__title" for="__nav_3_2_2">
          <span class="md-nav__icon md-icon"></span>
          Java JMM 规范
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../jmm-spec/CH01-JMM%E8%A7%84%E8%8C%83/" class="md-nav__link">
        CH01-JMM规范
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../jmm-spec/CH02-JMM%E8%A7%A3%E9%87%8A/" class="md-nav__link">
        CH02-JMM Explain
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../jmm-spec/CH03-JMM%E5%8E%9F%E5%88%99/" class="md-nav__link">
        CH03-JMM原则
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../jmm-spec/CH04-JSR133-FAQ/" class="md-nav__link">
        CH04-JSR133-FAQ
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../jmm-spec/CH05-JSR133-Cook/" class="md-nav__link">
        CH05-JSR133-Cook
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

          
            
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_2_3" type="checkbox" id="__nav_3_2_3" >
      
      <label class="md-nav__link" for="__nav_3_2_3">
        Java JVM 深入理解 V2
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Java JVM 深入理解 V2" data-md-level="3">
        <label class="md-nav__title" for="__nav_3_2_3">
          <span class="md-nav__icon md-icon"></span>
          Java JVM 深入理解 V2
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_2_3_1" type="checkbox" id="__nav_3_2_3_1" >
      
      <label class="md-nav__link" for="__nav_3_2_3_1">
        开始
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="开始" data-md-level="4">
        <label class="md-nav__title" for="__nav_3_2_3_1">
          <span class="md-nav__icon md-icon"></span>
          开始
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../java-jvm-dive-v2/CH01-%E8%B5%B0%E8%BF%9BJava/" class="md-nav__link">
        CH01-走近 Java
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

          
            
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_2_3_2" type="checkbox" id="__nav_3_2_3_2" >
      
      <label class="md-nav__link" for="__nav_3_2_3_2">
        内存管理
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="内存管理" data-md-level="4">
        <label class="md-nav__title" for="__nav_3_2_3_2">
          <span class="md-nav__icon md-icon"></span>
          内存管理
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../java-jvm-dive-v2/CH02-%E5%86%85%E5%AD%98%E5%8C%BA%E5%9F%9F%E4%B8%8E%E6%BA%A2%E5%87%BA%E5%BC%82%E5%B8%B8/" class="md-nav__link">
        CH02-内存区域与溢出
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../java-jvm-dive-v2/CH03-%E5%9E%83%E5%9C%BE%E6%94%B6%E9%9B%86%E4%B8%8E%E5%88%86%E9%85%8D%E7%AD%96%E7%95%A5/" class="md-nav__link">
        CH03-垃圾收集与分配策略
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../java-jvm-dive-v2/CH04-%E6%80%A7%E8%83%BD%E7%9B%91%E6%8E%A7%E4%B8%8E%E6%95%85%E9%9A%9C%E5%A4%84%E7%90%86/" class="md-nav__link">
        CH04-性能监控与故障处理
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../java-jvm-dive-v2/CH05-%E8%B0%83%E4%BC%98%E6%A1%88%E4%BE%8B/" class="md-nav__link">
        CH05-调优案例
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

          
            
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_2_3_3" type="checkbox" id="__nav_3_2_3_3" >
      
      <label class="md-nav__link" for="__nav_3_2_3_3">
        执行子系统
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="执行子系统" data-md-level="4">
        <label class="md-nav__title" for="__nav_3_2_3_3">
          <span class="md-nav__icon md-icon"></span>
          执行子系统
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../java-jvm-dive-v2/CH06-%E7%B1%BB%E6%96%87%E4%BB%B6%E7%BB%93%E6%9E%84/" class="md-nav__link">
        CH06-类文件结构
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../java-jvm-dive-v2/CH07-%E7%B1%BB%E5%8A%A0%E8%BD%BD%E6%9C%BA%E5%88%B6/" class="md-nav__link">
        CH07-类加载
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../java-jvm-dive-v2/CH08-%E5%AD%97%E8%8A%82%E7%A0%81%E6%89%A7%E8%A1%8C%E5%BC%95%E6%93%8E/" class="md-nav__link">
        CH08-字节码执行引擎
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../java-jvm-dive-v2/CH09-%E6%A1%88%E4%BE%8B%E4%B8%8E%E5%AE%9E%E6%88%98/" class="md-nav__link">
        CH09-案例与实战
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

          
            
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_2_3_4" type="checkbox" id="__nav_3_2_3_4" >
      
      <label class="md-nav__link" for="__nav_3_2_3_4">
        编译与优化
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="编译与优化" data-md-level="4">
        <label class="md-nav__title" for="__nav_3_2_3_4">
          <span class="md-nav__icon md-icon"></span>
          编译与优化
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../java-jvm-dive-v2/CH10-%E7%BC%96%E8%AF%91%E6%9C%9F%E4%BC%98%E5%8C%96/" class="md-nav__link">
        CH10-编译期优化
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../java-jvm-dive-v2/CH11-%E8%BF%90%E8%A1%8C%E6%97%B6%E4%BC%98%E5%8C%96/" class="md-nav__link">
        CH11-运行时优化
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

          
            
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_2_3_5" type="checkbox" id="__nav_3_2_3_5" >
      
      <label class="md-nav__link" for="__nav_3_2_3_5">
        高效并发
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="高效并发" data-md-level="4">
        <label class="md-nav__title" for="__nav_3_2_3_5">
          <span class="md-nav__icon md-icon"></span>
          高效并发
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../java-jvm-dive-v2/CH12-%E5%86%85%E5%AD%98%E6%A8%A1%E5%9E%8B%E4%B8%8E%E7%BA%BF%E7%A8%8B/" class="md-nav__link">
        CH12-内存模型与线程
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../java-jvm-dive-v2/CH13-%E7%BA%BF%E7%A8%8B%E5%AE%89%E5%85%A8%E4%B8%8E%E9%94%81%E4%BC%98%E5%8C%96/" class="md-nav__link">
        CH13-线程安全与锁优化
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

          
            
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_2_3_6" type="checkbox" id="__nav_3_2_3_6" >
      
      <label class="md-nav__link" for="__nav_3_2_3_6">
        附录
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="附录" data-md-level="4">
        <label class="md-nav__title" for="__nav_3_2_3_6">
          <span class="md-nav__icon md-icon"></span>
          附录
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../java-jvm-dive-v2/Endix-B-%E6%8C%87%E4%BB%A4%E8%A1%A8/" class="md-nav__link">
        Endix-B-字节码指令
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../java-jvm-dive-v2/Endix-C-%E5%8F%82%E6%95%B0%E8%A1%A8/" class="md-nav__link">
        Endix-C-虚拟机参数
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../wip/" class="md-nav__link">
        Java JVM 深入理解 V3
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

          
            
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_3" type="checkbox" id="__nav_3_3" >
      
      <label class="md-nav__link" for="__nav_3_3">
        并发
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="并发" data-md-level="2">
        <label class="md-nav__title" for="__nav_3_3">
          <span class="md-nav__icon md-icon"></span>
          并发
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_3_1" type="checkbox" id="__nav_3_3_1" >
      
      <label class="md-nav__link" for="__nav_3_3_1">
        Java 并发实战
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Java 并发实战" data-md-level="3">
        <label class="md-nav__title" for="__nav_3_3_1">
          <span class="md-nav__icon md-icon"></span>
          Java 并发实战
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../java-con-practice/CH01-%E7%AE%80%E4%BB%8B/" class="md-nav__link">
        CH01-简介
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../java-con-practice/CH02-%E7%BA%BF%E7%A8%8B%E5%AE%89%E5%85%A8%E6%80%A7/" class="md-nav__link">
        CH02-线程安全性
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../java-con-practice/CH03-%E5%AF%B9%E8%B1%A1%E5%85%B1%E4%BA%AB/" class="md-nav__link">
        CH03-对象共享
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../java-con-practice/CH04-%E5%AF%B9%E8%B1%A1%E7%BB%84%E5%90%88/" class="md-nav__link">
        CH04-对象组合
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../java-con-practice/CH05-%E5%9F%BA%E7%A1%80%E6%9E%84%E5%BB%BA%E5%9D%97/" class="md-nav__link">
        CH05-基础构建块
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../java-con-practice/CH06-%E4%BB%BB%E5%8A%A1%E6%89%A7%E8%A1%8C/" class="md-nav__link">
        CH06-任务执行
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../java-con-practice/CH07-%E5%8F%96%E6%B6%88%E5%85%B3%E9%97%AD/" class="md-nav__link">
        CH07-取消关闭
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../java-con-practice/CH08-%E7%BA%BF%E7%A8%8B%E6%B1%A0/" class="md-nav__link">
        CH08-线程池
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../java-con-practice/CH09-GUI%E5%BA%94%E7%94%A8/" class="md-nav__link">
        CH09-GUI应用
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../java-con-practice/CH10-%E6%B4%BB%E8%B7%83%E6%80%A7%E5%8D%B1%E9%99%A9/" class="md-nav__link">
        CH10-活跃性危险
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../java-con-practice/CH11-%E6%80%A7%E8%83%BD%E4%B8%8E%E4%BC%B8%E7%BC%A9/" class="md-nav__link">
        CH11-性能与伸缩
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../java-con-practice/CH12-%E6%B5%8B%E8%AF%95/" class="md-nav__link">
        CH12-测试
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../java-con-practice/CH13-%E6%98%BE%E5%BC%8F%E9%94%81/" class="md-nav__link">
        CH13-显式锁
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../java-con-practice/CH14-%E8%87%AA%E5%AE%9A%E4%B9%89%E6%89%A9%E5%B1%95/" class="md-nav__link">
        CH14-自定义扩展
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../java-con-practice/CH15-%E5%8E%9F%E5%AD%90%E4%B8%8E%E9%9D%9E%E9%98%BB%E5%A1%9E%E5%90%8C%E6%AD%A5/" class="md-nav__link">
        CH15-原子与非阻塞同步
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../java-con-practice/CH16-%E5%86%85%E5%AD%98%E6%A8%A1%E5%9E%8B/" class="md-nav__link">
        CH16-内存模型
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../wip/" class="md-nav__link">
        Java 并发模式
      </a>
    </li>
  

          
            
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_3_3" type="checkbox" id="__nav_3_3_3" >
      
      <label class="md-nav__link" for="__nav_3_3_3">
        深入理解并行
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="深入理解并行" data-md-level="3">
        <label class="md-nav__title" for="__nav_3_3_3">
          <span class="md-nav__icon md-icon"></span>
          深入理解并行
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../dive-parallel/CH01/" class="md-nav__link">
        CH01-关于本书
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../dive-parallel/CH02/" class="md-nav__link">
        CH02-简介
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../dive-parallel/CH03/" class="md-nav__link">
        CH03-硬件特性
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../dive-parallel/CH04/" class="md-nav__link">
        CH04-并行工具
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../dive-parallel/CH05/" class="md-nav__link">
        CH05-计数
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../dive-parallel/CH06/" class="md-nav__link">
        CH06-分割同步设计
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../dive-parallel/CH07/" class="md-nav__link">
        CH07-锁
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../dive-parallel/CH08/" class="md-nav__link">
        CH08-数据所有权
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../dive-parallel/CH09/" class="md-nav__link">
        CH09-延后处理
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../dive-parallel/CH10/" class="md-nav__link">
        CH10-数据结构
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../dive-parallel/CH11/" class="md-nav__link">
        CH11-验证
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../dive-parallel/CH12/" class="md-nav__link">
        CH12-形式验证
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../dive-parallel/CH13/" class="md-nav__link">
        CH13-综合应用
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../dive-parallel/CH14/" class="md-nav__link">
        CH14-高级同步
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../dive-parallel/CH15/" class="md-nav__link">
        CH15-高级同步-内存序
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../dive-parallel/Endix/" class="md-nav__link">
        ENDIX-C-内存屏障
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

          
            
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_3_4" type="checkbox" id="__nav_3_3_4" >
      
      <label class="md-nav__link" for="__nav_3_3_4">
        七周七并发模型
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="七周七并发模型" data-md-level="3">
        <label class="md-nav__title" for="__nav_3_3_4">
          <span class="md-nav__icon md-icon"></span>
          七周七并发模型
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../seven-con-model/CH01/" class="md-nav__link">
        CH01-概述
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../seven-con-model/CH02/" class="md-nav__link">
        CH02-线程与锁
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../seven-con-model/CH03/" class="md-nav__link">
        CH03-函数式编程
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../seven-con-model/CH04/" class="md-nav__link">
        CH04-分离标识与状态
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../seven-con-model/CH05/" class="md-nav__link">
        CH05-Actor
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../seven-con-model/CH06/" class="md-nav__link">
        CH06-CSP
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../seven-con-model/CH07/" class="md-nav__link">
        CH07-数据并行
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../seven-con-model/CH08/" class="md-nav__link">
        CH08-Lambda 架构
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../seven-con-model/CH09/" class="md-nav__link">
        CH09-未来方向
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

          
            
  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_4" type="checkbox" id="__nav_3_4" checked>
      
      <label class="md-nav__link" for="__nav_3_4">
        Scala
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Scala" data-md-level="2">
        <label class="md-nav__title" for="__nav_3_4">
          <span class="md-nav__icon md-icon"></span>
          Scala
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_4_1" type="checkbox" id="__nav_3_4_1" checked>
      
      <label class="md-nav__link" for="__nav_3_4_1">
        Scala 精要
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Scala 精要" data-md-level="3">
        <label class="md-nav__title" for="__nav_3_4_1">
          <span class="md-nav__icon md-icon"></span>
          Scala 精要
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../case-class/" class="md-nav__link">
        Case Class
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../functional-1/" class="md-nav__link">
        函数式-基础
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../functional-2/" class="md-nav__link">
        函数式-用例
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../future-1/" class="md-nav__link">
        Future-基础
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../future-2/" class="md-nav__link">
        Future-用例
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../future-3/" class="md-nav__link">
        Future-集合
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../future-4/" class="md-nav__link">
        Future-Promise
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../implicits-1/" class="md-nav__link">
        Implicits-基础
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../implicits-2/" class="md-nav__link">
        Implicits-进阶
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../trait-1/" class="md-nav__link">
        Trait-基础
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../trait-2/" class="md-nav__link">
        Trait-用例
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../try/" class="md-nav__link">
        Try
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../type-1/" class="md-nav__link">
        Type-用例
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../type-2/" class="md-nav__link">
        None
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../type-2/" class="md-nav__link">
        Type-进阶
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../primitive/" class="md-nav__link">
        Primitive
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../numbers/" class="md-nav__link">
        Numbers
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../strings/" class="md-nav__link">
        String
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../control/" class="md-nav__link">
        Control
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../pattern-match/" class="md-nav__link">
        Pattern Match
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../class-object-1/" class="md-nav__link">
        Class Object: 基础
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../class-object-2/" class="md-nav__link">
        Class Object: 类
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../class-object-3/" class="md-nav__link">
        Class Object: 方法
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../class-object-4/" class="md-nav__link">
        Class Object: 对象
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../class-object-5/" class="md-nav__link">
        函数式对象
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../class-object-6/" class="md-nav__link">
        整体类层级
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../class-object-7/" class="md-nav__link">
        组合继承
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../package/" class="md-nav__link">
        Package
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../sbt/" class="md-nav__link">
        SBT
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../predef/" class="md-nav__link">
        Predef
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../io/" class="md-nav__link">
        I/O
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../reserved/" class="md-nav__link">
        保留字
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../exception/" class="md-nav__link">
        Exception
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../annotation/" class="md-nav__link">
        Inject Type
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../type-class/" class="md-nav__link">
        Type Class
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../map/" class="md-nav__link">
        Map Flatmap
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../generic/" class="md-nav__link">
        泛型型变
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../common/" class="md-nav__link">
        常见问题
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../placeholder/" class="md-nav__link">
        占位符
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../multi-vars/" class="md-nav__link">
        多变量赋值
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../constructor/" class="md-nav__link">
        构造器
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../type-system/" class="md-nav__link">
        类型系统
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../functional/" class="md-nav__link">
        函数式入门
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../monoid/" class="md-nav__link">
        Monoid
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../func-type-class/" class="md-nav__link">
        函数式与类型类
      </a>
    </li>
  

          
            
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          异步编程
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        异步编程
      </a>
      
        
<nav class="md-nav md-nav--secondary" aria-label="目录">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      目录
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#1" class="md-nav__link">
    1. 介绍
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2" class="md-nav__link">
    2. 巨大的错觉
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3" class="md-nav__link">
    3. 回调地狱
  </a>
  
    <nav class="md-nav" aria-label="3. 回调地狱">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#31" class="md-nav__link">
    3.1. 顺序化(副作用炼狱)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#32" class="md-nav__link">
    3.2. 并行化(梦境中的不确定性)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#33" class="md-nav__link">
    3.3. 递归(爆栈的愤怒)
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#4-future-promise" class="md-nav__link">
    4. Future &amp; Promise
  </a>
  
    <nav class="md-nav" aria-label="4. Future &amp; Promise">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#41" class="md-nav__link">
    4.1. 顺序化
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#42" class="md-nav__link">
    4.2. 并行化
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#43" class="md-nav__link">
    4.3. 递归
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#44" class="md-nav__link">
    4.4. 性能代价
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#5-taskscala-io-monad" class="md-nav__link">
    5. Task，Scala 的 IO Monad
  </a>
  
    <nav class="md-nav" aria-label="5. Task，Scala 的 IO Monad">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#51" class="md-nav__link">
    5.1. 顺序化
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#52" class="md-nav__link">
    5.2. 并行化
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#53" class="md-nav__link">
    5.3. 递归
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#6-type-class" class="md-nav__link">
    6. 函数式编程和 Type-class
  </a>
  
    <nav class="md-nav" aria-label="6. 函数式编程和 Type-class">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#61-monad" class="md-nav__link">
    6.1.  Monad(顺序化和递归)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#62-applicative" class="md-nav__link">
    6.2. Applicative(并行化)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#63" class="md-nav__link">
    6.3. 为异步求值定义类型类？
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#7" class="md-nav__link">
    7. 选择正确的工具
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../scala-style/" class="md-nav__link">
        战略Scala风格：最小功率的原理
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

          
            
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_4_2" type="checkbox" id="__nav_3_4_2" >
      
      <label class="md-nav__link" for="__nav_3_4_2">
        Scala 函数式
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Scala 函数式" data-md-level="3">
        <label class="md-nav__title" for="__nav_3_4_2">
          <span class="md-nav__icon md-icon"></span>
          Scala 函数式
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../scala-func/CH00-%E7%B2%BE%E8%A6%81/" class="md-nav__link">
        CH00-精要
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../scala-func/CH01-%E5%AE%9A%E4%B9%89/" class="md-nav__link">
        CH01-定义
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../scala-func/CH02-%E5%87%BD%E6%95%B0/" class="md-nav__link">
        CH02-函数
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../scala-func/CH03-%E6%95%B0%E6%8D%AE/" class="md-nav__link">
        CH03-数据
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../scala-func/CH04-%E5%BC%82%E5%B8%B8/" class="md-nav__link">
        CH04-异常
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

          
            
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_5" type="checkbox" id="__nav_3_5" >
      
      <label class="md-nav__link" for="__nav_3_5">
        设计模式
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="设计模式" data-md-level="2">
        <label class="md-nav__title" for="__nav_3_5">
          <span class="md-nav__icon md-icon"></span>
          设计模式
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_5_1" type="checkbox" id="__nav_3_5_1" >
      
      <label class="md-nav__link" for="__nav_3_5_1">
        Java 模式
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Java 模式" data-md-level="3">
        <label class="md-nav__title" for="__nav_3_5_1">
          <span class="md-nav__icon md-icon"></span>
          Java 模式
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../java-pattern/CH01/" class="md-nav__link">
        CH01-创建型-简单工厂
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../java-pattern/CH02/" class="md-nav__link">
        CH02-创建型-工厂方法
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../java-pattern/CH03/" class="md-nav__link">
        CH03-创建型-抽象工厂
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../java-pattern/CH04/" class="md-nav__link">
        CH04-创建型-建造者
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../java-pattern/CH05/" class="md-nav__link">
        CH05-创建型-单例
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../java-pattern/CH06/" class="md-nav__link">
        CH06-结构型-适配器
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../java-pattern/CH07/" class="md-nav__link">
        CH07-结构型-桥接
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../java-pattern/CH08/" class="md-nav__link">
        CH08-结构型-装饰器
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../java-pattern/CH09/" class="md-nav__link">
        CH09-结构型-外观
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../java-pattern/CH10/" class="md-nav__link">
        CH10-结构型-享元
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../java-pattern/CH11/" class="md-nav__link">
        CH11-结构型-代理
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../java-pattern/CH12/" class="md-nav__link">
        CH12-行为型-命令
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../java-pattern/CH13/" class="md-nav__link">
        CH13-行为型-中介者
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../java-pattern/CH14/" class="md-nav__link">
        CH14-行为型-观察者
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../java-pattern/CH15/" class="md-nav__link">
        CH15-行为型-状态
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../java-pattern/CH16/" class="md-nav__link">
        CH16-行为型-策略
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

          
            
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_5_2" type="checkbox" id="__nav_3_5_2" >
      
      <label class="md-nav__link" for="__nav_3_5_2">
        Scala 模式
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Scala 模式" data-md-level="3">
        <label class="md-nav__title" for="__nav_3_5_2">
          <span class="md-nav__icon md-icon"></span>
          Scala 模式
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../scala-pattern/CH01-%E6%A8%A1%E5%BC%8F%E5%88%86%E7%B1%BB/" class="md-nav__link">
        CH01-模式分类
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../scala-pattern/CH02-%E7%89%B9%E8%B4%A8%E4%B8%8E%E6%B7%B7%E5%85%A5%E7%BB%84%E5%90%88/" class="md-nav__link">
        CH02-特质与混入组合
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../scala-pattern/CH03-%E7%BB%9F%E4%B8%80%E5%8C%96/" class="md-nav__link">
        CH03-统一化
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../scala-pattern/CH04-%E6%8A%BD%E8%B1%A1%E4%B8%8E%E8%87%AA%E7%B1%BB%E5%9E%8B/" class="md-nav__link">
        CH04-抽象与自类型
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../scala-pattern/CH05-AOP%20%E4%B8%8E%E7%BB%84%E4%BB%B6/" class="md-nav__link">
        CH05-AOP 与组件
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../scala-pattern/CH06-%E5%88%9B%E5%BB%BA%E5%9E%8B%E6%A8%A1%E5%BC%8F/" class="md-nav__link">
        CH06-创建型模式
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../scala-pattern/CH06-1-%E5%B7%A5%E5%8E%82%E6%96%B9%E6%B3%95/" class="md-nav__link">
        CH06-1-工厂方法
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../scala-pattern/CH06-2-%E6%8A%BD%E8%B1%A1%E5%B7%A5%E5%8E%82/" class="md-nav__link">
        CH06-2-抽象工厂
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../scala-pattern/CH06-3-%E5%85%B6%E4%BB%96%E5%B7%A5%E5%8E%82%E6%A8%A1%E5%BC%8F/" class="md-nav__link">
        CH06-3-其他工厂模式
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../scala-pattern/CH06-4-%E6%87%92%E5%88%9D%E5%A7%8B%E5%8C%96/" class="md-nav__link">
        CH06-4-懒初始化
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../scala-pattern/CH06-5-%E5%8D%95%E4%BE%8B%E6%A8%A1%E5%BC%8F/" class="md-nav__link">
        CH06-5-单例模式
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../scala-pattern/CH06-6-%E6%9E%84%E5%BB%BA%E5%99%A8%E6%A8%A1%E5%BC%8F/" class="md-nav__link">
        CH06-6-构建器模式
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../scala-pattern/CH06-7-%E5%8E%9F%E5%9E%8B%E6%A8%A1%E5%BC%8F/" class="md-nav__link">
        CH06-7-原型模式
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../scala-pattern/CH07-%E7%BB%93%E6%9E%84%E5%9E%8B%E6%A8%A1%E5%BC%8F/" class="md-nav__link">
        CH07-结构型模式
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../scala-pattern/CH07-1-%E9%80%82%E9%85%8D%E5%99%A8%E6%A8%A1%E5%BC%8F/" class="md-nav__link">
        CH07-1-适配器模式
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../scala-pattern/CH07-2-%E8%A3%85%E9%A5%B0%E5%99%A8%E6%A8%A1%E5%BC%8F/" class="md-nav__link">
        CH07-2-装饰器模式
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../scala-pattern/CH07-3-%E6%A1%A5%E6%8E%A5%E6%A8%A1%E5%BC%8F/" class="md-nav__link">
        CH07-3-桥接模式
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../scala-pattern/CH07-4-%E7%BB%84%E5%90%88%E6%A8%A1%E5%BC%8F/" class="md-nav__link">
        CH07-4-组合模式
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../scala-pattern/CH07-5-%E5%A4%96%E8%A7%82%E6%A8%A1%E5%BC%8F/" class="md-nav__link">
        CH07-5-外观模式
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../scala-pattern/CH07-6-%E4%BA%AB%E5%85%83%E6%A8%A1%E5%BC%8F/" class="md-nav__link">
        CH07-6-享元模式
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../scala-pattern/CH07-7-%E4%BB%A3%E7%90%86%E6%A8%A1%E5%BC%8F/" class="md-nav__link">
        CH07-7-代理模式
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../scala-pattern/CH08-%E8%A1%8C%E4%B8%BA%E5%9E%8B%E6%A8%A1%E5%BC%8F-1/" class="md-nav__link">
        CH08-行为型模式-1
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../scala-pattern/CH09-%E8%A1%8C%E4%B8%BA%E5%9E%8B%E6%A8%A1%E5%BC%8F-2/" class="md-nav__link">
        CH09-行为型模式-2
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../scala-pattern/CH10-%E5%87%BD%E6%95%B0%E5%BC%8F%E6%A8%A1%E5%BC%8F%E7%90%86%E8%AE%BA/" class="md-nav__link">
        CH10-函数式模式理论
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../scala-pattern/CH11-%E5%87%BD%E6%95%B0%E5%BC%8F%E6%A8%A1%E5%BC%8F%E5%BA%94%E7%94%A8/" class="md-nav__link">
        CH11-函数式模式应用
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../scala-pattern/CH12-%E5%AE%9E%E9%99%85%E5%BA%94%E7%94%A8/" class="md-nav__link">
        CH12-实际应用
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4" type="checkbox" id="__nav_4" >
      
      <label class="md-nav__link" for="__nav_4">
        Project
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Project" data-md-level="1">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          Project
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4_1" type="checkbox" id="__nav_4_1" >
      
      <label class="md-nav__link" for="__nav_4_1">
        Spring
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Spring" data-md-level="2">
        <label class="md-nav__title" for="__nav_4_1">
          <span class="md-nav__icon md-icon"></span>
          Spring
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../spring/CH01-IOC/" class="md-nav__link">
        CH01-IOC
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../spring/CH02-SpringIOC/" class="md-nav__link">
        CH02-SpringIOC
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../spring/CH03-Bean%E5%8A%A0%E8%BD%BD/" class="md-nav__link">
        CH03-Bean加载
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../spring/CH04-IOC%E6%BA%90%E7%A0%81/" class="md-nav__link">
        CH04-IOC源码
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../spring/CH05-%E5%BE%AA%E7%8E%AF%E4%BE%9D%E8%B5%96/" class="md-nav__link">
        CH05-循环依赖
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../spring/CH06-AOP/" class="md-nav__link">
        CH06-AOP
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5" type="checkbox" id="__nav_5" >
      
      <label class="md-nav__link" for="__nav_5">
        Architect
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Architect" data-md-level="1">
        <label class="md-nav__title" for="__nav_5">
          <span class="md-nav__icon md-icon"></span>
          Architect
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5_1" type="checkbox" id="__nav_5_1" >
      
      <label class="md-nav__link" for="__nav_5_1">
        存储系统
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="存储系统" data-md-level="2">
        <label class="md-nav__title" for="__nav_5_1">
          <span class="md-nav__icon md-icon"></span>
          存储系统
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5_1_1" type="checkbox" id="__nav_5_1_1" >
      
      <label class="md-nav__link" for="__nav_5_1_1">
        RDBMS
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="RDBMS" data-md-level="3">
        <label class="md-nav__title" for="__nav_5_1_1">
          <span class="md-nav__icon md-icon"></span>
          RDBMS
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../rdbms/CH01-%E5%B7%A5%E4%BD%9C%E6%96%B9%E5%BC%8F/" class="md-nav__link">
        CH01-工作方式
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../rdbms/CH02-%E8%AE%BE%E8%AE%A1%E7%90%86%E8%AE%BA/" class="md-nav__link">
        CH02-设计理论
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../rdbms/CH03-%E8%AE%BE%E8%AE%A1%E6%B5%81%E7%A8%8B/" class="md-nav__link">
        CH03-设计流程
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../rdbms/CH04-%E6%A0%B8%E5%BF%83%E7%9F%A5%E8%AF%86/" class="md-nav__link">
        CH04-核心知识
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

          
            
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5_1_2" type="checkbox" id="__nav_5_1_2" >
      
      <label class="md-nav__link" for="__nav_5_1_2">
        SQL
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="SQL" data-md-level="3">
        <label class="md-nav__title" for="__nav_5_1_2">
          <span class="md-nav__icon md-icon"></span>
          SQL
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../sql/CH01-%E8%AF%AD%E6%B3%95%E5%9F%BA%E7%A1%80/" class="md-nav__link">
        CH01-语法基础
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../sql/CH02-%E6%9F%A5%E8%AF%A2%E7%BB%83%E4%B9%A0/" class="md-nav__link">
        CH02-语句联系
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../sql/CH03-%E6%9F%A5%E8%AF%A2%E8%BF%9B%E9%98%B6/" class="md-nav__link">
        CH03-查询进阶
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../sql/CH04-%E6%9F%A5%E8%AF%A2%E4%BC%98%E5%8C%96/" class="md-nav__link">
        CH04-查询优化
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

          
            
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5_1_3" type="checkbox" id="__nav_5_1_3" >
      
      <label class="md-nav__link" for="__nav_5_1_3">
        MySQL
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="MySQL" data-md-level="3">
        <label class="md-nav__title" for="__nav_5_1_3">
          <span class="md-nav__icon md-icon"></span>
          MySQL
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../mysql/CH01-%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B/" class="md-nav__link">
        CH01-数据类型
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../mysql/CH02-%E5%AD%98%E5%82%A8%E5%BC%95%E6%93%8E/" class="md-nav__link">
        CH02-存储引擎
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../mysql/CH03-%E7%B4%A2%E5%BC%95B%2B%E6%A0%91/" class="md-nav__link">
        CH03-索引B+树
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../mysql/CH04-%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/" class="md-nav__link">
        CH04-性能优化
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../mysql/CH05-%E5%88%86%E5%BA%93%E5%88%86%E8%A1%A8/" class="md-nav__link">
        CH05-分库分表
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../mysql/CH06-%E5%A4%8D%E5%88%B6%E5%88%86%E7%A6%BB/" class="md-nav__link">
        CH06-复制分离
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../mysql/CH07-%E6%89%A7%E8%A1%8C%E8%BF%87%E7%A8%8B/" class="md-nav__link">
        CH07-执行过程
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

          
            
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5_1_4" type="checkbox" id="__nav_5_1_4" >
      
      <label class="md-nav__link" for="__nav_5_1_4">
        Redis
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Redis" data-md-level="3">
        <label class="md-nav__title" for="__nav_5_1_4">
          <span class="md-nav__icon md-icon"></span>
          Redis
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../redis/CH01-%E5%9F%BA%E6%9C%AC%E7%B1%BB%E5%9E%8B/" class="md-nav__link">
        CH01-基本类型
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../redis/CH02-%E9%AB%98%E7%BA%A7%E7%B1%BB%E5%9E%8B/" class="md-nav__link">
        CH02-高级类型
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../redis/CH03-Stream/" class="md-nav__link">
        CH03-Stream
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../redis/CH04-%E5%AF%B9%E8%B1%A1%E6%9C%BA%E5%88%B6/" class="md-nav__link">
        CH04-对象机制
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../redis/CH05-%E5%BA%95%E5%B1%82%E7%BB%93%E6%9E%84/" class="md-nav__link">
        CH05-底层结构
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../wip/" class="md-nav__link">
        None
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../wip/" class="md-nav__link">
        微服务
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../wip/" class="md-nav__link">
        分布式
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../wip/" class="md-nav__link">
        反应式
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../wip/" class="md-nav__link">
        数据密集
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../wip/" class="md-nav__link">
        流式系统
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../wip/" class="md-nav__link">
        消息系统
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../wip/" class="md-nav__link">
        计算系统
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../wip/" class="md-nav__link">
        运维交付
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../wip/" class="md-nav__link">
        用户界面
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_6" type="checkbox" id="__nav_6" >
      
      <label class="md-nav__link" for="__nav_6">
        Interview
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Interview" data-md-level="1">
        <label class="md-nav__title" for="__nav_6">
          <span class="md-nav__icon md-icon"></span>
          Interview
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_6_1" type="checkbox" id="__nav_6_1" >
      
      <label class="md-nav__link" for="__nav_6_1">
        数据结构
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="数据结构" data-md-level="2">
        <label class="md-nav__title" for="__nav_6_1">
          <span class="md-nav__icon md-icon"></span>
          数据结构
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../ds/CH01-%E6%95%B0%E7%BB%84-%E9%93%BE%E8%A1%A8/" class="md-nav__link">
        CH01-数组/链表
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../ds/CH02-%E5%93%88%E5%B8%8C%E8%A1%A8/" class="md-nav__link">
        CH02-哈希表
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../ds/CH03-%E6%A0%91-%E4%BA%8C%E5%8F%89%E6%A0%91/" class="md-nav__link">
        CH03-树/二叉树
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../ds/CH04-%E6%8E%92%E5%BA%8F%E4%BA%8C%E5%8F%89%E6%A0%91/" class="md-nav__link">
        CH04-排序二叉树
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../ds/CH05-%E5%B9%B3%E8%A1%A1%E4%BA%8C%E5%8F%89%E6%A0%91/" class="md-nav__link">
        CH05-平衡二叉树
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../ds/CH06-%E7%BA%A2%E9%BB%91%E6%A0%91/" class="md-nav__link">
        CH06-红黑树
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../ds/CH07-%E5%93%88%E5%A4%AB%E6%9B%BC%E6%A0%91/" class="md-nav__link">
        CH07-哈夫曼树
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../ds/CH08-%E5%89%8D%E7%BC%80%E6%A0%91/" class="md-nav__link">
        CH08-前缀树
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../ds/CH09-%E5%9B%BE%E6%A6%82%E5%BF%B5/" class="md-nav__link">
        CH09-图概念
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../ds/CH10-%E9%81%8D%E5%8E%86/" class="md-nav__link">
        CH10-遍历
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../ds/CH11-%E6%9C%80%E5%B0%8F%E7%94%9F%E6%88%90%E6%A0%91/" class="md-nav__link">
        CH11-最小生成树
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../ds/CH12-%E6%9C%80%E7%9F%AD%E8%B7%AF%E5%BE%84/" class="md-nav__link">
        CH12-最短路径
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../ds/CH13-%E6%8B%93%E6%89%91%E6%8E%92%E5%BA%8F/" class="md-nav__link">
        CH13-拓扑排序
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../ds/CH14-AOE-%E5%85%B3%E9%94%AE%E8%B7%AF%E5%BE%84/" class="md-nav__link">
        CH14-AOE-关键路径
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../ds/CH15-Iterable/" class="md-nav__link">
        CH07-Iterable
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../ds/CH16-Collection/" class="md-nav__link">
        CH16-Collection
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../ds/CH17-List/" class="md-nav__link">
        CH17-List
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../ds/CH18-ArrayList/" class="md-nav__link">
        CH18-ArrayList
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../ds/CH19-Queue/" class="md-nav__link">
        CH19-Queue
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../ds/CH20-Deque/" class="md-nav__link">
        CH20-Deque
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../ds/CH21-ArrayQueue/" class="md-nav__link">
        CH21-ArrayQueue
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../ds/CH22-PriorityQueue/" class="md-nav__link">
        CH22-PriorityQueue
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../ds/CH23-LinkedList/" class="md-nav__link">
        CH23-LinkedList
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../ds/CH24-Vector/" class="md-nav__link">
        CH24-Vector
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../ds/CH25-Stack/" class="md-nav__link">
        CH25-Stack
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../ds/CH26-Map/" class="md-nav__link">
        CH26-Map
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../ds/CH27-SortedMap/" class="md-nav__link">
        CH27-SortedMap
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../ds/CH28-NavigableMap/" class="md-nav__link">
        CH28-NavigableMap
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../ds/CH29-TreeMap/" class="md-nav__link">
        CH29-TreeMap
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../ds/CH30-HashMap/" class="md-nav__link">
        CH30-HashMap
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../ds/CH31-LinkedHashMap/" class="md-nav__link">
        CH31-LinkedHashMap
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../ds/CH32-EnumMap/" class="md-nav__link">
        CH32-EnumMap
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../ds/CH33-HashTable/" class="md-nav__link">
        CH33-HashTable
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../ds/CH34-Set/" class="md-nav__link">
        CH34-Set
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../ds/CH35-EnumSet/" class="md-nav__link">
        CH35-EnumSet
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../ds/CH36-HashSet/" class="md-nav__link">
        CH36-HashSet
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../ds/CH37-LinkedHashSet/" class="md-nav__link">
        CH37-LinkedHashSet
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../ds/CH38-TreeSet/" class="md-nav__link">
        CH38-TreeSet
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../ds/CH39-FailFast/" class="md-nav__link">
        CH39-FailFast
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

          
            
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_6_2" type="checkbox" id="__nav_6_2" >
      
      <label class="md-nav__link" for="__nav_6_2">
        排序算法
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="排序算法" data-md-level="2">
        <label class="md-nav__title" for="__nav_6_2">
          <span class="md-nav__icon md-icon"></span>
          排序算法
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../algo/CH01-%E5%86%92%E6%B3%A1%E6%8E%92%E5%BA%8F/" class="md-nav__link">
        CH01-冒泡排序
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../algo/CH02-%E9%80%89%E6%8B%A9%E6%8E%92%E5%BA%8F/" class="md-nav__link">
        CH02-选择排序
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../algo/CH03-%E6%8F%92%E5%85%A5%E6%8E%92%E5%BA%8F/" class="md-nav__link">
        CH03-插入排序
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../algo/CH04-%E5%B8%8C%E5%B0%94%E6%8E%92%E5%BA%8F/" class="md-nav__link">
        CH04-希尔排序
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../algo/CH05-%E5%BD%92%E5%B9%B6%E6%8E%92%E5%BA%8F/" class="md-nav__link">
        CH05-归并排序
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../algo/CH06-%E5%BF%AB%E9%80%9F%E6%8E%92%E5%BA%8F/" class="md-nav__link">
        CH06-快速排序
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../algo/CH07-%E5%A0%86%E6%8E%92%E5%BA%8F/" class="md-nav__link">
        CH07-堆排序
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../algo/CH08-%E8%AE%A1%E6%95%B0%E6%8E%92%E5%BA%8F/" class="md-nav__link">
        CH08-计数排序
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../algo/CH09-%E6%A1%B6%E6%8E%92%E5%BA%8F/" class="md-nav__link">
        CH09-桶排序
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../algo/CH10-%E5%9F%BA%E6%95%B0%E6%8E%92%E5%BA%8F/" class="md-nav__link">
        CH10-基数排序
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

          
            
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_6_3" type="checkbox" id="__nav_6_3" >
      
      <label class="md-nav__link" for="__nav_6_3">
        剑指 Offer
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="剑指 Offer" data-md-level="2">
        <label class="md-nav__title" for="__nav_6_3">
          <span class="md-nav__icon md-icon"></span>
          剑指 Offer
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../wip/" class="md-nav__link">
        None
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

          
            
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_6_4" type="checkbox" id="__nav_6_4" >
      
      <label class="md-nav__link" for="__nav_6_4">
        面试指南
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="面试指南" data-md-level="2">
        <label class="md-nav__title" for="__nav_6_4">
          <span class="md-nav__icon md-icon"></span>
          面试指南
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../wip/" class="md-nav__link">
        None
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

          
            
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_6_5" type="checkbox" id="__nav_6_5" >
      
      <label class="md-nav__link" for="__nav_6_5">
        面试宝典
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="面试宝典" data-md-level="2">
        <label class="md-nav__title" for="__nav_6_5">
          <span class="md-nav__icon md-icon"></span>
          面试宝典
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../wip/" class="md-nav__link">
        None
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

          
            
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_6_6" type="checkbox" id="__nav_6_6" >
      
      <label class="md-nav__link" for="__nav_6_6">
        面试金典
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="面试金典" data-md-level="2">
        <label class="md-nav__title" for="__nav_6_6">
          <span class="md-nav__icon md-icon"></span>
          面试金典
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../wip/" class="md-nav__link">
        None
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

          
            
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_6_7" type="checkbox" id="__nav_6_7" >
      
      <label class="md-nav__link" for="__nav_6_7">
        Leet Code
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Leet Code" data-md-level="2">
        <label class="md-nav__title" for="__nav_6_7">
          <span class="md-nav__icon md-icon"></span>
          Leet Code
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../wip/" class="md-nav__link">
        None
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../open-source/" class="md-nav__link">
        Open Source
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../wip/" class="md-nav__link">
        Blog
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../wip/" class="md-nav__link">
        About
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="目录">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      目录
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#1" class="md-nav__link">
    1. 介绍
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2" class="md-nav__link">
    2. 巨大的错觉
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3" class="md-nav__link">
    3. 回调地狱
  </a>
  
    <nav class="md-nav" aria-label="3. 回调地狱">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#31" class="md-nav__link">
    3.1. 顺序化(副作用炼狱)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#32" class="md-nav__link">
    3.2. 并行化(梦境中的不确定性)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#33" class="md-nav__link">
    3.3. 递归(爆栈的愤怒)
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#4-future-promise" class="md-nav__link">
    4. Future &amp; Promise
  </a>
  
    <nav class="md-nav" aria-label="4. Future &amp; Promise">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#41" class="md-nav__link">
    4.1. 顺序化
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#42" class="md-nav__link">
    4.2. 并行化
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#43" class="md-nav__link">
    4.3. 递归
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#44" class="md-nav__link">
    4.4. 性能代价
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#5-taskscala-io-monad" class="md-nav__link">
    5. Task，Scala 的 IO Monad
  </a>
  
    <nav class="md-nav" aria-label="5. Task，Scala 的 IO Monad">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#51" class="md-nav__link">
    5.1. 顺序化
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#52" class="md-nav__link">
    5.2. 并行化
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#53" class="md-nav__link">
    5.3. 递归
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#6-type-class" class="md-nav__link">
    6. 函数式编程和 Type-class
  </a>
  
    <nav class="md-nav" aria-label="6. 函数式编程和 Type-class">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#61-monad" class="md-nav__link">
    6.1.  Monad(顺序化和递归)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#62-applicative" class="md-nav__link">
    6.2. Applicative(并行化)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#63" class="md-nav__link">
    6.3. 为异步求值定义类型类？
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#7" class="md-nav__link">
    7. 选择正确的工具
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                
                
                <h1 id="_1">异步编程<a class="headerlink" href="#_1" title="Permanent link">&para;</a></h1>
<p><a href="https://alexn.org/blog/2017/01/30/asynchronous-programming-scala.html">翻译自：Asynchronous Programming and Scala</a></p>
<p>现在随处可见异步性的身影，同时它也被包括在并发性之内。这篇文章解释了什么是异步处理和它面临的挑战。</p>
<h2 id="1">1. 介绍<a class="headerlink" href="#1" title="Permanent link">&para;</a></h2>
<p>它作为一个比*多线程*更加综合的概念，但是人们往往将二者混淆。如果需要一种关系来表示，可以是这样：</p>
<div class="highlight"><pre><span></span><code><span class="nc">Multithreadiing</span> <span class="o">&lt;:</span> <span class="nc">Asynchrony</span>
</code></pre></div>
<p>我们可以将异步计算表示成一个<code>type</code>：</p>
<div class="highlight"><pre><span></span><code><span class="k">type</span> <span class="kt">Async</span><span class="o">[</span><span class="kt">A</span><span class="o">]</span> <span class="o">=</span> <span class="o">(</span><span class="nc">Try</span><span class="o">[</span><span class="kt">A</span><span class="o">]</span> <span class="o">=&gt;</span> <span class="nc">Unit</span><span class="o">)</span> <span class="o">=&gt;</span> <span class="nc">Unit</span>
</code></pre></div>
<p>如果这些<code>Unit</code>返回类型看起来很丑陋，那是因为异步本身就是丑陋的。一个异步计算可以是网络中拥有如下特征的任何任务(Task)、线程、进程或节点：</p>
<ul>
<li>在你程序的主流程之外执行，或者从调用者的角度来看，它并不在当前调用栈(call-stack)执行；</li>
<li>接收一个回调，并在结果处理完成之后调用；</li>
<li>它不能对结果在何时发送做出任何保证，甚至一点也不能保证一个结果会不被发送。</li>
</ul>
<p>知道异步属于*并发*的范畴是很重要的，但多线程则没必要。要记得在 Javascript 中，大部分 I/O 操作都是异步的，甚至繁重的业务逻辑也被异步化处理(使用基于调度的 setTimeout)以保证接口是可响应的。但是并不涉及内核级别的多线程，Javascript 成了一个 N:1 的多线程化平台。</p>
<p>将异步化引入到程序中的同时也意味着你要面对并发问题，因为你无法知道异步计算具体何时会完成。因此，将多个异步计算的结果组合并在同一时间运行意味着你需要进行额外的同步操作，因此你也不能再依赖顺序。不能依赖顺序则会带来更多的不确定性。</p>
<blockquote>
<p>维基百科：一个不确定的算法，相对于确定性的算法来说，尽管提供了相同的输入，可能会在不同的运行过程表现出不同的行为。一个并行算法因为竟态条件会在多次运行时以不同的方式执行。</p>
</blockquote>
<p><img src="nondet-3aa1c5d6.png" class="max-border" width="775" alt="Nondet"></p>
<p>敏锐的读者可以会注意到这些类型随处可见，基于用例和规约做一些调整：</p>
<ul>
<li><a href="https://en.wikipedia.org/wiki/Observer_pattern">Observer pattern</a>- <a href="https://en.wikipedia.org/wiki/Design_Patterns">Gang of Four</a></li>
<li>Scala 中的<code>Future</code>，由其抽象方法<code>onComplete</code>定义</li>
<li>Java 中的<a href="https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/ExecutorService.html#submit-java.util.concurrent.Callable-">ExecutorService.submit(Callable)</a></li>
<li>Javascript 汇总的<a href="https://developer.mozilla.org/en-US/docs/Web/API/EventTarget/addEventListener">EventTarget.addEventListener</a></li>
<li>在 Akka 的 actor 中，尽管给出的回调被<code>sender()</code>替换</li>
<li>Monix 中的<a href="https://github.com/monix/monix/blob/v2.2.1/monix-eval/shared/src/main/scala/monix/eval/Task.scala#L1253">Task.Async</a>定义</li>
<li>Monix 中的 <a href="https://monix.io/api/2.2/monix/reactive/Observable.html">Observable</a>、<a href="https://monix.io/api/2.2/monix/reactive/Observer.html">Observer</a>对</li>
<li><a href="http://www.reactive-streams.org/reactive-streams-1.0.0-javadoc/">Reactive Streams</a>的详细说明</li>
</ul>
<p>这些抽象有什么共同点呢？他们都提供了处理异步化的方式，其中一些更为优秀。</p>
<h2 id="2">2. 巨大的错觉<a class="headerlink" href="#2" title="Permanent link">&para;</a></h2>
<p>我们喜欢假装能将函数的异步结果转换为同步：</p>
<div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="n">await</span><span class="o">[</span><span class="kt">A</span><span class="o">](</span><span class="n">fa</span><span class="k">:</span> <span class="kt">Async</span><span class="o">[</span><span class="kt">A</span><span class="o">])</span><span class="k">:</span> <span class="kt">A</span>
</code></pre></div>
<p>问题的实质是我们不能假装这些异步处理与普通函数相同。如果你对此需要一刻，只需要了解一下为什么 CORBA 失败了。</p>
<p>针对异步处理，我们有以下非常常见的分布式计算谬误( <a href="https://en.wikipedia.org/wiki/Fallacies_of_distributed_computing">fallacies of distributed computing</a>)：</p>
<ul>
<li>网络是可靠的</li>
<li>延迟为 0</li>
<li>带宽是无限的</li>
<li>网络是完全的</li>
<li>拓扑结构不会发生变化</li>
<li>拥有一位管理员</li>
<li>传输消耗为 0</li>
<li>网络是同质的(homogeneous)</li>
</ul>
<p>当然这些没有一条是真的。这意味着代码是按这些情形来编写的：极少的网络错误处理，忽略了网络延迟和丢包，忽略了带宽限制和随之而来的诸多不确定性。</p>
<p>人们尝试各种方式来对付这些问题：</p>
<ul>
<li>回调，导出都是对调，甚至忽略了基本问题。像 Javascript 中发生的一样，这导致了众所周知的*回调地域*，以程序员的汗水和鲜血为代价，甚至怀疑人生；</li>
<li>阻塞线程，基于<a href="https://en.wikipedia.org/wiki/Thread_(computing)#1:1_.28kernel-level_threading.29">1:1 (kernel-level) multithreading</a>平台</li>
<li><a href="https://en.wikipedia.org/wiki/Continuation">first-class continuations</a>，比如 Scheme 中实现的<a href="https://en.wikipedia.org/wiki/Call-with-current-continuation">call/cc</a>，在任何一点上保存执行状体并在程序的稍后点回到该点的能力；</li>
<li>来之 C# 的<code>async</code>/<code>await</code>语言扩展，同样在<a href="https://github.com/scala/async">scala-async</a>、最新的<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/async_function">ECMAScript</a>也有实现；</li>
<li>有运行时管理的<a href="https://en.wikipedia.org/wiki/Green_threads">Green threads</a>，可能与 <a href="https://en.wikipedia.org/wiki/Thread_(computing)#M:N_.28hybrid_threading.29">M:N multithreading</a>组合，来模拟异步动作的阻塞。比如 Golang 和 Haskell；</li>
<li>Erlang 和 Akka 中实现了<a href="https://en.wikipedia.org/wiki/Actor_model">actor model</a>，或者  <a href="https://github.com/clojure/core.async">Clojure's core.async</a> 或 Golang 中的<a href="https://en.wikipedia.org/wiki/Communicating_sequential_processes">CSP</a>；</li>
<li>Monad 用于顺序和组合，比如 Haskell 的 <a href="https://hackage.haskell.org/package/async-2.1.1/docs/Control-Concurrent-Async.html">Async</a>类型和 <a href="https://wiki.haskell.org/IO_inside">IO</a>类型的组合，或者： <a href="https://docs.microsoft.com/en-us/dotnet/articles/fsharp/language-reference/asynchronous-workflows">F# asynchronous workflows</a>、 <a href="http://docs.scala-lang.org/overviews/core/futures.html">Scala's Futures and Promises</a>、<a href="https://monix.io/docs/2x/eval/task.html">Monix Task</a> 或 <a href="https://github.com/scalaz/scalaz/blob/scalaz-seven/concurrent/src/main/scala/scalaz/concurrent/Task.scala">Scalaz Task</a>, 等等。</li>
</ul>
<p>有这么多不同的实现，是因为没有任何一种是适用于通用目的的机制来处理异步。没有银弹的窘境在这里很切题，内存管理和并发成为我们开发者面临的巨大问题。</p>
<blockquote>
<p>注意 - 个人观点和一些碎碎念：人们喜欢吹嘘像 Golang 这样的 M:N 平台，然而我更偏向于 1:1 的多线程平台，比如 JVM 或 .NET。</p>
<p>因为你可以在编程语言中基于 1:1 平台搭建 M:N 的多线程来提供足够的表现力(比如：Scala 的 Future、Task、Clojure 的 core.async 等等)，但是一旦 M:N 的运行时不再适用于你的场景，你则无法修改或替换平台。是的，大多数 M:N 平台都被一种方式或另一种打破。</p>
<p>真正的学习所有可行方案或做出选择是很痛苦的，但总比做出无知的选择要痛苦的少，TOOWTDI(?) 和 “worse is better”在这种情况下害处则会更大。人们在解释难于学习一门新的或更有表现力的语言时，比如 Scala 或 Haskell，往往没有提到点上，因为如果他们不得不处理并发问题，这是学习一种新的编程语言将会使他们最小的问题。我了解到一些人因为并发问题而离开了软件行业。</p>
</blockquote>
<h2 id="3">3. 回调地狱<a class="headerlink" href="#3" title="Permanent link">&para;</a></h2>
<p>让我们创建一个仿造的例子来阐明我们的疑问。比如开启两个异步处理并将他们的结果结合在一起。</p>
<p>首先定义一个异步执行的函数：</p>
<div class="highlight"><pre><span></span><code><span class="k">import</span> <span class="nn">scala.concurrent.ExecutionContext.global</span>

<span class="k">type</span> <span class="kt">Async</span><span class="o">[</span><span class="kt">A</span><span class="o">]</span> <span class="o">=</span> <span class="o">(</span><span class="n">A</span> <span class="o">=&gt;</span> <span class="nc">Unit</span><span class="o">)</span> <span class="o">=&gt;</span> <span class="nc">Unit</span>

<span class="k">def</span> <span class="n">timeTwo</span><span class="o">(</span><span class="n">n</span><span class="k">:</span> <span class="kt">Int</span><span class="o">)</span><span class="k">:</span> <span class="kt">Async</span><span class="o">[</span><span class="kt">Int</span><span class="o">]</span> <span class="o">=</span> <span class="o">{</span>
  <span class="n">onFinish</span> <span class="o">=&gt;</span> <span class="o">{</span>
    <span class="n">global</span><span class="o">.</span><span class="n">execute</span><span class="o">(</span><span class="k">new</span> <span class="nc">Runnable</span><span class="o">{</span>
      <span class="k">def</span> <span class="n">run</span><span class="o">()</span><span class="k">:</span><span class="kt">Unit</span> <span class="o">=</span> <span class="o">{</span>
        <span class="k">val</span> <span class="n">result</span> <span class="o">=</span> <span class="n">n</span> <span class="o">*</span> <span class="mi">2</span>
        <span class="n">onFinish</span><span class="o">(</span><span class="n">result</span><span class="o">)</span>
      <span class="o">}</span>
    <span class="o">})</span>
  <span class="o">}</span>
<span class="o">}</span>

<span class="c1">// Usage</span>
<span class="n">timesTwo</span><span class="o">(</span><span class="mi">20</span><span class="o">)</span> <span class="o">{</span> <span class="n">result</span> <span class="o">=&gt;</span> <span class="n">println</span><span class="o">(</span><span class="s">s&quot;Result: </span><span class="si">$result</span><span class="s">&quot;</span><span class="o">)}</span>
<span class="c1">// =&gt; Result: 40</span>
</code></pre></div>
<h3 id="31">3.1. 顺序化(副作用炼狱)<a class="headerlink" href="#31" title="Permanent link">&para;</a></h3>
<p>让我们来结合两个异步结果，以平滑的顺序让一个在另一个发生之后执行：</p>
<div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="n">timesFour</span><span class="o">(</span><span class="n">n</span><span class="k">:</span><span class="kt">Int</span><span class="o">)</span><span class="k">:</span><span class="kt">Async</span><span class="o">[</span><span class="kt">Int</span><span class="o">]</span> <span class="o">=</span> <span class="o">{</span>
  <span class="n">onFinish</span> <span class="o">=&gt;</span> <span class="o">{</span>
    <span class="n">timesTwo</span><span class="o">(</span><span class="n">n</span><span class="o">){</span> <span class="n">a</span> <span class="o">=&gt;</span>
      <span class="n">timesTwo</span><span class="o">(</span><span class="n">n</span><span class="o">){</span> <span class="n">n</span> <span class="o">=&gt;</span>
        <span class="c1">// Combining the two results</span>
        <span class="n">onFinish</span><span class="o">(</span><span class="n">a</span> <span class="o">+</span> <span class="n">b</span><span class="o">)</span>
      <span class="o">}</span>
    <span class="o">}</span>
  <span class="o">}</span>
<span class="o">}</span>

<span class="c1">// Usage</span>
<span class="n">timesFour</span><span class="o">(</span><span class="mi">20</span><span class="o">)</span> <span class="o">{</span> <span class="n">result</span> <span class="o">=&gt;</span> <span class="n">println</span><span class="o">(</span><span class="s">s&quot;Result: </span><span class="si">$result</span><span class="s">&quot;</span><span class="o">)}</span>
<span class="c1">// =&gt; Result: 80</span>
</code></pre></div>
<p>看起来很简单，但是我们仅结合了两个结果，一个跟在另一个之后。</p>
<p>巨大的问题仍然是**它触及到的所有异步化副作用**。我们假设由于参数的缘故我们以一个纯函数开始：</p>
<div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="n">timesFour</span><span class="o">(</span><span class="n">n</span><span class="k">:</span><span class="kt">Int</span><span class="o">)</span><span class="k">:</span><span class="kt">Int</span>
</code></pre></div>
<p>但是这是你的企业架构师听说了这些企业 JavaBean 和 a lap dance(?)，决定让你基于这些异步的<code>timsTwo</code>函数。这时我们的<code>timesFour</code>实现从一个精确的纯函数编程一个有副作用的函数。同时伴随一个并不成熟的<code>Async</code>类型，我们需要面对在整个管道(pipeline)处理副作用。同时，阻塞结果也没有任何帮助，你只是隐藏了问题所在(第二节所述)。</p>
<p>但是等等，事情还会变得更糟。</p>
<h3 id="32">3.2. 并行化(梦境中的不确定性)<a class="headerlink" href="#32" title="Permanent link">&para;</a></h3>
<p>第二个调用并不基于第一个调用，因此他们可以并行运行。在 JVM 我们可以并行运行 CPU-bound 的任务，但这并不适用于 Javascript，我们可以发起 Ajax 请求或于其他网页工作者(web worker)交谈。</p>
<p>不幸的是事情会变的有点复杂。首先使用所有自然(navie)方式来做都会非常错误：</p>
<div class="highlight"><pre><span></span><code><span class="c1">// REALLY BAD SAMPLE</span>

<span class="k">def</span> <span class="n">timesFourInParallel</span><span class="o">(</span><span class="n">n</span><span class="k">:</span><span class="kt">Int</span><span class="o">)</span><span class="k">:</span><span class="kt">Async</span><span class="o">[</span><span class="kt">Int</span><span class="o">]</span> <span class="o">=</span> <span class="o">{</span>
  <span class="n">onFinish</span> <span class="o">=&gt;</span> <span class="o">{</span>
    <span class="k">var</span> <span class="n">cacheA</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="n">timesTwo</span><span class="o">(</span><span class="n">n</span><span class="o">)</span> <span class="o">{</span> <span class="n">a</span> <span class="o">=&gt;</span> <span class="n">cacheA</span> <span class="o">=</span> <span class="n">a</span><span class="o">}</span>

    <span class="n">timesTwo</span><span class="o">(</span><span class="n">n</span><span class="o">)</span> <span class="o">{</span> <span class="n">b</span> <span class="o">=&gt;</span>
      <span class="c1">// Combing the two results</span>
      <span class="n">onFinish</span><span class="o">(</span><span class="n">cacheA</span> <span class="o">+</span> <span class="n">b</span><span class="o">)</span>
    <span class="o">}</span>
  <span class="o">}</span>
<span class="o">}</span>

<span class="n">timesFourInParallel</span><span class="o">(</span><span class="mi">20</span><span class="o">)</span> <span class="o">{</span><span class="n">result</span> <span class="o">=&gt;</span> <span class="n">println</span><span class="o">(</span><span class="s">s&quot;Result: </span><span class="si">$result</span><span class="s">&quot;</span><span class="o">)}</span>
<span class="c1">// =&gt; Result: 80</span>

<span class="n">timesFourInParallel</span><span class="o">(</span><span class="mi">20</span><span class="o">)</span> <span class="o">{</span><span class="n">result</span> <span class="o">=&gt;</span> <span class="n">println</span><span class="o">(</span><span class="s">s&quot;Result: </span><span class="si">$result</span><span class="s">&quot;</span><span class="o">)}</span>
<span class="c1">// =&gt; Result: 40</span>
</code></pre></div>
<p>这里的例子展示了实际中的不确定性。我们得不到顺序保证哪个会先结束，因此如果我们要并行执行，需要建模一个迷你状态机来进行同步。</p>
<p>首先，定义 ADT 来描述状态机：</p>
<div class="highlight"><pre><span></span><code><span class="c1">// Define the state machine</span>
<span class="k">sealed</span> <span class="k">trait</span> <span class="nc">State</span>
<span class="c1">// Initial state</span>
<span class="k">case</span> <span class="k">object</span> <span class="nc">Start</span> <span class="k">extends</span> <span class="nc">State</span>
<span class="c1">// We got a B, waiting for an A</span>
<span class="k">final</span> <span class="k">case</span> <span class="k">class</span> <span class="nc">WaitForA</span><span class="o">(</span><span class="n">b</span><span class="k">:</span><span class="kt">Int</span><span class="o">)</span> <span class="k">extends</span> <span class="nc">State</span>
<span class="c1">// We got a A, waiting for a B</span>
<span class="k">final</span> <span class="k">case</span> <span class="k">class</span> <span class="nc">WaitForB</span><span class="o">(</span><span class="n">a</span><span class="k">:</span><span class="kt">Int</span><span class="o">)</span> <span class="k">extends</span> <span class="nc">State</span>
</code></pre></div>
<p>然后以异步的方式来演化这个状态机：</p>
<div class="highlight"><pre><span></span><code><span class="c1">// BAD SAMPLE FOR THE JVM(only works for Javascript)</span>

<span class="k">def</span> <span class="n">timesFourInParallel</span><span class="o">(</span><span class="n">n</span><span class="k">:</span><span class="kt">Int</span><span class="o">)</span><span class="k">:</span><span class="kt">Async</span><span class="o">[</span><span class="kt">Int</span><span class="o">]</span> <span class="o">=</span> <span class="o">{</span>
  <span class="n">onFinish</span> <span class="o">=&gt;</span> <span class="o">{</span>
    <span class="k">var</span> <span class="n">state</span><span class="k">:</span><span class="kt">State</span> <span class="o">=</span> <span class="nc">Start</span>

    <span class="n">timesTwo</span><span class="o">(</span><span class="n">n</span><span class="o">)</span> <span class="o">{</span> <span class="n">a</span> <span class="o">=&gt;</span>
      <span class="n">state</span> <span class="k">match</span> <span class="o">{</span>
        <span class="k">case</span> <span class="nc">Start</span> <span class="o">=&gt;</span> <span class="n">state</span> <span class="o">=</span> <span class="nc">WaitForB</span><span class="o">(</span><span class="n">a</span><span class="o">)</span>
        <span class="k">case</span> <span class="nc">WaitForA</span><span class="o">(</span><span class="n">b</span><span class="o">)</span> <span class="o">=&gt;</span> <span class="n">onFinish</span><span class="o">(</span><span class="n">a</span> <span class="o">+</span> <span class="n">b</span><span class="o">)</span>
        <span class="k">case</span> <span class="nc">WaitForB</span><span class="o">(</span><span class="k">_</span><span class="o">)</span> <span class="o">=&gt;</span> 
          <span class="c1">// Can&#39;t be caught b/c async, hopefully it gets reported</span>
          <span class="k">throw</span> <span class="k">new</span> <span class="nc">IllegalStateException</span><span class="o">(</span><span class="n">state</span><span class="o">.</span><span class="n">toString</span><span class="o">)</span>
      <span class="o">}</span>
    <span class="o">}</span>

    <span class="n">timesTwo</span><span class="o">(</span><span class="n">n</span><span class="o">)</span> <span class="o">{</span> <span class="n">b</span> <span class="o">=&gt;</span>
      <span class="n">state</span> <span class="k">match</span> <span class="o">{</span>
        <span class="k">case</span> <span class="nc">Start</span> <span class="o">=&gt;</span> <span class="n">state</span> <span class="o">=</span> <span class="nc">WaitForA</span><span class="o">(</span><span class="n">b</span><span class="o">)</span>
        <span class="k">case</span> <span class="nc">WaitForB</span><span class="o">(</span><span class="n">a</span><span class="o">)</span> <span class="o">=&gt;</span> <span class="n">onFinish</span><span class="o">(</span><span class="n">a</span> <span class="o">+</span> <span class="n">b</span><span class="o">)</span>
        <span class="k">case</span> <span class="nc">WaitForA</span><span class="o">(</span><span class="k">_</span><span class="o">)</span> <span class="o">=&gt;</span> 
          <span class="c1">// Can&#39;t be caught b/c async, hopefully it gets reported</span>
          <span class="k">throw</span> <span class="k">new</span> <span class="nc">IllegalStateException</span><span class="o">(</span><span class="n">state</span><span class="o">.</span><span class="n">toString</span><span class="o">)</span>
      <span class="o">}</span>
    <span class="o">}</span>
  <span class="o">}</span>
<span class="o">}</span>
</code></pre></div>
<p>为了更好的视觉化我们处理的问题，下图是状态机：</p>
<p><img src="callback-hell-stm-2cd322e2.png" align="center" width="300" alt="Callback hell stm"></p>
<p>但是等等，我们还没结束，因为 JVM 拥有真实的 1:1 多线程，这表示我们要沉浸于*可共享内存的并行化*，因此对<code>state</code>的访问必须是同步的。</p>
<p>一种方案是使用<code>synchronized</code>块，或称为*intrinsic*块：</p>
<div class="highlight"><pre><span></span><code><span class="c1">// We need a common reference to act as our monitor</span>
<span class="k">val</span> <span class="n">lockkk</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">AnyRef</span>
<span class="k">var</span> <span class="n">state</span><span class="k">:</span><span class="kt">State</span> <span class="o">=</span> <span class="nc">Start</span>

<span class="n">timeTwo</span><span class="o">(</span><span class="n">n</span><span class="o">)</span> <span class="o">{</span> <span class="n">a</span> <span class="o">=&gt;</span>
  <span class="n">lock</span><span class="o">.</span><span class="n">synchronized</span><span class="o">{</span>
    <span class="n">state</span> <span class="k">match</span> <span class="o">{</span>
      <span class="k">case</span> <span class="nc">Start</span> <span class="o">=&gt;</span>
        <span class="n">state</span> <span class="o">=</span> <span class="nc">WaitForB</span><span class="o">(</span><span class="n">a</span><span class="o">)</span>
      <span class="k">case</span> <span class="nc">WaitForA</span><span class="o">(</span><span class="n">b</span><span class="o">)</span> <span class="o">=&gt;</span>
        <span class="n">onFinish</span><span class="o">(</span><span class="n">a</span> <span class="o">+</span> <span class="n">b</span><span class="o">)</span>
      <span class="k">case</span> <span class="nc">WaitForB</span><span class="o">(</span><span class="k">_</span><span class="o">)</span> <span class="o">=&gt;</span>
        <span class="c1">// Can&#39;t be caught b/c async, hopefully it gets reported</span>
        <span class="k">throw</span> <span class="k">new</span> <span class="nc">IllegalStateException</span><span class="o">(</span><span class="n">state</span><span class="o">.</span><span class="n">toString</span><span class="o">)</span>
    <span class="o">}</span>
  <span class="o">}</span>
<span class="o">}</span>

<span class="c1">// ...</span>
</code></pre></div>
<p>这种高级别的锁保护资源(eg. state)不被多线程并行访问。但我个人更倾向于避免这种高级别的锁，因为内核的调度器可以以任何原因冻结任何线程，包括持有锁的线程。冻结一个持有锁的线程意味着如果你想保证持续前进，而其他线程无法再继续前进，这是无阻塞(<a href="https://en.wikipedia.org/wiki/Non-blocking_algorithm">non-blocking</a>)的逻辑则会更优先。</p>
<p>因此供替代的方式是使用一个<a href="https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/atomic/AtomicReference.html">AtomicReference</a>，它会更适用这个场景：</p>
<div class="highlight"><pre><span></span><code><span class="c1">// CORRECT VERSION FOR JVM</span>

<span class="k">import</span> <span class="nn">scala.annitation.tailrec</span>
<span class="k">import</span> <span class="nn">java.util.concurrent.atomic.AtomicReference</span>

<span class="k">def</span> <span class="n">timeFourInParallel</span><span class="o">(</span><span class="n">n</span><span class="k">:</span><span class="kt">Int</span><span class="o">)</span><span class="k">:</span><span class="kt">Async</span><span class="o">[</span><span class="kt">Int</span><span class="o">]</span> <span class="o">=</span> <span class="o">{</span>
  <span class="n">onFinish</span> <span class="o">=&gt;{</span>
    <span class="k">val</span> <span class="n">state</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">AtomicReference</span><span class="o">[</span><span class="kt">State</span><span class="o">](</span><span class="nc">Start</span><span class="o">)</span>

    <span class="nd">@tailrec</span> <span class="k">def</span> <span class="n">onValueA</span><span class="o">(</span><span class="n">a</span><span class="k">:</span><span class="kt">Int</span><span class="o">)</span><span class="k">:</span><span class="kt">Unit</span> <span class="o">=</span> <span class="o">{</span>
      <span class="n">state</span><span class="o">.</span><span class="n">get</span> <span class="k">match</span><span class="o">{</span>
        <span class="k">case</span> <span class="nc">Start</span> <span class="o">=&gt;</span> 
          <span class="k">if</span><span class="o">(!</span><span class="n">state</span><span class="o">.</span><span class="n">compareAndSet</span><span class="o">(</span><span class="nc">Start</span><span class="o">,</span> <span class="nc">WaitForB</span><span class="o">(</span><span class="n">a</span><span class="o">)))</span> <span class="n">onValue</span><span class="o">(</span><span class="n">a</span><span class="o">)</span> <span class="c1">// retry</span>
        <span class="k">case</span> <span class="nc">WaitForA</span><span class="o">(</span><span class="n">b</span><span class="o">)</span> <span class="o">=&gt;</span> <span class="n">onFinish</span><span class="o">(</span><span class="n">a</span> <span class="o">+</span> <span class="n">b</span><span class="o">)</span>
        <span class="k">case</span> <span class="nc">WaitForB</span><span class="o">(</span><span class="n">a</span><span class="o">)</span> <span class="o">=&gt;</span> <span class="k">throw</span> <span class="k">new</span> <span class="nc">IllegalStateException</span><span class="o">(</span><span class="n">state</span><span class="o">.</span><span class="n">toString</span><span class="o">)</span>
      <span class="o">}</span>
    <span class="o">}</span>

    <span class="n">timesTwo</span><span class="o">(</span><span class="n">n</span><span class="o">)(</span><span class="n">onValueA</span><span class="o">)</span>

    <span class="nd">@tailrec</span> <span class="k">def</span> <span class="n">onValueB</span><span class="o">(</span><span class="n">b</span><span class="k">:</span><span class="kt">Int</span><span class="o">)</span><span class="k">:</span><span class="kt">Unit</span> <span class="o">=</span> <span class="o">{</span>
      <span class="n">state</span><span class="o">.</span><span class="n">get</span> <span class="k">match</span> <span class="o">{</span>
        <span class="k">case</span> <span class="nc">Start</span> <span class="o">=&gt;</span>
          <span class="k">if</span> <span class="o">(!</span><span class="n">state</span><span class="o">.</span><span class="n">compareAndSet</span><span class="o">(</span><span class="nc">Start</span><span class="o">,</span> <span class="nc">WaitForA</span><span class="o">(</span><span class="n">b</span><span class="o">)))</span>
            <span class="n">onValueB</span><span class="o">(</span><span class="n">b</span><span class="o">)</span> <span class="c1">// retry</span>
        <span class="k">case</span> <span class="nc">WaitForB</span><span class="o">(</span><span class="n">a</span><span class="o">)</span> <span class="o">=&gt;</span>
          <span class="n">onFinish</span><span class="o">(</span><span class="n">a</span> <span class="o">+</span> <span class="n">b</span><span class="o">)</span>
        <span class="k">case</span> <span class="nc">WaitForA</span><span class="o">(</span><span class="k">_</span><span class="o">)</span> <span class="o">=&gt;</span>
          <span class="c1">// Can&#39;t be caught b/c async, hopefully it gets reported</span>
          <span class="k">throw</span> <span class="k">new</span> <span class="nc">IllegalStateException</span><span class="o">(</span><span class="n">state</span><span class="o">.</span><span class="n">toString</span><span class="o">)</span>
      <span class="o">}</span>
    <span class="o">}</span>

    <span class="n">timesTwo</span><span class="o">(</span><span class="n">n</span><span class="o">)(</span><span class="n">onValueB</span><span class="o">)</span>
  <span class="o">}</span>
<span class="o">}</span>
</code></pre></div>
<blockquote>
<p><strong>PRO-TIP</strong>：如果你想编写  Javascript / Scala.js 的交叉编译代码，基于性能调整和用于操作原子引用的酷炫工具类，可以尝试<a href="https://monix.io/">Monix</a>中的<a href="https://monix.io/docs/2x/execution/atomic.html">Atomic</a>。</p>
</blockquote>
<h3 id="33">3.3. 递归(爆栈的愤怒)<a class="headerlink" href="#33" title="Permanent link">&para;</a></h3>
<p>如果我告诉你上面的<code>onFinish</code>调用并非栈安全(stack-unsafe)的，同时当你调用它时也不会强制*异步边界(asynchronous boundary)*，这时你的程序会因为一个<code>StackOverflowError</code>爆炸，又该怎么办呢？</p>
<p>你不应该相信为的话。首先让我们找些乐子，同时以更通用的方式来定义上面的操作：</p>
<div class="highlight"><pre><span></span><code><span class="k">import</span> <span class="nn">scala.annotation.tailrec</span>
<span class="k">import</span> <span class="nn">java.util.concurrent.atomic.AtomicReference</span>

<span class="k">type</span> <span class="kt">Async</span><span class="o">[</span><span class="kt">+A</span><span class="o">]</span> <span class="o">=</span> <span class="o">(</span><span class="n">A</span> <span class="o">=&gt;</span> <span class="nc">Unit</span><span class="o">)</span> <span class="o">=&gt;</span> <span class="nc">Unit</span>

<span class="k">def</span> <span class="n">mapBoth</span><span class="o">[</span><span class="kt">A</span><span class="p">,</span><span class="kt">B</span><span class="p">,</span><span class="kt">R</span><span class="o">](</span><span class="n">fa</span><span class="k">:</span><span class="kt">Async</span><span class="o">[</span><span class="kt">A</span><span class="o">],</span> <span class="n">fb</span><span class="k">:</span><span class="kt">Async</span><span class="o">[</span><span class="kt">b</span><span class="o">])(</span><span class="n">f</span><span class="k">:</span><span class="o">(</span><span class="kt">A</span><span class="o">,</span><span class="kt">B</span><span class="o">)</span> <span class="o">=&gt;</span> <span class="n">R</span><span class="o">)</span><span class="k">:</span> <span class="kt">Async</span><span class="o">[</span><span class="kt">R</span><span class="o">]</span> <span class="o">=</span> <span class="o">{</span>
  <span class="c1">// Defines the state machine</span>
  <span class="k">sealed</span> <span class="k">trait</span> <span class="nc">State</span><span class="o">[</span><span class="kt">+A</span><span class="p">,</span><span class="kt">+B</span><span class="o">]</span>
  <span class="c1">// Initial state</span>
  <span class="k">case</span> <span class="k">object</span> <span class="nc">Start</span> <span class="k">extends</span> <span class="nc">State</span><span class="o">[</span><span class="kt">Nothing</span><span class="p">,</span> <span class="kt">Nothing</span><span class="o">]</span>
  <span class="c1">// We got a B, waiting for an A</span>
  <span class="k">final</span> <span class="k">case</span> <span class="k">class</span> <span class="nc">WaitForA</span><span class="o">[</span><span class="kt">+B</span><span class="o">](</span><span class="n">b</span><span class="k">:</span><span class="kt">B</span><span class="o">)</span> <span class="k">extends</span> <span class="nc">State</span><span class="o">[</span><span class="kt">Nothing</span><span class="p">,</span> <span class="kt">B</span><span class="o">]</span>
  <span class="c1">// We got an A, waiting for a B</span>
  <span class="k">final</span> <span class="k">case</span> <span class="k">class</span> <span class="nc">WaitForB</span><span class="o">[</span><span class="kt">+A</span><span class="o">](</span><span class="n">a</span><span class="k">:</span><span class="kt">A</span><span class="o">)</span> <span class="k">extends</span> <span class="nc">State</span><span class="o">[</span><span class="kt">A</span><span class="p">,</span> <span class="kt">Nothing</span><span class="o">]</span>

  <span class="n">onFinish</span> <span class="o">=&gt;{</span>
    <span class="k">val</span> <span class="n">state</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">AtomicReference</span><span class="o">[</span><span class="kt">State</span><span class="o">[</span><span class="kt">A</span><span class="p">,</span><span class="kt">B</span><span class="o">]](</span><span class="nc">Start</span><span class="o">)</span>

    <span class="nd">@tailrec</span> <span class="k">def</span> <span class="n">onVlueA</span><span class="o">(</span><span class="n">a</span><span class="k">:</span><span class="kt">A</span><span class="o">)</span><span class="k">:</span><span class="kt">Uint</span> <span class="o">=</span> <span class="o">{</span>
      <span class="n">state</span><span class="o">.</span><span class="n">get</span> <span class="k">match</span> <span class="o">{</span>
        <span class="k">case</span> <span class="nc">Start</span> <span class="o">=&gt;</span> 
          <span class="k">if</span><span class="o">(!</span><span class="n">state</span><span class="o">.</span><span class="n">compareAndSet</span><span class="o">(</span><span class="nc">Start</span><span class="o">,</span> <span class="nc">WaitForB</span><span class="o">(</span><span class="n">a</span><span class="o">)))</span> <span class="n">onValue</span><span class="o">(</span><span class="n">a</span><span class="o">)</span> <span class="c1">//retry</span>
        <span class="k">case</span> <span class="nc">WaitForA</span><span class="o">(</span><span class="n">b</span><span class="o">)</span> <span class="o">=&gt;</span> <span class="n">onFinish</span><span class="o">(</span><span class="n">f</span><span class="o">(</span><span class="n">a</span><span class="o">,</span><span class="n">b</span><span class="o">))</span>
        <span class="k">case</span> <span class="nc">WaitForB</span><span class="o">(</span><span class="n">a</span><span class="o">)</span> <span class="o">=&gt;</span>
          <span class="k">throw</span> <span class="k">new</span> <span class="nc">IllegalStateException</span><span class="o">(</span><span class="n">state</span><span class="o">.</span><span class="n">toString</span><span class="o">)</span>
      <span class="o">}</span>
    <span class="o">}</span>

    <span class="nd">@tailrec</span> <span class="k">def</span> <span class="n">onValueB</span><span class="o">(</span><span class="n">b</span><span class="k">:</span><span class="kt">B</span><span class="o">)</span><span class="k">:</span><span class="kt">Unit</span> <span class="o">=</span> <span class="o">{</span>
      <span class="n">state</span><span class="o">.</span><span class="n">get</span> <span class="k">match</span><span class="o">{</span>
        <span class="k">case</span> <span class="nc">Start</span> <span class="o">=&gt;</span>
          <span class="k">if</span> <span class="o">(!</span><span class="n">state</span><span class="o">.</span><span class="n">compareAndSet</span><span class="o">(</span><span class="nc">Start</span><span class="o">,</span> <span class="nc">WaitForA</span><span class="o">(</span><span class="n">b</span><span class="o">)))</span>
            <span class="n">onValueB</span><span class="o">(</span><span class="n">b</span><span class="o">)</span> <span class="c1">// retry</span>
        <span class="k">case</span> <span class="nc">WaitForB</span><span class="o">(</span><span class="n">a</span><span class="o">)</span> <span class="o">=&gt;</span> <span class="n">onFinissh</span><span class="o">(</span><span class="n">f</span><span class="o">(</span><span class="n">a</span><span class="o">,</span><span class="n">b</span><span class="o">))</span>
        <span class="k">case</span> <span class="nc">WaitForA</span><span class="o">(</span><span class="n">b</span><span class="o">)</span> <span class="o">=&gt;</span> 
          <span class="k">throw</span> <span class="k">new</span> <span class="nc">IllegalStateException</span><span class="o">(</span><span class="n">state</span><span class="o">.</span><span class="n">toString</span><span class="o">)</span>
      <span class="o">}</span>
    <span class="o">}</span>

    <span class="n">fa</span><span class="o">(</span><span class="n">onValueA</span><span class="o">)</span>
    <span class="n">fb</span><span class="o">(</span><span class="n">onValueB</span><span class="o">)</span>
  <span class="o">}</span>
<span class="o">}</span>
</code></pre></div>
<p>现在可以定义一个类似 Scala 中的<code>Future.sequence</code>操作，因为我们的意志坚强，勇气不可估量.....</p>
<div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="n">sequence</span><span class="o">[</span><span class="kt">A</span><span class="o">](</span><span class="n">list</span><span class="k">:</span><span class="kt">List</span><span class="o">[</span><span class="kt">Async</span><span class="o">[</span><span class="kt">A</span><span class="o">]])</span><span class="k">:</span><span class="kt">Async</span><span class="o">[</span><span class="kt">List</span><span class="o">[</span><span class="kt">A</span><span class="o">]]</span> <span class="o">=</span> <span class="o">{</span>
  <span class="nd">@tailrec</span> <span class="k">def</span> <span class="n">loop</span><span class="o">(</span><span class="n">list</span><span class="k">:</span><span class="kt">List</span><span class="o">[</span><span class="kt">Async</span><span class="o">[</span><span class="kt">A</span><span class="o">]],</span> <span class="n">acc</span><span class="k">:</span><span class="kt">Async</span><span class="o">[</span><span class="kt">List</span><span class="o">[</span><span class="kt">A</span><span class="o">]])</span><span class="k">:</span> <span class="kt">Async</span><span class="o">[</span><span class="kt">List</span><span class="o">[</span><span class="kt">A</span><span class="o">]]</span> <span class="o">=</span> <span class="o">{</span>
    <span class="n">list</span> <span class="k">match</span> <span class="o">{</span>
      <span class="k">case</span> <span class="nc">Nil</span> <span class="o">=&gt;</span>
        <span class="n">onFinish</span> <span class="o">=&gt;</span> <span class="n">acc</span><span class="o">(</span><span class="n">r</span> <span class="o">=&gt;</span> <span class="n">onFinish</span><span class="o">(</span><span class="n">r</span><span class="o">.</span><span class="n">reverse</span><span class="o">))</span>
      <span class="k">case</span> <span class="n">x</span> <span class="o">::</span> <span class="n">xs</span> <span class="o">=&gt;</span>
        <span class="k">val</span> <span class="n">update</span> <span class="o">=</span> <span class="n">mapBoth</span><span class="o">(</span><span class="n">x</span><span class="o">,</span> <span class="n">acc</span><span class="o">)(</span><span class="k">_</span> <span class="o">::</span> <span class="k">_</span><span class="o">)</span>
        <span class="n">loop</span><span class="o">(</span><span class="n">xs</span><span class="o">,</span> <span class="n">update</span><span class="o">)</span>
    <span class="o">}</span>
  <span class="o">}</span>

  <span class="n">vall</span> <span class="n">empty</span><span class="k">:</span><span class="kt">Async</span><span class="o">[</span><span class="kt">List</span><span class="o">[</span><span class="kt">A</span><span class="o">]]</span> <span class="o">=</span> <span class="k">_</span><span class="o">(</span><span class="nc">Nil</span><span class="o">)</span>
  <span class="n">loop</span><span class="o">(</span><span class="n">list</span><span class="o">,</span> <span class="n">empty</span><span class="o">)</span>
<span class="o">}</span>

<span class="c1">// Invocation</span>
<span class="n">sequence</span><span class="o">(</span><span class="nc">List</span><span class="o">(</span><span class="n">timesTwo</span><span class="o">(</span><span class="mi">10</span><span class="o">),</span> <span class="n">timesTwo</span><span class="o">(</span><span class="mi">20</span><span class="o">),</span> <span class="n">timesTwo</span><span class="o">(</span><span class="mi">30</span><span class="o">)))</span> <span class="o">{</span><span class="n">r</span> <span class="o">=&gt;</span>
  <span class="n">println</span><span class="o">(</span><span class="s">s&quot;Result: </span><span class="si">$r</span><span class="s">&quot;</span><span class="o">)</span>
<span class="o">}</span>
<span class="c1">// =&gt; Result: List(20, 40, 60)</span>
</code></pre></div>
<p>你一定认为我们完成了？</p>
<div class="highlight"><pre><span></span><code><span class="k">val</span> <span class="n">list</span> <span class="o">=</span> <span class="mf">0.</span><span class="n">until</span><span class="o">(</span><span class="mi">10000</span><span class="o">).</span><span class="n">map</span><span class="o">(</span><span class="n">timesTwo</span><span class="o">).</span><span class="n">toList</span>
<span class="n">sequence</span><span class="o">(</span><span class="n">list</span><span class="o">)(</span><span class="n">r</span> <span class="o">=&gt;</span> <span class="n">println</span><span class="o">(</span><span class="s">s&quot;Sum: </span><span class="si">${</span><span class="n">r</span><span class="o">.</span><span class="n">sum</span><span class="si">}</span><span class="s">&quot;</span><span class="o">))</span>
</code></pre></div>
<p>注意看这个壮丽的内存错误，它会让你的程序在生产环境崩溃，被认为是一个致命错误，因此 Scala 的<code>NonFatal</code>也捕捉不到：</p>
<div class="highlight"><pre><span></span><code><span class="n">java</span><span class="o">.</span><span class="n">lang</span><span class="o">.</span><span class="nc">StackOverflowError</span>
  <span class="n">at</span> <span class="n">java</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">concurrent</span><span class="o">.</span><span class="nc">ForkJoinPool</span><span class="o">.</span><span class="n">externalPush</span><span class="o">(</span><span class="nc">ForkJoinPool</span><span class="o">.</span><span class="n">java</span><span class="k">:</span><span class="err">2414</span><span class="o">)</span>
  <span class="n">at</span> <span class="n">java</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">concurrent</span><span class="o">.</span><span class="nc">ForkJoinPool</span><span class="o">.</span><span class="n">execute</span><span class="o">(</span><span class="nc">ForkJoinPool</span><span class="o">.</span><span class="n">java</span><span class="k">:</span><span class="err">2630</span><span class="o">)</span>
  <span class="n">at</span> <span class="n">scala</span><span class="o">.</span><span class="n">concurrent</span><span class="o">.</span><span class="n">impl</span><span class="o">.</span><span class="nc">ExecutionContextImpl$$anon$3</span><span class="o">.</span><span class="n">execute</span><span class="o">(</span><span class="nc">ExecutionContextImpl</span><span class="o">.</span><span class="n">scala</span><span class="k">:</span><span class="err">131</span><span class="o">)</span>
  <span class="n">at</span> <span class="n">scala</span><span class="o">.</span><span class="n">concurrent</span><span class="o">.</span><span class="n">impl</span><span class="o">.</span><span class="nc">ExecutionContextImpl</span><span class="o">.</span><span class="n">execute</span><span class="o">(</span><span class="nc">ExecutionContextImpl</span><span class="o">.</span><span class="n">scala</span><span class="k">:</span><span class="err">20</span><span class="o">)</span>
  <span class="n">at</span> <span class="o">.</span><span class="nc">$anonfun$timesTwo$1</span><span class="o">(&lt;</span><span class="n">pastie</span><span class="k">&gt;:</span><span class="mi">27</span><span class="o">)</span>
  <span class="n">at</span> <span class="o">.</span><span class="nc">$anonfun$timesTwo$1$adapted</span><span class="o">(&lt;</span><span class="n">pastie</span><span class="k">&gt;:</span><span class="mi">26</span><span class="o">)</span>
  <span class="n">at</span> <span class="o">.</span><span class="nc">$anonfun$mapBoth$1</span><span class="o">(&lt;</span><span class="n">pastie</span><span class="k">&gt;:</span><span class="mi">66</span><span class="o">)</span>
  <span class="n">at</span> <span class="o">.</span><span class="nc">$anonfun$mapBoth$1$adapted</span><span class="o">(&lt;</span><span class="n">pastie</span><span class="k">&gt;:</span><span class="mi">40</span><span class="o">)</span>
  <span class="n">at</span> <span class="o">.</span><span class="nc">$anonfun$mapBoth$1</span><span class="o">(&lt;</span><span class="n">pastie</span><span class="k">&gt;:</span><span class="mi">67</span><span class="o">)</span>
  <span class="n">at</span> <span class="o">.</span><span class="nc">$anonfun$mapBoth$1$adapted</span><span class="o">(&lt;</span><span class="n">pastie</span><span class="k">&gt;:</span><span class="mi">40</span><span class="o">)</span>
  <span class="n">at</span> <span class="o">.</span><span class="nc">$anonfun$mapBoth$1</span><span class="o">(&lt;</span><span class="n">pastie</span><span class="k">&gt;:</span><span class="mi">67</span><span class="o">)</span>
  <span class="n">at</span> <span class="o">.</span><span class="nc">$anonfun$mapBoth$1$adapted</span><span class="o">(&lt;</span><span class="n">pastie</span><span class="k">&gt;:</span><span class="mi">40</span><span class="o">)</span>
  <span class="n">at</span> <span class="o">.</span><span class="nc">$anonfun$mapBoth$1</span><span class="o">(&lt;</span><span class="n">pastie</span><span class="k">&gt;:</span><span class="mi">67</span><span class="o">)</span>
</code></pre></div>
<p>如为所说，<code>onFinish</code>作为一个没有*强制异步边界*的调用会引起栈溢出错误。在 Javascript 中可以通过调度<code>setTimeout</code>来解决，而 JVM 则需要一个线程池或 Scala 的<code>ExecutionContext</code>。</p>
<p>Are you feeling the fire yet? 🔥</p>
<h2 id="4-future-promise">4. Future &amp; Promise<a class="headerlink" href="#4-future-promise" title="Permanent link">&para;</a></h2>
<p><code>scala.concurrent.Future</code>描述了完整的异步求值计算，和我们上面用的<code>Async</code>有点类似。</p>
<blockquote>
<p>维基百科：Future 和 Promise 是在一些并发编程语言中用于异步程序执行的结构。它描述了一个对象，该对象看做是最初并不可知的结果的代理，通常因为该结果的值尚未计算完成。</p>
<p>作者的碎碎念：<code>docs.scala-lang.org</code>中关于 <a href="http://docs.scala-lang.org/overviews/core/futures.html">Futures and Promises</a>是这样说的，“Future 提供了一个以并行方式执行多个操作的方法 -更加高效、无阻塞的方式。 ”这种说法容易产生误解，一个混淆的源头。</p>
<p><code>Future</code>描述的是异步化而非并行化。当然，可以以并行的方式来使用，但并不意味者仅用作并行(async != Parallelism)，或适用于那些寻找充分利用 CPU 容量的人，使用<code>Future</code>可以证明是昂贵和不明智的，因为在有些场景它会出现性能问题，参考本部分的第四小节。</p>
</blockquote>
<p><code>Future</code>是一个定义了两种主要操作的接口，同时附带一些基于这些主要操作实现的组合子：</p>
<div class="highlight"><pre><span></span><code><span class="k">import</span> <span class="nn">scala.util.Try</span>
<span class="k">import</span> <span class="nn">scala.concurrent.ExecutionContext</span>

<span class="k">trait</span> <span class="nc">Future</span><span class="o">[</span><span class="kt">+T</span><span class="o">]</span> <span class="o">{</span>
  <span class="c1">// abstract</span>
  <span class="k">def</span> <span class="n">value</span><span class="k">:</span><span class="kt">Option</span><span class="o">[</span><span class="kt">Try</span><span class="o">[</span><span class="kt">T</span><span class="o">]]</span>

  <span class="c1">// abstract</span>
  <span class="k">def</span> <span class="n">onComplete</span><span class="o">(</span><span class="n">f</span><span class="k">:</span><span class="kt">Try</span><span class="o">[</span><span class="kt">T</span><span class="o">]</span> <span class="o">=&gt;</span> <span class="nc">Unit</span><span class="o">)(</span><span class="k">implicit</span> <span class="n">ec</span><span class="k">:</span><span class="kt">ExecutionContext</span><span class="o">)</span><span class="k">:</span><span class="kt">Unit</span>

  <span class="c1">// Transforms values</span>
  <span class="k">def</span> <span class="n">map</span><span class="o">[</span><span class="kt">U</span><span class="o">](</span><span class="n">f</span><span class="k">:</span> <span class="kt">T</span> <span class="o">=&gt;</span> <span class="n">U</span><span class="o">)(</span><span class="k">implicit</span> <span class="n">ec</span><span class="k">:</span><span class="kt">ExecutionContext</span><span class="o">)</span><span class="k">:</span><span class="kt">Future</span><span class="o">[</span><span class="kt">U</span><span class="o">]</span> <span class="o">=</span> <span class="o">???</span>
  <span class="c1">// Sequencing</span>
  <span class="k">def</span> <span class="n">flatMap</span><span class="o">[</span><span class="kt">U</span><span class="o">](</span><span class="n">f</span><span class="k">:</span> <span class="kt">T</span> <span class="o">=&gt;</span> <span class="nc">Future</span><span class="o">[</span><span class="kt">U</span><span class="o">])(</span><span class="k">implicit</span> <span class="n">ec</span><span class="k">:</span><span class="kt">ExecutionContext</span><span class="o">)</span><span class="k">:</span><span class="kt">Future</span><span class="o">[</span><span class="kt">U</span><span class="o">]</span> <span class="o">=</span> <span class="o">???</span>
<span class="o">}</span>
</code></pre></div>
<p><code>Future</code>的特性：</p>
<ul>
<li><a href="https://en.wikipedia.org/wiki/Eager_evaluation">Eagerly evaluated</a>(立即求值，strict and not lazy)，意味着一旦调用者收到一个<code>Future</code>引用，无论异步处理要完成的是什么，它都已经开始了；</li>
<li><a href="https://en.wikipedia.org/wiki/Memoization">Memoized</a>(记忆，cached)，因为会被*立即求值*，它的行为更像一个正常值而不是一个函数，同时最终的结果会对所有的监听者(listener)可用。<code>value</code>的目的是用于返回记忆结果或尚未完成时返回<code>None</code>。Goes 并未提到会返回一个不确定的值；</li>
<li>流经(stream)单个结果时它会显示，因为是记忆化起了作用。因此当监听者注册了完成时，他们最多会被调用一次。</li>
</ul>
<p><code>ExecutionContext</code>的解释性说明：</p>
<ul>
<li><code>ExecutionContext</code>管理异步执行，也可以把它视作一个线程池，但它并非必须是一个线程池(因为异步不等于多线程或并发)；</li>
<li><code>onComplete</code>和我们上面定义的<code>Async</code>类型一样，然而，它需要一个<code>ExecutionContext</code>，因为所有的完成时回调需要以异步的方式调用；</li>
<li>所有的组合子和工具类都基于<code>onComplete</code>实现，因此所有的组合子和工具类都要提供一个<code>ExecutionContext</code>参数。</li>
</ul>
<p>如果你不理解为什么这些签名都需要一个<code>ExecutionContext</code>，回到上面的“递归”部分，直到你完全理解了。</p>
<h3 id="41">4.1. 顺序化<a class="headerlink" href="#41" title="Permanent link">&para;</a></h3>
<p>让我们使用<code>Future</code>重新定义“回调地狱”部分的函数：</p>
<div class="highlight"><pre><span></span><code><span class="k">import</span> <span class="nn">scala.concurrent.</span><span class="o">{</span><span class="nc">Future</span><span class="o">,</span> <span class="nc">ExecutionContext</span><span class="o">}</span>

<span class="k">def</span> <span class="n">timesTwo</span><span class="o">(</span><span class="n">n</span><span class="k">:</span><span class="kt">Int</span><span class="o">)(</span><span class="k">implicit</span> <span class="n">ec</span><span class="k">:</span><span class="kt">ExecutionContext</span><span class="o">)</span><span class="k">:</span><span class="kt">Future</span><span class="o">[</span><span class="kt">Int</span><span class="o">]</span> <span class="o">=</span> <span class="nc">Future</span><span class="o">(</span><span class="n">n</span> <span class="o">*</span> <span class="mi">2</span><span class="o">)</span>

<span class="c1">// Usage</span>
<span class="o">{</span>
  <span class="k">import</span> <span class="nn">scala.concurrent.ExecutionContext.Implicits.global</span>
  <span class="n">timesTwo</span><span class="o">(</span><span class="mi">20</span><span class="o">).</span><span class="n">onComplete</span><span class="o">{</span> <span class="n">result</span> <span class="o">=&gt;</span> <span class="n">println</span><span class="o">(</span><span class="s">s&quot;Result: </span><span class="si">$result</span><span class="s">&quot;</span><span class="o">)}</span>
  <span class="c1">// =&gt; Result: Success(40)</span>
<span class="o">}</span>
</code></pre></div>
<p>足够简单，<code>Future.apply</code>创建器使用提供的<code>ExecutionContext</code>执行给出的计算。因此在 JVM 上，假设<code>global</code>执行上下文会运行在不同的线程上。</p>
<p>然后实现顺序化：</p>
<div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="n">timesFour</span><span class="o">(</span><span class="n">n</span><span class="k">:</span><span class="kt">Int</span><span class="o">)(</span><span class="k">implicit</span> <span class="n">ec</span><span class="k">:</span><span class="kt">ExecutionContext</span><span class="o">)</span><span class="k">:</span><span class="kt">Future</span><span class="o">[</span><span class="kt">Int</span><span class="o">]</span> <span class="o">=</span> 
  <span class="k">for</span><span class="o">{</span>
    <span class="n">a</span> <span class="o">&lt;-</span> <span class="n">timesTwo</span><span class="o">(</span><span class="n">n</span><span class="o">)</span>
    <span class="n">b</span> <span class="o">&lt;-</span> <span class="n">timesTwo</span><span class="o">(</span><span class="n">n</span><span class="o">)</span>
  <span class="o">}</span> <span class="k">yield</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span>

<span class="c1">// Usage</span>
<span class="o">{</span>
  <span class="k">import</span> <span class="nn">scala.concurrent.ExecutionContext.Implicits.global</span>
  <span class="n">timesFour</span><span class="o">(</span><span class="mi">20</span><span class="o">).</span><span class="n">onComplete</span> <span class="o">{</span><span class="n">result</span> <span class="o">=&gt;</span> <span class="n">println</span><span class="o">(</span><span class="s">s&quot;Result: </span><span class="si">$result</span><span class="s">&quot;</span><span class="o">)}</span>
  <span class="c1">// =&gt; Result: Success(80)</span>
<span class="o">}</span>
</code></pre></div>
<p>足够简单。这里的*for 表达式*魔法仅仅是会被转换为<code>flatMap</code>和<code>map</code>，在字面上等同于：</p>
<div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="n">timesFour</span><span class="o">(</span><span class="n">n</span><span class="k">:</span><span class="kt">Int</span><span class="o">)(</span><span class="k">implicit</span> <span class="n">ec</span><span class="k">:</span><span class="kt">ExecutionContext</span><span class="o">)</span><span class="k">:</span><span class="kt">Future</span><span class="o">[</span><span class="kt">Int</span><span class="o">]={</span>
  <span class="n">timesTwo</span><span class="o">(</span><span class="n">n</span><span class="o">).</span><span class="n">flatMap</span><span class="o">{</span> <span class="n">a</span><span class="o">=&gt;</span>
    <span class="n">timesTwo</span><span class="o">(</span><span class="n">n</span><span class="o">).</span><span class="n">map</span><span class="o">{</span> <span class="n">b</span><span class="o">=&gt;</span>
      <span class="n">a</span> <span class="o">+</span> <span class="n">b</span>
    <span class="o">}</span>
  <span class="o">}</span>
<span class="o">}</span>
</code></pre></div>
<p>如果你在项目中导入了<a href="https://github.com/scala/async">scala-async</a>，可以像下面这样实现：</p>
<div class="highlight"><pre><span></span><code><span class="k">import</span> <span class="nn">scala.async.Async.</span><span class="o">{</span><span class="n">async</span><span class="o">,</span> <span class="n">await</span><span class="o">}</span>

<span class="k">def</span> <span class="n">timesFour</span><span class="o">(</span><span class="n">n</span><span class="k">:</span><span class="kt">Int</span><span class="o">)(</span><span class="k">implicit</span> <span class="n">ec</span><span class="k">:</span><span class="kt">ExecutionContext</span><span class="o">)</span><span class="k">:</span><span class="kt">Future</span><span class="o">[</span><span class="kt">Int</span><span class="o">]={</span>
  <span class="n">async</span><span class="o">{</span>
    <span class="k">val</span> <span class="n">a</span> <span class="o">=</span> <span class="n">await</span><span class="o">(</span><span class="n">timesTwo</span><span class="o">(</span><span class="n">n</span><span class="o">))</span>
    <span class="k">val</span> <span class="n">b</span> <span class="o">=</span> <span class="n">await</span><span class="o">(</span><span class="n">timesTwo</span><span class="o">(</span><span class="n">n</span><span class="o">))</span>
    <span class="n">a</span> <span class="o">+</span> <span class="n">b</span>
  <span class="o">}</span>
<span class="o">}</span>
</code></pre></div>
<p>扩展库<code>scala-async</code>由 macros 驱动，并将你的代码转换为<code>flatMap</code>和<code>map</code>调用。因此，<code>await</code>并不会阻塞线程，尽管它带来了这种错觉。</p>
<p>这些看起来确实不错，不幸的是拥有很多限制。当你的<code>await</code>处于匿名函数之内时，库将无法“重写”你的代码，不幸的是 Scala 代码中到处都是这种表达式。这将不会工作：</p>
<div class="highlight"><pre><span></span><code><span class="c1">// BAD SAMPLE</span>
<span class="k">def</span> <span class="n">sum</span><span class="o">(</span><span class="n">list</span><span class="k">:</span><span class="kt">List</span><span class="o">[</span><span class="kt">Future</span><span class="o">[</span><span class="kt">Int</span><span class="o">]])(</span><span class="k">implicit</span> <span class="n">ec</span><span class="k">:</span><span class="kt">ExecutionContext</span><span class="o">)</span><span class="k">:</span><span class="kt">Future</span><span class="o">[</span><span class="kt">Int</span><span class="o">]</span> <span class="o">=</span> <span class="o">{</span>
  <span class="n">async</span><span class="o">{</span>
    <span class="k">var</span> <span class="n">sum</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="c1">// Nope, not going to work because &quot;for&quot; is translated to &quot;foreach&quot;</span>
    <span class="k">for</span><span class="o">(</span><span class="n">f</span> <span class="o">&lt;-</span> <span class="n">list</span><span class="o">){</span>
      <span class="n">sum</span> <span class="o">+=</span> <span class="n">await</span><span class="o">(</span><span class="n">f</span><span class="o">)</span>
    <span class="o">}</span>
  <span class="o">}</span>
<span class="o">}</span>
</code></pre></div>
<p>这种方式带来了拥有*first-class continuations*的幻觉，但是这种扩展并非一等类，仅仅是作为由编译器管理的重写代码。使得，这种约束在 C# 和 ECMAScript 中却应用的很好，因为<code>async</code>代码并不严重依赖于*函数式*。</p>
<p>还记得我前面的碎碎念中提到的*没有银弹*？</p>
<h3 id="42">4.2. 并行化<a class="headerlink" href="#42" title="Permanent link">&para;</a></h3>
<p>像先前的例子中展示的，这两个函数互相独立，因此我们可以并行调用他们。使用<code>Future</code>则会更加简单，尽管求值语义对于新手来说会有点迷惑：</p>
<div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="n">timesFourInParallel</span><span class="o">(</span><span class="n">n</span><span class="k">:</span><span class="kt">Int</span><span class="o">)(</span><span class="k">implicit</span> <span class="n">ec</span><span class="k">:</span><span class="kt">ExecutionContext</span><span class="o">)</span><span class="k">:</span><span class="kt">Future</span><span class="o">[</span><span class="kt">Int</span><span class="o">]</span> <span class="o">=</span> <span class="o">{</span>
  <span class="c1">// Future is eagerly evaluated, so this will trigger the</span>
  <span class="c1">// execution of both before the composition happens.</span>
  <span class="k">val</span> <span class="n">fa</span> <span class="o">=</span> <span class="n">timesTwo</span><span class="o">(</span><span class="n">n</span><span class="o">)</span>
  <span class="k">val</span> <span class="n">fb</span> <span class="o">=</span> <span class="n">timesTwo</span><span class="o">(</span><span class="n">n</span><span class="o">)</span>

  <span class="k">for</span><span class="o">{</span>
    <span class="n">a</span> <span class="o">&lt;-</span> <span class="n">fa</span>
    <span class="n">b</span> <span class="o">&lt;-</span> <span class="n">fb</span>
  <span class="o">}</span> <span class="k">yield</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span>
  <span class="c1">// fa.flatMap(a =&gt; fb.map(b =&gt; a + b))</span>
<span class="o">}</span>
</code></pre></div>
<p>这会有点迷惑，领新手措手不及。因为在这种执行模型中，为了以并行的方式执行，你需要在组合发生之前初始化这些<code>Future</code>引用。</p>
<p>一种可替代的方式是使用<code>Future.sequence</code>，可以用于任意集合：</p>
<div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="n">timesFourInParallel</span><span class="o">(</span><span class="n">n</span><span class="k">:</span><span class="kt">Int</span><span class="o">)(</span><span class="k">implicit</span> <span class="n">ec</span><span class="k">:</span><span class="kt">ExecutionContext</span><span class="o">)</span><span class="k">:</span><span class="kt">Future</span><span class="o">[</span><span class="kt">Int</span><span class="o">]</span> <span class="o">=</span> 
  <span class="nc">Future</span><span class="o">.</span><span class="n">sequence</span><span class="o">(</span><span class="n">timesTwo</span><span class="o">(</span><span class="n">n</span><span class="o">)</span> <span class="o">::</span> <span class="n">timesTwo</span><span class="o">(</span><span class="n">n</span><span class="o">)</span> <span class="o">::</span> <span class="nc">Nil</span><span class="o">).</span><span class="n">map</span><span class="o">(</span><span class="k">_</span><span class="o">.</span><span class="n">sum</span><span class="o">)</span>
</code></pre></div>
<p>这种用法估计也会让新手吃惊，因为这些<code>Future</code>仅会当传入<code>sequence</code>的集合是精确的时候才会以并行的方式执行，不像 Scala 的<code>Stream</code>或<code>Iterator</code>。显然这个名字是个误称。</p>
<h3 id="43">4.3. 递归<a class="headerlink" href="#43" title="Permanent link">&para;</a></h3>
<p><code>Future</code>类型对于递归操作是绝对安全的，因为信心在于执行回调的<code>ExecutionContext</code>。因此重试前面的例子：</p>
<div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="n">mapBoth</span><span class="o">[</span><span class="kt">A</span><span class="p">,</span><span class="kt">B</span><span class="p">,</span><span class="kt">R</span><span class="o">](</span><span class="n">fa</span><span class="k">:</span><span class="kt">Future</span><span class="o">[</span><span class="kt">A</span><span class="o">],</span> <span class="n">fb</span><span class="k">:</span><span class="kt">Future</span><span class="o">[</span><span class="kt">B</span><span class="o">])(</span><span class="n">f</span><span class="k">:</span><span class="o">(</span><span class="kt">A</span><span class="o">,</span><span class="kt">B</span><span class="o">)</span> <span class="o">=&gt;</span> <span class="n">R</span><span class="o">)(</span><span class="k">implicit</span> <span class="n">ec</span><span class="k">:</span><span class="kt">...</span><span class="o">)</span> <span class="o">=</span> <span class="o">{</span>
  <span class="k">for</span><span class="o">{</span>
    <span class="n">a</span> <span class="o">&lt;-</span> <span class="n">fa</span>
    <span class="n">b</span> <span class="o">&lt;-</span> <span class="n">fb</span>
  <span class="o">}</span> <span class="k">yield</span> <span class="n">f</span><span class="o">(</span><span class="n">a</span><span class="o">,</span><span class="n">b</span><span class="o">)</span>
<span class="o">}</span>

<span class="k">def</span> <span class="n">sequence</span><span class="o">[</span><span class="kt">A</span><span class="o">](</span><span class="n">list</span><span class="k">:</span><span class="kt">List</span><span class="o">[</span><span class="kt">Future</span><span class="o">[</span><span class="kt">A</span><span class="o">]])(</span><span class="k">implicit</span> <span class="n">ec</span><span class="k">:</span><span class="kt">...</span><span class="o">)</span><span class="k">:</span><span class="kt">Future</span><span class="o">[</span><span class="kt">List</span><span class="o">[</span><span class="kt">A</span><span class="o">]]</span> <span class="o">=</span> <span class="o">{</span>
  <span class="k">val</span> <span class="n">seed</span> <span class="o">=</span> <span class="nc">Future</span><span class="o">.</span><span class="n">successful</span><span class="o">(</span><span class="nc">List</span><span class="o">.</span><span class="n">empty</span><span class="o">[</span><span class="kt">A</span><span class="o">])</span>
  <span class="n">list</span><span class="o">.</span><span class="n">foldLeft</span><span class="o">(</span><span class="n">seed</span><span class="o">)((</span><span class="n">acc</span><span class="o">,</span><span class="n">f</span><span class="o">)</span> <span class="o">=&gt;</span> <span class="k">for</span><span class="o">(</span><span class="mi">1</span> <span class="o">&lt;-</span> <span class="n">accl</span><span class="o">;</span> <span class="n">a</span> <span class="o">&lt;-</span> <span class="n">f</span><span class="o">)</span> <span class="k">yield</span> <span class="n">a</span> <span class="o">::</span> <span class="n">l</span><span class="o">).</span><span class="n">map</span><span class="o">(</span><span class="k">_</span><span class="o">.</span><span class="n">reverse</span><span class="o">)</span>
<span class="o">}</span>

<span class="c1">// Invocation</span>
<span class="o">{</span>
  <span class="k">import</span> <span class="nn">scala.concurrent.ExecutionContext.Implicits.global</span>
  <span class="n">sequence</span><span class="o">(</span><span class="nc">List</span><span class="o">(</span><span class="n">timesTwo</span><span class="o">(</span><span class="mi">10</span><span class="o">),</span> <span class="n">timesTwo</span><span class="o">(</span><span class="mi">20</span><span class="o">),</span> <span class="n">times</span><span class="o">(</span><span class="mi">30</span><span class="o">))).</span><span class="n">foreach</span><span class="o">(</span><span class="n">println</span><span class="o">)</span>
  <span class="c1">// =&gt; List(20, 40, 60)</span>
<span class="o">}</span>
</code></pre></div>
<p>这次则不会出现<code>StackOverflowError</code>:</p>
<div class="highlight"><pre><span></span><code><span class="k">val</span> <span class="n">list</span> <span class="o">=</span> <span class="mf">0.</span><span class="n">until</span><span class="o">(</span><span class="mi">10000</span><span class="o">).</span><span class="n">map</span><span class="o">(</span><span class="n">timesTwo</span><span class="o">).</span><span class="n">toList</span>
<span class="n">sequence</span><span class="o">(</span><span class="n">list</span><span class="o">).</span><span class="n">foreach</span><span class="o">(</span><span class="n">r</span> <span class="o">=&gt;</span> <span class="n">println</span><span class="o">(</span><span class="s">s&quot;Sum: </span><span class="si">${</span><span class="n">r</span><span class="o">.</span><span class="n">sum</span><span class="si">}</span><span class="s">&quot;</span><span class="err">&quot;</span><span class="o">))</span>
</code></pre></div>
<h3 id="44">4.4. 性能代价<a class="headerlink" href="#44" title="Permanent link">&para;</a></h3>
<p><code>Future</code>的麻烦是每次调用<code>onComplete</code>都会使用一个<code>ExecutionContext</code>来执行，通常这意味着一个<code>Runnable</code>被发送到了线程池，像这样分支(fork)一个*逻辑线程*。如果你拥有 CPU 绑定的任务，这种实现细节对性能来说是一种灾难，因为跳跃的线程意味着 <a href="https://en.wikipedia.org/wiki/Context_switch">context switches</a>，同时会带来 CPU 的<a href="https://en.wikipedia.org/wiki/Locality_of_reference">cache locality</a>被摧毁。当然，该实现拥有确定性的优化，比如<code>flatMap</code>的实现中使用一个内部的蹦床形式的(trampolined?)执行上线文，为了避免在链接这些内部回调时进行分支，但是这还不够并且基准测试也不会说谎。</p>
<p>同时基于它的记忆化，在完成之上，实现会强制每个生产者执行一个<code>AtomicReference.compareAndSet</code>，在每个<code>Future</code>完成之前又会为每个注册的监听者加上一个<code>compareAndSet</code>。这些调用是十分昂贵的，所有这些都是为了记忆化以便在多个线程之间能够良好运行。</p>
<p>换句话说，如果你想让你的 CPU 绑定任务能够充分利用 CPU，这时使用<code>Future</code>和<code>Promise</code>不是一个好注意。</p>
<p>如果你想对比 Scala 的<code>Future</code>和<code>Task</code>实现，可以看一下相关<a href="https://github.com/rossabaker/benchmarks/pull/4">benchmark</a>:</p>
<div class="highlight"><pre><span></span><code>[info] Benchmark                   (size)   Mode  Cnt     Score     Error  Units
[info] FlatMap.fs2Apply             10000  thrpt   20   291.459 ±   6.321  ops/s
[info] FlatMap.fs2Delay             10000  thrpt   20  2606.864 ±  26.442  ops/s
[info] FlatMap.fs2Now               10000  thrpt   20  3867.300 ± 541.241  ops/s
[info] FlatMap.futureApply          10000  thrpt   20   212.691 ±   9.508  ops/s
[info] FlatMap.futureSuccessful     10000  thrpt   20   418.736 ±  29.121  ops/s
[info] FlatMap.futureTrampolineEc   10000  thrpt   20   423.647 ±   8.543  ops/s
[info] FlatMap.monixApply           10000  thrpt   20   399.916 ±  15.858  ops/s
[info] FlatMap.monixDelay           10000  thrpt   20  4994.156 ±  40.014  ops/s
[info] FlatMap.monixNow             10000  thrpt   20  6253.182 ±  53.388  ops/s
[info] FlatMap.scalazApply          10000  thrpt   20   188.387 ±   2.989  ops/s
[info] FlatMap.scalazDelay          10000  thrpt   20  1794.680 ±  24.173  ops/s
[info] FlatMap.scalazNow            10000  thrpt   20  2041.300 ± 128.729  ops/s
</code></pre></div>
<p>可以看到 <a href="https://monix.io/docs/2x/eval/task.html">Monix Task</a>在 CPU 绑定的任务上击败了<code>Future</code>。</p>
<blockquote>
<p>注意：这些基准测试是有局限的，仍然有一些用例中<code>Future</code>会更快(eg. Monix <a href="https://monix.io/docs/2x/reactive/observers.html">Observer</a>使用<code>Future</code>用做背压)并且性能通常并不相关，比如执行 I/O，即那些吞吐并非 CPU 绑定的场景。</p>
</blockquote>
<h2 id="5-taskscala-io-monad">5. Task，Scala 的 IO Monad<a class="headerlink" href="#5-taskscala-io-monad" title="Permanent link">&para;</a></h2>
<p><code>Task</code>是一种用于控制可惰性、可异步计算的数据类型，可用于控制副作用、避免非确定性和回调地狱。</p>
<p><a href="https://monix.io/">Monix</a> 库从 <a href="https://github.com/scalaz/scalaz/blob/scalaz-seven/concurrent/src/main/scala/scalaz/concurrent/Task.scala">Task in Scalaz</a> 获得灵感，提供了一种非常精致的 <a href="https://monix.io/docs/2x/eval/task.html">Task</a> 实现。相同的概念，但实现不同。</p>
<blockquote>
<p><code>Task</code>类型同样汲取了来自 <a href="https://wiki.haskell.org/IO_inside">Haskell's IO monad</a> 的灵感，而作者认为这是真正的 Scala <code>IO</code> 类型。</p>
<p>该问题存在争论，因为 Scalaz 同样暴漏了一个仅用于处理异步计算的<code>IO</code>类型。Scalaz 的 <code>IO</code>并非异步，这表示它的描述并不完整，因为在 JVM 之上你必须以某种方式表示异步计算。另一方面，在 Haskell 中的你拥有转换成<code>IO</code>类型的<code>Async</code>类型，或许这是由运行时管理的(green-threads and all)。</p>
<p>在 JVM 之上的 Scalaz 实现中，我们无法使用<code>IO</code>在求值过程中以不阻塞线程的方式来表达异步计算，这是要避免的，因为<a href="https://monix.io/docs/2x/best-practices/blocking.html">阻塞线程则意味着倾向于错误</a>。</p>
</blockquote>
<p>总的来说，<code>Task</code>类型：</p>
<ul>
<li>建模惰性、异步求值</li>
<li>建模一个生产者向一个或多个消费者仅发送一个值</li>
<li>它是惰性求值，因此对比<code>Future</code>它并不会触发执行，或在<code>runAsync</code>之前都不会有任何效果</li>
<li>不会被求值记忆化(memoized)，但是 Monix 的<code>Task</code>可以</li>
<li>无需再另一个逻辑线程执行</li>
</ul>
<p>而 Monix 中的实现拥有更多特别之处：</p>
<ul>
<li>允许取消一个运行中的计算</li>
<li>在其实现中永远不会阻塞任何线程</li>
<li>没有暴露任何可以阻塞线程的 API 调用</li>
<li>所有异步操作都是栈安全的(stack safe)</li>
</ul>
<p><code>Task</code>在设计上的可视化表示：</p>
<table>
<thead>
<tr>
<th></th>
<th>Eager</th>
<th>Lazy</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Synchronous</strong></td>
<td>A</td>
<td>() =&gt; A</td>
</tr>
<tr>
<td></td>
<td></td>
<td><a href="https://monix.io/docs/2x/eval/coeval.html">Coeval[A]</a>, <a href="https://github.com/scalaz/scalaz/blob/scalaz-seven/effect/src/main/scala/scalaz/effect/IO.scala">IO[A]</a></td>
</tr>
<tr>
<td><strong>Asynchronous</strong></td>
<td>(A =&gt; Unit) =&gt; Unit</td>
<td>(A =&gt; Unit) =&gt; Unit</td>
</tr>
<tr>
<td></td>
<td><code>Future[A]</code></td>
<td><a href="https://monix.io/docs/2x/eval/task.html">Task[A]</a></td>
</tr>
</tbody>
</table>
<h3 id="51">5.1. 顺序化<a class="headerlink" href="#51" title="Permanent link">&para;</a></h3>
<p>使用<code>Task</code>重新定义第三节中的函数：</p>
<div class="highlight"><pre><span></span><code><span class="k">import</span> <span class="nn">monix.eval.Task</span>

<span class="k">def</span> <span class="n">timesTwo</span><span class="o">(</span><span class="n">n</span><span class="k">:</span><span class="kt">Int</span><span class="o">)</span><span class="k">:</span><span class="kt">Task</span><span class="o">[</span><span class="kt">Int</span><span class="o">]</span> <span class="o">=</span> <span class="nc">Task</span><span class="o">(</span><span class="n">n</span> <span class="o">*</span> <span class="mi">2</span><span class="o">)</span>

<span class="c1">// Usage</span>
<span class="o">{</span>
  <span class="c1">// Our ExecutionContext needed on evaluation</span>
  <span class="k">import</span> <span class="nn">scala.concurrent.Scheduler.Implicits.global</span>

  <span class="n">timesTwo</span><span class="o">(</span><span class="mi">20</span><span class="o">).</span><span class="n">foreach</span><span class="o">{</span> <span class="n">result</span> <span class="o">=&gt;</span> <span class="n">println</span><span class="o">(</span><span class="s">s&quot;Result: </span><span class="si">$result</span><span class="s">&quot;</span><span class="o">)}</span>
  <span class="c1">// =&gt; Result: 40</span>
<span class="o">}</span>
</code></pre></div>
<p>代码看起来和第四节中<code>Future</code>的版本一样，唯一的区别是新的<code>timesTwo</code>函数不再接受<code>ExecutionContext</code>作为参数。这是因为<code>Task</code>引用是惰性的，和函数类似，因此在调用强制求值发生的<code>foreach</code>之前什么都不会打印。我们需要的是一个 <a href="https://monix.io/docs/2x/execution/scheduler.html">Scheduler</a>，这是 Monix 中增强的<code>ExecutionContext</code>。</p>
<p>现在实现 3.1 节中的顺序化：</p>
<div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="n">timesFour</span><span class="o">(</span><span class="n">n</span><span class="k">:</span><span class="kt">Int</span><span class="o">)</span><span class="k">:</span><span class="kt">Task</span><span class="o">[</span><span class="kt">Int</span><span class="o">]</span> <span class="o">=</span> <span class="o">{</span>
  <span class="k">for</span><span class="o">{</span>
    <span class="n">a</span> <span class="o">&lt;-</span> <span class="n">timesTwo</span><span class="o">(</span><span class="n">n</span><span class="o">)</span>
    <span class="n">b</span> <span class="o">&lt;-</span> <span class="n">timesTwo</span><span class="o">(</span><span class="n">n</span><span class="o">)</span>
  <span class="o">}</span> <span class="k">yield</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span>
<span class="o">}</span>

<span class="c1">// Usage</span>
<span class="o">{</span>
  <span class="k">import</span> <span class="nn">scala.concurrent.Scheduler.Implicits.global</span>

  <span class="n">timesFour</span><span class="o">(</span><span class="mi">20</span><span class="o">).</span><span class="n">foreach</span><span class="o">{</span> <span class="n">result</span> <span class="o">=&gt;</span> <span class="n">println</span><span class="o">(</span><span class="s">s&quot;Result: </span><span class="si">$result</span><span class="s">&quot;</span><span class="o">)}</span>
  <span class="c1">// =&gt; Result: 80</span>
<span class="o">}</span>
</code></pre></div>
<p>同样是和<code>Future</code>类型一样，*for 表达式*魔法仍然是被 Scala 编译器转换成<code>flatMap</code>和<code>map</code>调用，字面值等同于：</p>
<div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="n">timesFour</span><span class="o">(</span><span class="n">n</span><span class="k">:</span><span class="kt">Int</span><span class="o">)</span><span class="k">:</span><span class="kt">Task</span><span class="o">[</span><span class="kt">Int</span><span class="o">]</span> <span class="o">=</span> <span class="o">{</span>
  <span class="n">timesTwo</span><span class="o">(</span><span class="n">n</span><span class="o">).</span><span class="n">flatMap</span><span class="o">{</span> <span class="n">a</span><span class="o">=&gt;</span>
    <span class="n">timesTwo</span><span class="o">(</span><span class="n">n</span><span class="o">).</span><span class="n">map</span><span class="o">{</span> <span class="n">b</span><span class="o">=&gt;</span>
      <span class="n">a</span> <span class="o">+</span> <span class="n">b</span>
    <span class="o">}</span>
  <span class="o">}</span>
<span class="o">}</span>
</code></pre></div>
<h3 id="52">5.2. 并行化<a class="headerlink" href="#52" title="Permanent link">&para;</a></h3>
<p><code>Task</code>的并行化比<code>Future</code>要好的多，因为<code>Task</code>在分支 task 时支持细粒度控制，当在当前线程和调用栈执行转换(eg. map/flatMap)时，局域性的缓存保留和避免上下文切换则等同于顺序执行。</p>
<p>但是首先，转换成<code>Future</code>的形式并不能正常工作：</p>
<div class="highlight"><pre><span></span><code><span class="c1">// BAD SAMPLE, 为了达成并行，这实质上会是顺序化</span>
<span class="k">def</span> <span class="n">timesFour</span><span class="o">(</span><span class="n">n</span><span class="k">:</span><span class="kt">Int</span><span class="o">)</span><span class="k">:</span><span class="kt">Task</span><span class="o">[</span><span class="kt">Int</span><span class="o">]</span> <span class="o">=</span> <span class="o">{</span>
  <span class="c1">// 并不会触发执行，因为 Task 是惰性的</span>
  <span class="k">val</span> <span class="n">fa</span> <span class="o">=</span> <span class="n">timesTwo</span><span class="o">(</span><span class="n">n</span><span class="o">)</span>
  <span class="k">val</span> <span class="n">fb</span> <span class="o">=</span> <span class="n">timesTwo</span><span class="o">(</span><span class="n">n</span><span class="o">)</span>
  <span class="c1">// 因为惰性的缘故求值会是顺序化</span>
  <span class="k">for</span><span class="o">{</span>
    <span class="n">a</span> <span class="o">&lt;-</span> <span class="n">fa</span>
    <span class="n">b</span> <span class="o">&lt;-</span> <span class="n">fb</span>
  <span class="o">}</span> <span class="k">yield</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span>
<span class="o">}</span>
</code></pre></div>
<p>想要达到并行化，必须显示指定：</p>
<div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="n">timesFour</span><span class="o">(</span><span class="n">n</span><span class="k">:</span><span class="kt">Int</span><span class="o">)</span><span class="k">:</span><span class="kt">Task</span><span class="o">[</span><span class="kt">Int</span><span class="o">]</span> <span class="o">=</span> 
  <span class="nc">Task</span><span class="o">.</span><span class="n">mapBoth</span><span class="o">(</span><span class="n">timesTwo</span><span class="o">(</span><span class="n">n</span><span class="o">),</span> <span class="n">timesTwo</span><span class="o">(</span><span class="n">n</span><span class="o">))(</span><span class="k">_</span> <span class="o">+</span> <span class="k">_</span><span class="o">)</span>
</code></pre></div>
<p>是不是<code>mapBoth</code>看起来很熟悉？如果这两个任务在执行时分支线程，<code>mapBoth</code>会同时启动两者，从而达到并行化。</p>
<h3 id="53">5.3. 递归<a class="headerlink" href="#53" title="Permanent link">&para;</a></h3>
<p><code>Task</code>支持递归，栈安全且十分有效，这是基于其内部的 trampoline。你可以查看这篇 Rúnar Bjarnason 的论文 <a href="http://blog.higher-order.com/assets/trampolines.pdf">Stackless Scala with Free Monads</a> 来了解其为何如此有效。</p>
<p>其<code>sequence</code>实现与<code>Future</code>非常相似，只不过你会在<code>sequence</code>的签名中发现其惰性化：</p>
<div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="n">sequence</span><span class="o">[</span><span class="kt">A</span><span class="o">](</span><span class="n">list</span><span class="k">:</span><span class="kt">List</span><span class="o">[</span><span class="kt">Task</span><span class="o">[</span><span class="kt">A</span><span class="o">]])</span><span class="k">:</span> <span class="kt">Task</span><span class="o">[</span><span class="kt">List</span><span class="o">[</span><span class="kt">A</span><span class="o">]]</span> <span class="o">=</span> <span class="o">{</span>
  <span class="k">val</span> <span class="n">seed</span> <span class="o">=</span> <span class="nc">Task</span><span class="o">.</span><span class="n">now</span><span class="o">(</span><span class="nc">List</span><span class="o">.</span><span class="n">empty</span><span class="o">[</span><span class="kt">A</span><span class="o">])</span>
  <span class="n">list</span><span class="o">.</span><span class="n">foldLeft</span><span class="o">(</span><span class="n">seed</span><span class="o">)((</span><span class="n">acc</span><span class="o">,</span> <span class="n">f</span><span class="o">)</span> <span class="o">=&gt;</span> <span class="k">for</span><span class="o">{</span>
    <span class="n">l</span> <span class="o">&lt;-</span> <span class="n">acc</span>
    <span class="n">a</span> <span class="o">&lt;-</span> <span class="n">f</span>
  <span class="o">}</span> <span class="k">yield</span> <span class="n">a</span> <span class="o">::</span> <span class="n">l</span><span class="o">).</span><span class="n">map</span><span class="o">(</span><span class="k">_</span><span class="o">.</span><span class="n">reverse</span><span class="o">)</span>
<span class="o">}</span>

<span class="c1">// Invocation</span>
<span class="o">{</span>
  <span class="k">import</span> <span class="nn">monix.execution.Scheduler.Implicits.global</span>

  <span class="n">sequence</span><span class="o">(</span><span class="nc">List</span><span class="o">(</span><span class="n">timesTwo</span><span class="o">(</span><span class="mi">10</span><span class="o">),</span> <span class="n">timesTwo</span><span class="o">(</span><span class="mi">20</span><span class="o">),</span> <span class="n">timesTwo</span><span class="o">(</span><span class="mi">30</span><span class="o">))).</span><span class="n">foreach</span><span class="o">(</span><span class="n">println</span><span class="o">)</span>
  <span class="c1">// =&gt; List(20, 40, 60)</span>
<span class="o">}</span>
</code></pre></div>
<h2 id="6-type-class">6. 函数式编程和 Type-class<a class="headerlink" href="#6-type-class" title="Permanent link">&para;</a></h2>
<p>当你使用这些众所周知的函数时，比如：<code>map</code>，<code>flatMap</code>和<code>mapBoth</code>，我们不再关心这一切的背后是一个<code>(A =&gt; Unit) =&gt; Unit</code>，因为这些函数会假设为合法、纯净、透明的。这意味着我们可以脱离其上下文来推导它们的结果。</p>
<p>这是 Haskell 中<code>IO</code>的伟大成就。Haskell 不会“伪造(fake)”副作用，因为返回<code>IO</code>函数字面意义上是纯的，副作用会被推迟到其所属程序的边缘。我们可以同样看待<code>Task</code>。不过，对于<code>Future</code>急切的本性(立即计算)来说会更加复杂，但是使用<code>Future</code>也不是一个坏的选择。</p>
<p>那么我们能够基于这些类型，比如<code>Task</code>、<code>Future</code>、<code>Coeval</code>、<code>Eval</code>、<code>IO</code>、<code>Id</code>、<code>Observable</code>或者一些其他的类型，来创建接口或抽象吗？</p>
<p>当然我们可以，我们已经见过使用<code>flatMap</code>来描述顺序化，使用<code>mapBoth</code>来描述并行化。但是我们不能使用经典的 OOP 来描述他们，其中一个原因是<code>Functional</code>参数的协变和逆变规则，这会导致我们在<code>flatMap</code>中失去类型信息(除非你使用 F-bounded 泛型类型，这样更适合实现复用或其他 OOP 语言不可用时)，同时我们要描述一个数据构造器，他不能是一个方法(比如 OOP 的子类应用到实例而不是整个类)。</p>
<p>幸运的是，Scala 是极少数支持高阶类型且能够编码类型类(type-class)的语言，这意味着我们拥有了从 Haskell 端口概念所需要的一切。</p>
<blockquote>
<p>作者的碎碎念：<code>Monad</code>，<code>Applicative</code>，<code>Functor</code>，这些可怕的单词让那些并不忠实的人心生畏惧，导致他们认为关注的是一些与现实世界脱轨的“学术”概念，书籍作者要避免大量使用这些单词，包括 Scala 的 API 文档及官方教程。</p>
<p>但这是给 Scala 和其用户帮倒忙。其他语言中仅有的设计模式主要是难于解释，因为这些不能用类型来表示。你可以用一只手输出拥有这种表达能力的语言。而用户痛苦的是当他们遇到麻烦时不知如何从现有的文献中搜索相关主题，缺失对正确术语的学习。</p>
<p>我也觉得这是一味地反智主义(<a href="https://en.wikipedia.org/wiki/Anti-intellectualism">anti-intellectualism</a>)，向往常一样对无知的恐惧。你可以发现这些都来自真正做他们的人，但我们无一幸免。比如 Java 中的<code>Optional</code>类型违反了 Functor 的规则(e.g. <code>opt.map(f).map(g) != opt.map(f andThen g)</code>)，Swift 中愚蠢的 <code>5 == Some(5)</code>，可以幸运的向人们解释<code>Some(null)</code>实际上与<code>null</code>的意义相同，是<code>AnyRef</code>的有效值，因为不然的话你不能定义一个<code>Applicative[Option]</code>。</p>
</blockquote>
<h3 id="61-monad">6.1.  Monad(顺序化和递归)<a class="headerlink" href="#61-monad" title="Permanent link">&para;</a></h3>
<p>本文并不会解释 Monad。另外有一篇文章来专门解释它。但如果你想建立一个直觉，这里有另外一个：在数据类型的上下文中，比如<code>Future</code>或<code>Task</code>，Monads 用于描述操作的顺序，并且是保证顺序的唯一有效方法。</p>
<blockquote>
<p>"<em>Observation: programmers doing concurrency with imperative languages are tripped by the unchallenged belief that ";" defines sequencing.</em>" – <a href="https://twitter.com/shipilev/status/822004316605206529">Aleksey Shipilëv</a></p>
</blockquote>
<p>Scala 中一个简单的编码<code>Monad</code>的例子：</p>
<div class="highlight"><pre><span></span><code><span class="c1">// we shouldn&#39;t need to do this</span>
<span class="k">import</span> <span class="nn">scala.language.higherKinds</span>

<span class="k">trait</span> <span class="nc">Monad</span><span class="o">[</span><span class="kt">F</span><span class="o">[</span><span class="k">_</span><span class="o">]]{</span>
  <span class="cm">/** Constructor (said to lift a value `A` in the `F[A]`</span>
<span class="cm">    * monadic context). Also part of `Applicative`, see below.</span>
<span class="cm">    */</span>
  <span class="k">def</span> <span class="n">pure</span><span class="o">[</span><span class="kt">A</span><span class="o">](</span><span class="n">a</span><span class="k">:</span> <span class="kt">A</span><span class="o">)</span><span class="k">:</span> <span class="kt">F</span><span class="o">[</span><span class="kt">A</span><span class="o">]</span>

  <span class="cm">/** FTW */</span>
  <span class="k">def</span> <span class="n">flatMap</span><span class="o">[</span><span class="kt">A</span><span class="p">,</span><span class="kt">B</span><span class="o">](</span><span class="n">fa</span><span class="k">:</span> <span class="kt">F</span><span class="o">[</span><span class="kt">A</span><span class="o">])(</span><span class="n">f</span><span class="k">:</span> <span class="kt">A</span> <span class="o">=&gt;</span> <span class="n">F</span><span class="o">[</span><span class="kt">B</span><span class="o">])</span><span class="k">:</span> <span class="kt">F</span><span class="o">[</span><span class="kt">B</span><span class="o">]</span>
<span class="o">}</span>
</code></pre></div>
<p>同时提供一个<code>Future</code>实现：</p>
<div class="highlight"><pre><span></span><code><span class="k">import</span> <span class="nn">scala.concurrent._</span>

<span class="c1">// Supplying an instance for Future isn&#39;t clean, ExecutionContext needed</span>
<span class="k">class</span> <span class="nc">FutureMonad</span><span class="o">(</span><span class="k">implicit</span> <span class="n">ec</span><span class="k">:</span> <span class="kt">ExecutionContext</span><span class="o">)</span>
  <span class="k">extends</span> <span class="nc">Monad</span><span class="o">[</span><span class="kt">Future</span><span class="o">]</span> <span class="o">{</span>

  <span class="k">def</span> <span class="n">pure</span><span class="o">[</span><span class="kt">A</span><span class="o">](</span><span class="n">a</span><span class="k">:</span> <span class="kt">A</span><span class="o">)</span><span class="k">:</span> <span class="kt">Future</span><span class="o">[</span><span class="kt">A</span><span class="o">]</span> <span class="o">=</span>
    <span class="nc">Future</span><span class="o">.</span><span class="n">successful</span><span class="o">(</span><span class="n">a</span><span class="o">)</span>

  <span class="k">def</span> <span class="n">flatMap</span><span class="o">[</span><span class="kt">A</span><span class="p">,</span><span class="kt">B</span><span class="o">](</span><span class="n">fa</span><span class="k">:</span> <span class="kt">Future</span><span class="o">[</span><span class="kt">A</span><span class="o">])(</span><span class="n">f</span><span class="k">:</span> <span class="kt">A</span> <span class="o">=&gt;</span> <span class="nc">Future</span><span class="o">[</span><span class="kt">B</span><span class="o">])</span><span class="k">:</span> <span class="kt">Future</span><span class="o">[</span><span class="kt">B</span><span class="o">]</span> <span class="o">=</span>
    <span class="n">fa</span><span class="o">.</span><span class="n">flatMap</span><span class="o">(</span><span class="n">f</span><span class="o">)</span>
<span class="o">}</span>

<span class="k">object</span> <span class="nc">FutureMonad</span> <span class="o">{</span>
  <span class="k">implicit</span> <span class="k">def</span> <span class="n">instance</span><span class="o">(</span><span class="k">implicit</span> <span class="n">ec</span><span class="k">:</span> <span class="kt">ExecutionContext</span><span class="o">)</span><span class="k">:</span> <span class="kt">FutureMonad</span> <span class="o">=</span>
    <span class="k">new</span> <span class="nc">FutureMonad</span>
<span class="o">}</span>
</code></pre></div>
<p>这真是一个强力的东西。现在我们可以描述一个用于<code>Task</code>、<code>Future</code>、<code>IO</code>的泛型函数，无论如何，如果<code>flatMap</code>是栈安全的话这将非常伟大：</p>
<div class="highlight"><pre><span></span><code><span class="cm">/** Calculates the N-th number in a Fibonacci series. */</span>
<span class="k">def</span> <span class="n">fib</span><span class="o">[</span><span class="kt">F</span><span class="o">[</span><span class="k">_</span><span class="o">]](</span><span class="n">n</span><span class="k">:</span> <span class="kt">Int</span><span class="o">)(</span><span class="k">implicit</span> <span class="n">F</span><span class="k">:</span> <span class="kt">Monad</span><span class="o">[</span><span class="kt">F</span><span class="o">])</span><span class="k">:</span> <span class="kt">F</span><span class="o">[</span><span class="kt">BigInt</span><span class="o">]</span> <span class="o">=</span> <span class="o">{</span>
  <span class="k">def</span> <span class="n">loop</span><span class="o">(</span><span class="n">n</span><span class="k">:</span> <span class="kt">Int</span><span class="o">,</span> <span class="n">a</span><span class="k">:</span> <span class="kt">BigInt</span><span class="o">,</span> <span class="n">b</span><span class="k">:</span> <span class="kt">BigInt</span><span class="o">)</span><span class="k">:</span> <span class="kt">F</span><span class="o">[</span><span class="kt">BigInt</span><span class="o">]</span> <span class="o">=</span>
    <span class="n">F</span><span class="o">.</span><span class="n">flatMap</span><span class="o">(</span><span class="n">F</span><span class="o">.</span><span class="n">pure</span><span class="o">(</span><span class="n">n</span><span class="o">))</span> <span class="o">{</span> <span class="n">n</span> <span class="o">=&gt;</span>
      <span class="k">if</span> <span class="o">(</span><span class="n">n</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="o">)</span> <span class="n">F</span><span class="o">.</span><span class="n">pure</span><span class="o">(</span><span class="n">b</span><span class="o">)</span>
      <span class="k">else</span> <span class="n">loop</span><span class="o">(</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="o">,</span> <span class="n">b</span><span class="o">,</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span><span class="o">)</span>
    <span class="o">}</span>

  <span class="n">loop</span><span class="o">(</span><span class="n">n</span><span class="o">,</span> <span class="nc">BigInt</span><span class="o">(</span><span class="mi">0</span><span class="o">),</span> <span class="nc">BigInt</span><span class="o">(</span><span class="mi">1</span><span class="o">))</span>
<span class="o">}</span>

<span class="c1">// Usage:</span>
<span class="o">{</span>
  <span class="c1">// Needed in scope</span>
  <span class="k">import</span> <span class="nn">FutureMonad.instance</span>
  <span class="k">import</span> <span class="nn">scala.concurrent.ExecutionContext.Implicits.global</span>

  <span class="c1">// Invocation</span>
  <span class="n">fib</span><span class="o">[</span><span class="kt">Future</span><span class="o">](</span><span class="mi">40</span><span class="o">).</span><span class="n">foreach</span><span class="o">(</span><span class="n">r</span> <span class="o">=&gt;</span> <span class="n">println</span><span class="o">(</span><span class="s">s&quot;Result: </span><span class="si">$r</span><span class="s">&quot;</span><span class="o">))</span>
  <span class="c1">//=&gt; Result: 102334155</span>
<span class="o">}</span>
</code></pre></div>
<blockquote>
<p>注意：这只是一个玩具样例，严肃的实现参考 <a href="http://typelevel.org/cats/">Typelevel's Cats</a>。</p>
</blockquote>
<h3 id="62-applicative">6.2. Applicative(并行化)<a class="headerlink" href="#62-applicative" title="Permanent link">&para;</a></h3>
<p>Monad 定义了操作的顺序化，但是有时我们想组合那些互不依赖的计算的结果，他们可以同时求值，或者并行化。还有一个例子可以证明 Applicative 比 Monad 更加可组合。</p>
<p>现在扩展我们的*Typeclassopedia*:</p>
<div class="highlight"><pre><span></span><code><span class="k">trait</span> <span class="nc">Functor</span><span class="o">[</span><span class="kt">F</span><span class="o">[</span><span class="k">_</span><span class="o">]]</span> <span class="o">{</span>
  <span class="cm">/** I hope we are all familiar with this one. */</span>
  <span class="k">def</span> <span class="n">map</span><span class="o">[</span><span class="kt">A</span><span class="p">,</span><span class="kt">B</span><span class="o">](</span><span class="n">fa</span><span class="k">:</span> <span class="kt">F</span><span class="o">[</span><span class="kt">A</span><span class="o">])(</span><span class="n">f</span><span class="k">:</span> <span class="kt">A</span> <span class="o">=&gt;</span> <span class="n">B</span><span class="o">)</span><span class="k">:</span> <span class="kt">F</span><span class="o">[</span><span class="kt">B</span><span class="o">]</span>
<span class="o">}</span>

<span class="k">trait</span> <span class="nc">Applicative</span><span class="o">[</span><span class="kt">F</span><span class="o">[</span><span class="k">_</span><span class="o">]]</span> <span class="k">extends</span> <span class="nc">Functor</span><span class="o">[</span><span class="kt">F</span><span class="o">]</span> <span class="o">{</span>
  <span class="cm">/** Constructor (lifts a value `A` in the `F[A]` applicative context). */</span>
  <span class="k">def</span> <span class="n">pure</span><span class="o">[</span><span class="kt">A</span><span class="o">](</span><span class="n">a</span><span class="k">:</span> <span class="kt">A</span><span class="o">)</span><span class="k">:</span> <span class="kt">F</span><span class="o">[</span><span class="kt">A</span><span class="o">]</span>

  <span class="cm">/** Maps over two references at the same time.</span>
<span class="cm">    *</span>
<span class="cm">    * In other implementations the applicative operation is `ap`,</span>
<span class="cm">    * but `map2` is easier to understand.</span>
<span class="cm">    */</span>
  <span class="k">def</span> <span class="n">map2</span><span class="o">[</span><span class="kt">A</span><span class="p">,</span><span class="kt">B</span><span class="p">,</span><span class="kt">R</span><span class="o">](</span><span class="n">fa</span><span class="k">:</span> <span class="kt">F</span><span class="o">[</span><span class="kt">A</span><span class="o">],</span> <span class="n">fb</span><span class="k">:</span> <span class="kt">F</span><span class="o">[</span><span class="kt">B</span><span class="o">])(</span><span class="n">f</span><span class="k">:</span> <span class="o">(</span><span class="kt">A</span><span class="o">,</span><span class="kt">B</span><span class="o">)</span> <span class="o">=&gt;</span> <span class="n">R</span><span class="o">)</span><span class="k">:</span> <span class="kt">F</span><span class="o">[</span><span class="kt">R</span><span class="o">]</span>
<span class="o">}</span>

<span class="k">trait</span> <span class="nc">Monad</span><span class="o">[</span><span class="kt">F</span><span class="o">[</span><span class="k">_</span><span class="o">]]</span> <span class="k">extends</span> <span class="nc">Applicative</span><span class="o">[</span><span class="kt">F</span><span class="o">]</span> <span class="o">{</span>
  <span class="k">def</span> <span class="n">flatMap</span><span class="o">[</span><span class="kt">A</span><span class="p">,</span><span class="kt">B</span><span class="o">](</span><span class="n">fa</span><span class="k">:</span> <span class="kt">F</span><span class="o">[</span><span class="kt">A</span><span class="o">])(</span><span class="n">f</span><span class="k">:</span> <span class="kt">A</span> <span class="o">=&gt;</span> <span class="n">F</span><span class="o">[</span><span class="kt">B</span><span class="o">])</span><span class="k">:</span> <span class="kt">F</span><span class="o">[</span><span class="kt">B</span><span class="o">]</span>
<span class="o">}</span>
</code></pre></div>
<p>然后扩展我们的<code>Future</code>实现：</p>
<div class="highlight"><pre><span></span><code><span class="c1">// Supplying an instance for Future isn&#39;t clean, ExecutionContext needed</span>
<span class="k">class</span> <span class="nc">FutureMonad</span><span class="o">(</span><span class="k">implicit</span> <span class="n">ec</span><span class="k">:</span> <span class="kt">ExecutionContext</span><span class="o">)</span>
  <span class="k">extends</span> <span class="nc">Monad</span><span class="o">[</span><span class="kt">Future</span><span class="o">]</span> <span class="o">{</span>

  <span class="k">def</span> <span class="n">pure</span><span class="o">[</span><span class="kt">A</span><span class="o">](</span><span class="n">a</span><span class="k">:</span> <span class="kt">A</span><span class="o">)</span><span class="k">:</span> <span class="kt">Future</span><span class="o">[</span><span class="kt">A</span><span class="o">]</span> <span class="o">=</span>
    <span class="nc">Future</span><span class="o">.</span><span class="n">successful</span><span class="o">(</span><span class="n">a</span><span class="o">)</span>

  <span class="k">def</span> <span class="n">flatMap</span><span class="o">[</span><span class="kt">A</span><span class="p">,</span><span class="kt">B</span><span class="o">](</span><span class="n">fa</span><span class="k">:</span> <span class="kt">Future</span><span class="o">[</span><span class="kt">A</span><span class="o">])(</span><span class="n">f</span><span class="k">:</span> <span class="kt">A</span> <span class="o">=&gt;</span> <span class="nc">Future</span><span class="o">[</span><span class="kt">B</span><span class="o">])</span><span class="k">:</span> <span class="kt">Future</span><span class="o">[</span><span class="kt">B</span><span class="o">]</span> <span class="o">=</span>
    <span class="n">fa</span><span class="o">.</span><span class="n">flatMap</span><span class="o">(</span><span class="n">f</span><span class="o">)</span>

  <span class="k">def</span> <span class="n">map2</span><span class="o">[</span><span class="kt">A</span><span class="p">,</span><span class="kt">B</span><span class="p">,</span><span class="kt">R</span><span class="o">](</span><span class="n">fa</span><span class="k">:</span> <span class="kt">Future</span><span class="o">[</span><span class="kt">A</span><span class="o">],</span> <span class="n">fb</span><span class="k">:</span> <span class="kt">Future</span><span class="o">[</span><span class="kt">B</span><span class="o">])(</span><span class="n">f</span><span class="k">:</span> <span class="o">(</span><span class="kt">A</span><span class="o">,</span><span class="kt">B</span><span class="o">)</span> <span class="o">=&gt;</span> <span class="n">R</span><span class="o">)</span><span class="k">:</span> <span class="kt">Future</span><span class="o">[</span><span class="kt">R</span><span class="o">]</span> <span class="o">=</span>
    <span class="c1">// For Future there&#39;s no point in supplying an implementation that&#39;s</span>
    <span class="c1">// not based on flatMap, but that&#39;s not the case for Task ;-)</span>
    <span class="k">for</span> <span class="o">(</span><span class="n">a</span> <span class="o">&lt;-</span> <span class="n">fa</span><span class="o">;</span> <span class="n">b</span> <span class="o">&lt;-</span> <span class="n">fb</span><span class="o">)</span> <span class="k">yield</span> <span class="n">f</span><span class="o">(</span><span class="n">a</span><span class="o">,</span><span class="n">b</span><span class="o">)</span>
<span class="o">}</span>

<span class="k">object</span> <span class="nc">FutureMonad</span> <span class="o">{</span>
  <span class="k">implicit</span> <span class="k">def</span> <span class="n">instance</span><span class="o">(</span><span class="k">implicit</span> <span class="n">ec</span><span class="k">:</span> <span class="kt">ExecutionContext</span><span class="o">)</span><span class="k">:</span> <span class="kt">FutureMonad</span> <span class="o">=</span>
    <span class="k">new</span> <span class="nc">FutureMonad</span>
<span class="o">}</span>
</code></pre></div>
<p>现在可以基于<code>Applicative</code>定义泛型函数并用于<code>Future</code>：</p>
<div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="n">sequence</span><span class="o">[</span><span class="kt">F</span><span class="o">[</span><span class="k">_</span><span class="o">]</span><span class="p">,</span> <span class="kt">A</span><span class="o">](</span><span class="n">list</span><span class="k">:</span> <span class="kt">List</span><span class="o">[</span><span class="kt">F</span><span class="o">[</span><span class="kt">A</span><span class="o">]])</span>
  <span class="o">(</span><span class="k">implicit</span> <span class="n">F</span><span class="k">:</span> <span class="kt">Applicative</span><span class="o">[</span><span class="kt">F</span><span class="o">])</span><span class="k">:</span> <span class="kt">F</span><span class="o">[</span><span class="kt">List</span><span class="o">[</span><span class="kt">A</span><span class="o">]]</span> <span class="o">=</span> <span class="o">{</span>

  <span class="k">val</span> <span class="n">seed</span> <span class="o">=</span> <span class="n">F</span><span class="o">.</span><span class="n">pure</span><span class="o">(</span><span class="nc">List</span><span class="o">.</span><span class="n">empty</span><span class="o">[</span><span class="kt">A</span><span class="o">])</span>
  <span class="k">val</span> <span class="n">r</span> <span class="o">=</span> <span class="n">list</span><span class="o">.</span><span class="n">foldLeft</span><span class="o">(</span><span class="n">seed</span><span class="o">)((</span><span class="n">acc</span><span class="o">,</span><span class="n">e</span><span class="o">)</span> <span class="o">=&gt;</span> <span class="n">F</span><span class="o">.</span><span class="n">map2</span><span class="o">(</span><span class="n">acc</span><span class="o">,</span><span class="n">e</span><span class="o">)((</span><span class="n">l</span><span class="o">,</span><span class="n">a</span><span class="o">)</span> <span class="o">=&gt;</span> <span class="n">a</span> <span class="o">::</span> <span class="n">l</span><span class="o">))</span>
  <span class="n">F</span><span class="o">.</span><span class="n">map</span><span class="o">(</span><span class="n">r</span><span class="o">)(</span><span class="k">_</span><span class="o">.</span><span class="n">reverse</span><span class="o">)</span>
<span class="o">}</span>
</code></pre></div>
<blockquote>
<p>注意：同样是一个玩具样例，参考<a href="http://typelevel.org/cats/">Typelevel's Cats</a>。</p>
</blockquote>
<h3 id="63">6.3. 为异步求值定义类型类？<a class="headerlink" href="#63" title="Permanent link">&para;</a></h3>
<p>上面的部分缺少的是真正触发计算并获得结果值。思考 Scala 的<code>Future</code>，我们想要一种方式来抽象<code>onComplete</code>。想象 Monix 中我们想要抽象<code>runAsync</code>。想象 Haskell 和 Scalaz 的<code>IO</code>，我们想要抽象<code>unsafePerformIO</code>。</p>
<p><a href="https://github.com/functional-streams-for-scala/fs2/">FS2</a> 库中定义了一个名为 <a href="https://github.com/functional-streams-for-scala/fs2/blob/series/1.0/core/shared/src/main/scala/fs2/util/Effect.scala">Effect</a> 类型类来这样做：</p>
<div class="highlight"><pre><span></span><code><span class="k">trait</span> <span class="nc">Effect</span><span class="o">[</span><span class="kt">F</span><span class="o">[</span><span class="k">_</span><span class="o">]]</span> <span class="k">extends</span> <span class="nc">Monad</span><span class="o">[</span><span class="kt">F</span><span class="o">]</span> <span class="o">{</span>
  <span class="k">def</span> <span class="n">unsafeRunAsync</span><span class="o">[</span><span class="kt">A</span><span class="o">](</span><span class="n">fa</span><span class="k">:</span> <span class="kt">F</span><span class="o">[</span><span class="kt">A</span><span class="o">])(</span><span class="n">cb</span><span class="k">:</span> <span class="kt">Try</span><span class="o">[</span><span class="kt">A</span><span class="o">]</span> <span class="o">=&gt;</span> <span class="nc">Unit</span><span class="o">)</span><span class="k">:</span> <span class="kt">Unit</span>
<span class="o">}</span>
</code></pre></div>
<p>这看起来向我们初始的<code>Async</code>类型，跟<code>Future.onComplete</code>、<code>Task.runAsync</code>、<code>IO.unsafePerformIO</code>很相似。</p>
<p>然而，它并非真正的类型类：</p>
<ul>
<li>它是非法的，然而也不足以取消他的资格(after all, useful lawless type-classes like <code>Show</code> exist)，但最大的问题是....</li>
<li>如 3.3 中所示，为了避免<code>StackOverflowError</code>，我们需要某种执行上下文或线程池来执行异步任务且不会导致栈溢出。</li>
</ul>
<p>但是这样的执行上下文根据实现不同而不同。Java 使用 Executor，Scala 的<code>Future</code>时候使用<code>ExecutionContext</code>，Monix 使用增强自<code>ExecutionContext</code>的<code>Scheduler</code>。FS2 和 Scalaz 使用 包装自<code>Executor</code>的<code>Strategy</code>来 fork 线程，但是调用<code>unsafePerformIO</code>或<code>runAsync</code>时并不会注入上下文(这也是为什么很多 Scalaz 组合子实际上并不安全)。</p>
<p>我们可以采取与<code>Future</code>同样的策略，从作用域中获取一个<code>implicit whatever: Context</code>来创建实例。但这有点尴尬且效率低下。这也意味这不使用上下文的情况下我们仅仅不能为<code>Effect.unsafePerformIO</code>定义<code>flatMap</code>。如果我们不能这样做，这时也不会继承自<code>Monad</code>，因为它没有必要是一个<code>Monad</code>。</p>
<p>因此为个人也不是很确定 - 如果你对 Cats 有什么好的建议，我愿洗耳恭听。</p>
<p>我希望你喜欢这个思想试验，设计东西是很有趣的。</p>
<h2 id="7">7. 选择正确的工具<a class="headerlink" href="#7" title="Permanent link">&para;</a></h2>
<p>一些抽象较其他会更为通用，为个人认为"为工作选择正确的工具"这样的口头禅是过度保护可怜人的选择。</p>
<p>为此，Rúnar Bjarnason 有一个非常有意思的表述，名为 <a href="https://www.youtube.com/watch?v=GqmsQeSzMdw">Constraints Liberate, </a>，而 <a href="https://www.youtube.com/watch?v=GqmsQeSzMdw">Liberties Constrain</a> 最终真正道出了并发抽象的本质。</p>
<p>如前所述，并没有银弹能够通用的解决并发问题。抽象的层次越高，能解决的问题视野也就越少。但是更少的视野和其强大的能力，模型也会更加简单更加可组合。比如 Scala 社区中很多开发者滥用 Akka Actor，这个库在不被误用时是很伟大的。就像能够使用<code>Future</code>或<code>Task</code>时不用 Actor。同样在其他的抽象中，比如 Monix 或 ReactiveX 中的<code>Observable</code>抽象。</p>
<p>同样用心学习下面两条规则：</p>
<ul>
<li>避免使用回调、线程和锁，它们易错且不可组合；</li>
<li>避免像瘟疫一样并发(avoid concurrency like the plague it is)</li>
</ul>
<p>最后让我告诉你，并发专家首先是避免并发的专家....</p>
                
              
              
                


              
            </article>
          </div>
        </div>
        
          <a href="#" class="md-top md-icon" data-md-component="top" data-md-state="hidden">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"/></svg>
          </a>
        
      </main>
      
        
<footer class="md-footer">
  
    <nav class="md-footer__inner md-grid" aria-label="Footer">
      
        <a href="../func-type-class/" class="md-footer__link md-footer__link--prev" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                上一页
              </span>
              函数式与类型类
            </div>
          </div>
        </a>
      
      
        <a href="../scala-style/" class="md-footer__link md-footer__link--next" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                下一页
              </span>
              战略Scala风格：最小功率的原理
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            Copyright &copy; 2013 - 2021 Infilos
          </div>
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
        
      </div>
      
  <div class="md-footer-social">
    
      
      
        
        
      
      <a href="https://twitter.com/squidfunk" target="_blank" rel="noopener" title="twitter.com" class="md-footer-social__link">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"/></svg>
      </a>
    
      
      
        
        
      
      <a href="https://github.com/infilow/relax-authentic" target="_blank" rel="noopener" title="github.com" class="md-footer-social__link">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
      </a>
    
  </div>

    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.tabs", "navigation.indexes", "navigation.top", "search.suggest", "search.highlight"], "translations": {"clipboard.copy": "\u590d\u5236", "clipboard.copied": "\u5df2\u590d\u5236", "search.config.lang": "ja", "search.config.pipeline": "trimmer, stemmer", "search.config.separator": "[\\uff0c\\u3002]+", "search.placeholder": "\u641c\u7d22", "search.result.placeholder": "\u952e\u5165\u4ee5\u5f00\u59cb\u641c\u7d22", "search.result.none": "\u6ca1\u6709\u627e\u5230\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.one": "\u627e\u5230 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.other": "# \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing"}, "search": "../../assets/javascripts/workers/search.fe42c31b.min.js", "version": null}</script>
    
    
  
      <script src="../../assets/javascripts/bundle.4ea5477f.min.js"></script>
      
    
  <script src="../../assets/javascripts/bundle.3b3ca511.min.js"></script>

  </body>
</html>